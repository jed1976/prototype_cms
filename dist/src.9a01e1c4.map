{"version":3,"sources":["node_modules/redom/dist/redom.es.js","src/library/listen.js","src/actions.js","node_modules/argsarray/index.js","node_modules/immediate/lib/browser.js","../../../../usr/local/lib/node_modules/parcel-bundler/node_modules/events/events.js","node_modules/inherits/inherits_browser.js","node_modules/spark-md5/spark-md5.js","node_modules/uuid/lib/rng-browser.js","node_modules/uuid/lib/bytesToUuid.js","node_modules/uuid/v1.js","node_modules/uuid/v4.js","node_modules/uuid/index.js","node_modules/vuvuzela/index.js","../../../../usr/local/lib/node_modules/parcel-bundler/node_modules/process/browser.js","node_modules/pouchdb/lib/index-browser.es.js","src/library/api.js","src/library/dispatch.js","src/components/Button.js","src/components/Icon.js","src/components/List.js","src/components/CollectionItem.js","src/components/Toolbar.js","src/components/CollectionsList.js","src/components/fields/Field.js","src/components/fields/Input.js","src/components/fields/Color.js","src/components/fields/Datetime.js","src/components/fields/Email.js","node_modules/filesize/lib/filesize.js","src/components/fields/Image.js","src/components/fields/Number.js","src/components/fields/Option.js","src/components/fields/Plaintext.js","src/components/fields/Phone.js","src/components/fields/Reference.js","src/components/fields/Richtext.js","src/components/fields/Switch.js","src/components/fields/URL.js","src/components/fields/Fields.js","src/components/Record.js","node_modules/fecha/fecha.js","src/components/RecordItem.js","src/components/Search.js","src/components/RecordsList.js","src/components/App.js","src/index.js"],"names":["HASH","charCodeAt","DOT","TAG_NAME","ID","CLASS_NAME","parseQuery","query","tag","id","className","mode","offset","i","length","char","isHash","isDot","isEnd","substring","createElement","ns","ref","element","document","createElementNS","setAttribute","unmount","parent","child","parentEl","getEl","childEl","__redom_view","parentNode","doUnmount","removeChild","hooks","__redom_lifecycle","hooksAreEmpty","__redom_mounted","traverse","trigger","parentHooks","hook","key","hookNames","shadowRootAvailable","window","mount","before","wasMounted","oldParent","insertBefore","appendChild","doMount","remount","hooksFound","hookName","triggered","ShadowRoot","el","eventName","view","hookCount","firstChild","next","nextSibling","setStyle","arg1","arg2","undefined","style","isString","xlinkns","setAttr","isSVG","SVGElement","isFunction","setData","setXlink","obj","setAttributeNS","dataset","text","str","createTextNode","parseArguments","args","arg","isNumber","isNode","ensureEl","html","nodeType","a","htmlCache","memoizeHTML","len","arguments","cloneNode","Query","Function","prototype","bind","apply","concat","Error","extend","clone","h","setChildren","children","current","_current","propKey","item","listPool","View","initData","ListPool","oldLookup","lookup","oldViews","views","update","data","context","keySet","newLookup","newViews","Array","__redom_id","list","List","__redom_list","pool","this$1","ref$1","place","Place","visible","_placeholder","Node","_el","_View","_initData","placeholder","router","Views","Router","route","svgCache","memoizeSVG","svg","s","exports","listen","target","handlers","handler","e","detail","type","addEventListener","remove","removeEventListener","actions","app","db","docs","selectedCollection","localStorage","getItem","selectedRecord","record","filter","doc","shift","_id","setItem","collection","fields","map","field","name","date","Date","toJSON","created","modified","status","forEach","put","then","get","catch","console","error","EventEmitter","_events","_maxListeners","module","defaultMaxListeners","setMaxListeners","n","isNaN","TypeError","emit","er","listeners","isObject","err","isUndefined","call","slice","addListener","listener","m","newListener","push","warned","trace","on","once","fired","g","removeListener","position","splice","removeAllListeners","ret","listenerCount","evlistener","emitter","process","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","setTimeout","clearTimeout","runTimeout","fun","runClearTimeout","marker","queue","draining","currentQueue","queueIndex","cleanUpNextTick","drainQueue","timeout","run","nextTick","Item","array","title","browser","env","argv","version","versions","noop","off","prependListener","prependOnceListener","binding","cwd","chdir","dir","umask","isBinaryObject","object","ArrayBuffer","Blob","cloneArrayBuffer","buff","byteLength","targetArray","Uint8Array","sourceArray","set","cloneBinaryObject","size","webkitSlice","funcToString","toString","objectCtorString","Object","isPlainObject","value","proto","getPrototypeOf","Ctor","constructor","newObject","isArray","toISOString","hasOwnProperty","called","toPromise","func","self","usedCB","pop","promise","Promise","fulfill","reject","resp","callback","mesg","result","logApiCall","logArgs","origCallback","res","responseArgs","adapterFun","_closed","_destroyed","taskqueue","isReady","addTask","failed","mangle","unmangle","Map$1","_store","mangled","has","delete","cb","keys","defineProperty","Set$1","add","supportsMapAndSet","Symbol","Map","Set","prop","getOwnPropertyDescriptor","species","ExportedSet","ExportedMap","pick","arr","MAX_NUM_CONCURRENT_REQUESTS","identityFunction","x","formatResultForOpenRevsGet","ok","bulkGet","opts","requests","requestsById","request","numDocs","numDone","perDocResults","collapseResultsAndFinish","results","info","checkDone","gotResult","docIndex","allRequests","nextBatch","upTo","Math","min","batch","processBatch","docId","j","docIdx","docRequests","docOpts","open_revs","rev","formatResult","param","hasLocal","hasLocalStorage","Changes","attachBrowserEvents","_listeners","dbName","inprogress","eventFunction","changesOpts","onError","changes","c","seq","since","cancelled","onChange","notifyLocalWindows","notify","guardedConsole","method","randomNumber","max","maxTimeout","parseInt","ratio","random","range","defaultBackOff","explainError","assign","to","index","nextSource","nextKey","$inject_Object_assign","PouchError","reason","message","JSON","stringify","UNAUTHORIZED","MISSING_BULK_DOCS","MISSING_DOC","REV_CONFLICT","INVALID_ID","MISSING_ID","RESERVED_ID","NOT_OPEN","UNKNOWN_ERROR","BAD_ARG","INVALID_REQUEST","QUERY_PARSE_ERROR","DOC_VALIDATION","BAD_REQUEST","NOT_AN_OBJECT","DB_MISSING","IDB_ERROR","WSQ_ERROR","LDB_ERROR","FORBIDDEN","INVALID_REV","FILE_EXISTS","MISSING_STUB","INVALID_URL","createError","CustomPouchError","p","generateErrorFromResponse","tryFilter","req","msg","filterChange","hasFilter","query_params","change","filterReturn","include_docs","attachments","att","_attachments","stub","flatten","arrs","invalidIdError","test","isRemote","_remote","ee","parseDesignDocFunctionName","parts","split","normalizeDesignDocFunctionName","normalized","join","qName","qParser","parser","parseUri","exec","uri","encoded","indexOf","decodeURIComponent","replace","$0","$1","$2","scopeEval","source","scope","values","upsert","diffFun","docRev","_rev","newDoc","updated","tryAndPut","thisAtob","atob","thisBtoa","btoa","createBlob","properties","Builder","BlobBuilder","MSBlobBuilder","MozBlobBuilder","WebKitBlobBuilder","builder","append","getBlob","binaryStringToArrayBuffer","bin","buf","binStringToBluffer","binString","b64ToBluffer","b64","arrayBufferToBinaryString","buffer","binary","bytes","String","fromCharCode","readAsBinaryString","blob","reader","FileReader","hasBinaryString","onloadend","readAsArrayBuffer","blobToBinaryString","blobOrBuffer","blobToBase64","base64","setImmediateShim","global","setImmediate","MD5_CHUNK_SIZE","rawToBase64","raw","sliceBlob","start","end","appendBlob","arrayBuffer","appendString","string","appendBinary","binaryMd5","inputIsString","chunkSize","chunks","ceil","currentChunk","Md5","loadNextChunk","done","destroy","stringMd5","hash","rev$$1","deterministic_revs","clonedDoc","uuidV4","v4","toLowerCase","_rev_tree","uuid","winningRev","metadata","winningId","winningPos","winningDeleted","toVisit","rev_tree","node","tree","ids","branches","pos","deleted","traverseRevTree","revs","newCtx","ctx","sortByPos","b","collectLeaves","leaves","isLeaf","acc","sort","reverse","collectConflicts","win","conflicts","leaf","compactTree","revHash","rootToLeaf","paths","history","sortByPos$1","binarySearch","comparator","low","high","mid","insertSorted","idx","pathToTree","path","numStemmed","root","currentLeaf","compareTree","mergeTree","in_tree1","in_tree2","tree1","tree2","merged","doMerge","dontExpand","restree","branch","t1","t2","diff","candidateParents","trees","parentIdx","elements","elementsLen","stem","depth","stemmedRevs","stemmed","merge","newTree","revExists","splitRev","targetPos","targetId","getTrees","isDeleted","isLocalId","latest","historyNode","historyRev","l","Changes$1","tryCatchInChangeListener","pending","lastSeq","complete","onDestroy","cancel","isCancelled","validateChanges","processChange","changeList","_conflicts","PouchDB","_changesFilterPlugin","validate","doChanges","continuous","live","update_seq","normalize","shouldFilter","descending","limit","newPromise","_changes","compare","left","right","yankError","cleanDocs","_deleted","atts","compareByIdThenRev","idCompare","aStart","_revisions","bStart","computeHeight","height","edges","prnt","from","edge","allDocsKeysParse","skip","doNextCompaction","task","_compactionQueue","last_seq","_compact","attachmentNameError","charAt","AbstractPouchDB","post","bulkDocs","_putLocal","_removeLocal","force","transformForceOptionToNewEditsOption","putDoc","oldRevId","oldRevNum","newRevNum","newRevId","new_edits","_put","putAttachment","attachmentId","api","createAttachment","prevrevpos","content_type","revpos","removeAttachment","docOrId","optsOrRev","was_delete","revsDiff","count","missing","addToMissing","revId","processDoc","missingForId","_getRevisionTree","missingObj","compactDocument","maxHeight","revTree","candidates","_doCompaction","compact","return_docs","promises","row","onComplete","all","deltaFunc","_getLocal","finishOpenRevs","existing","_get","revs_info","splittedRev","revNo","currentPath","hashIndex","hashFoundAtRevPos","indexOfRev","howMany","_revs_info","_getAttachment","getAttachment","allDocs","start_key","startkey","end_key","endkey","incompatibleOpt","_allDocs","close","_close","_info","db_name","auto_compaction","adapter","_type","attachmentError","_bulkDocs","registerDependentDatabase","dependentDb","depDB","__opts","dependentDbs","usePrefix","use_prefix","destroyDb","_destroy","localDoc","deletedMap","trueName","RegExp","prefix","TaskQueue","execute","fail","ready","parseAdapter","match","adapters","preferredAdapters","adapterName","prepareForDestruction","onDestroyed","from_constructor","onClosed","prefixedName","backend","_adapter","valid","AbortController","abort","f$1","fetch","Headers","eventEmitter","setUpEventEmitter","Pouch","destructListeners","_destructionListeners","onConstructorRef","onConstructorUnref","dbList","onConstructorDestroyed","addToPreferredAdapters","plugin","__defaults","defaults","defaultOpts","PouchAlt","url","getFieldFromDoc","parsedField","compare$1","parseField","fieldName","ch","combinationFields","isCombinationalField","getKey","getValue","mergeAndedSelectors","selectors","selector","matcher","$eq","fieldMatchers","operator","mergeGtGte","mergeLtLte","mergeNe","mergeEq","$gte","$gt","$lte","$lt","$ne","massageSelector","input","wasAnded","orOrNor","subSelector","pad","padWith","upToLength","padding","targetLength","padLeft","MIN_MAGNITUDE","MAGNITUDE_DIGITS","SEP","collate","normalizeKey","ai","collationIndex","bi","stringCollate","arrayCollate","objectCollate","Infinity","origKey","k","val","indexify","numToIndexableString","toIndexableString","objKey","zero","parseNumber","originalIdx","num","neg","numAsString","magAsString","magnitude","parseFloat","stack","metaStack","lastMetaElement","lastElementIndex","parseIndexableString","parsedNum","parsedStr","arrayElement","objElement","ak","bk","expFormat","toExponential","magForComparison","magString","factor","abs","factorStr","toFixed","createFieldSorter","getFieldValuesAsArray","sorting","docFieldValue","aRow","bRow","aFieldValues","bFieldValues","collation","filterInMemoryFields","rows","requestDef","inMemoryFields","rowFilter","fieldSorter","every","matchCominationalSelector","matchSelector","userOperator","userValue","some","orMatchers","find","matchers","fieldExists","fieldIsNotUndefined","modField","divisor","mod","arrayContainsValue","arrayContainsAllValues","arraySize","regexMatch","re","typeMatch","neValue","matchesSelector","rowsMatched","evalFilter","evalView","code","filterName","changesHandler","doc_ids","viewName","ddoc","mapFun","filterFun","filters","applyChangesFilterPlugin","toObject","reduce","reservedWords","dataWords","parseRevisionInfo","makeRevTreeFromRevisions","revisions","revisionIds","parseDoc","newEdits","dbOpts","nRevNum","revInfo","specialKey","parseBase64","preprocessString","blobType","asBinary","digest","preprocessBlob","md5","preprocessAttachment","preprocessAttachments","docInfos","docv","overallErr","docInfo","recv","processedAttachment","updateDoc","revLimit","prev","writeDoc","previousWinningRev","previouslyDeleted","isRoot","inConflict","newRev","rev_map","winningRev$$1","winningRevIsDeleted","delta","newRevIsDeleted","rootIsMissing","processDocs","fetchedDocs","tx","overallCallback","insertDoc","resultsIdx","idsToDocs","docsDone","docsToDo","checkAllDocsDone","currentDoc","docWritten","nextDoc","ADAPTER_VERSION","DOC_STORE","BY_SEQ_STORE","ATTACH_STORE","ATTACH_AND_SEQ_STORE","META_STORE","LOCAL_STORE","DETECT_BLOB_SUPPORT_STORE","safeJsonParse","parse","vuvuzela","safeJsonStringify","json","idbError","evt","encodeMetadata","deletedOrLocal","decodeMetadata","storedObject","decodeDoc","_doc_id_rev","lastIndexOf","readBlobData","body","asBlob","fetchAttachmentsIfNecessary","txn","fetchAttachment","attObj","objectStore","onsuccess","postProcessAttachments","attNames","resolve","compactRevs","possiblyOrphanedDigests","seqStore","attStore","attAndSeqStore","deleteOrphanedAttachments","countReq","IDBKeyRange","bound","cursor","openCursor","only","event","digestSeq","primaryKey","continue","openTransactionSafely","idb","stores","transaction","idbBulkDocs","docStore","bySeqStore","attachStore","attachAndSeqStore","metaStore","docInfoError","metaDoc","allDocsProcessed","docCountDelta","preconditionErrored","_meta","blobSupport","startTransaction","txnResult","onabort","ontimeout","oncomplete","updateDocCountIfReady","verifyAttachments","fetchExistingDocs","onAllDocsProcessed","idbProcessDocs","revs_limit","docCount","numFetched","readMetadata","verifyAttachment","finish","digests","filename","attErr","isUpdate","hasAttachments","writeAttachments","finishDoc","afterPutDoc","revsToDelete","metadataToStore","metaDataReq","afterPutMetadata","afterPutDocError","preventDefault","stopPropagation","getKeyReq","putReq","insertAttachmentMappings","onerror","collectResults","attachmentSaved","saveAttachment","attsAdded","attsToAdd","newAtt","runBatchedCursor","keyRange","batchSize","onBatch","useGetAll","getAll","getAllKeys","keysBatch","valuesBatch","pseudoCursor","onGetAll","onGetAllKeys","continuePseudoCursor","lastKey","newKeyRange","upper","upperOpen","lowerBound","onCursor","onSuccess","allDocsKeys","createKeyRange","inclusiveEnd","upperBound","idbAllDocs","inclusive_end","keyRangeError","onTxnComplete","docIdRevIndex","updateSeq","getMaxUpdateSeq","maxKey","fetchDocAsynchronously","onGetDoc","allDocsInner","batchValues","batchValue","batchKeys","onResultsReady","returnVal","total_rows","checkBlobSupport","blob$$1","matchedChrome","navigator","userAgent","matchedEdge","countDocs","running","tryCode","applyNext","enqueueTask","action","runAction","runCallback","runNext","docIds","numResults","docIdsToMetadata","winningDocs","metadatas","processMetadataAndWinningDoc","winningDoc","filtered","onBatchDone","fetchWinningDocAndMetadata","onGetMetadata","docIdRev","objectStores","cachedDBs","blobSupportPromise","openReqList","IdbPouch","thisCallback","init","createSchema","createObjectStore","keyPath","autoIncrement","createIndex","unique","addDeletedOrLocalIndex","createLocalStoreSchema","migrateLocalStore","localStore","local","seqCursor","addAttachAndSeqStore","migrateAttsAndSeqs","digestMap","migrateMetadata","decodeMetadataCompat","fetchMetadataSeq","metadataSeq","onGetMetadataSeq","instanceId","idb_bulkDocs","reqOpts","idb_get","attachId","attachment","blobData","idb_info","doc_count","idb_attachment_format","idb_allDocs","idbChanges","oldRev","oStore","oldDoc","openReq","indexedDB","deleteDatabase","cached","open","onupgradeneeded","oldVersion","currentTarget","migrations","migration","onversionchange","storedMetaDoc","completeSetup","storeMetaDocIfReady","instanceKey","IDBPouch","promiseFactories","doNext","runNextBatch","thisErr","CHANGES_BATCH_SIZE","MAX_SIMULTANEOUS_REVS","CHANGES_TIMEOUT_BUFFER","DEFAULT_HEARTBEAT","supportsBulkGetMap","readAttachmentsAsBlobOrBuffer","encodeDocId","encodeURIComponent","preprocessAttachments$1","hasUrlPrefix","protocol","getHost","substr","user","password","auth","username","genDBUrl","genUrl","pathDel","host","port","paramsToStr","params","shouldCacheBust","ua","isIE","isTrident","isEdge","isGET","HttpPouch","dbUrl","ourFetch","options","headers","nAuth","token","unescape","now","fetchFun","adapterFun$$1","setup","fetchJSON","response","v","setupPromise","skip_setup","uuid$$1","ping","compact_running","interval","doBulkGet","doBulkGetShim","numBatches","onResult","batchNum","subOpts","supportsBulkGet","fetchAttachments","filenames","fetchData","encodeAttachmentId","fetchAllAttachments","docOrDocs","contentType","paramStr","batch_size","heartbeat","requestTimeout","leftToFetch","feed","seq_interval","param_name","controller","lastFetchedSeq","aborted","fetchOpts","signal","fetched","raw_results_length","finished","HttpPouch$1","QueryParseError","captureStackTrace","NotFoundError","BuiltInError","promisedCallback","callbackify","fin","finalPromiseFactory","sequentialize","promiseFactory","that","uniq","theSet","mapToKeysArray","createBuiltInError","sum","jLen","jNum","log","evalFunctionWithEval","TaskQueue$1","createViewSignature","reduceFun","createView","sourceDB","temporary","localDocName","viewSignature","cachedViews","_cachedViews","promiseForView","depDbName","diffFunction","fullViewName","depDbs","lastSeqDoc","persistentQueues","tempViewQueue","CHANGES_BATCH_SIZE$1","parseViewName","isGenOne","emitError","createAbstractMapReduce","mapper","reducer","ddocValidator","tryMap","tryReduce","rereduce","output","sortByKeyThenValue","y","keyCompare","sliceResults","rowToDocId","postprocessAttachments","addHttpParam","paramName","asJson","coerceInteger","integerCandidate","asNumber","Number","coerceOptions","group_level","checkPositiveInteger","number","checkQueryParseError","startkeyName","endkeyName","group","optionName","httpQuery","MAX_URL_LENGTH","keysAsString","customQuery","_query","customViewCleanup","_viewCleanup","defaultsTo","getDocsToPersist","docIdsToChangesAndEmits","metaDocId","defaultMetaDoc","docData","indexableKeysToKeyValues","getMetaDoc","getKeyValueDocs","processKeyValueDocs","kvDocsRes","kvDocs","oldKeys","keyValue","newKeys","kvDoc","saveKeyValues","seqDocId","listOfDocsToPersist","docsToPersist","getQueue","updateView","updateViewInQueue","mapResults","currentSeq","processNextBatch","createDocIdsToChangesAndEmits","createIndexableKeysToKeyValues","emittedKeyValue","complexKey","reduceView","shouldGroup","groups","lvl","POSITIVE_INFINITY","last","groupKey","reduceTry","queryView","queryViewInQueue","totalRows","shouldReduce","fetchFromView","viewOpts","expectedKeys","parsedKeyAndDocId","onMapResultsReady","finalResults","allDocsRes","docIdsToDocs","fetchPromises","keyStart","keyEnd","httpViewCleanup","localViewCleanup","docsToViews","designDocName","viewsToStatus","ddocName","viewDBNames","statusIsGood","viewDBName","dbsToDelete","destroyPromises","queryPromised","createViewPromise","stale","abstractQuery","abstractViewCleanup","viewCleanup","builtInReduce","_sum","_count","_stats","sumsqr","_sumsqr","getBuiltIn","reduceFunString","origMap","builtIn","abstract","mapreduce","isGenOne$1","fileHasChanged","remoteDoc","getDocAttachments","getDocAttachmentsFromTargetOrSource","src","doCheckForLocalAttachments","createBulkGetOpts","diffs","missingRevs","missingRev","getDocs","state","resultDocs","getAllDocs","bulkGetOpts","bulkGetResponse","bulkGetInfo","Boolean","hasConflicts","fetchRevisionOneDocs","getRevisionOneDocs","returnResult","CHECKPOINT_VERSION","REPLICATOR","CHECKPOINT_HISTORY_SIZE","LOWEST_SEQ","updateCheckpoint","checkpoint","session","returnValue","session_id","replicator","unshift","Checkpointer","writeCheckpoint","updateTarget","updateSource","writeTargetCheckpoint","writeSourceCheckpoint","isForbiddenError","comparisons","targetDoc","sourceDoc","compareReplicationLogs","getCheckpoint","srcDoc","tgtDoc","compareReplicationHistory","sourceHistory","targetHistory","S","sourceRest","T","targetRest","sourceId","hasSessionId","sessionId","props","rest","floor","STARTING_BACK_OFF","backOff","retry","back_off_function","backOffSet","backoffTimeSet","current_back_off","removeBackOffSetter","removeBackOffTimeSet","sortObjectPropertiesByKey","queryParams","generateReplicationId","filterViewName","queryData","md5sum","replicate","batches","currentBatch","pendingBatch","writingCheckpoint","changesCompleted","replicationCompleted","batches_limit","changesPending","repId","checkpointer","changedDocs","start_time","docs_read","docs_written","doc_write_failures","errors","initCheckpointer","checkpointOpts","writeDocs","bulkOpts","completeReplication","errorsById","create","errorsNo","errorName","finishBatch","outResult","getChanges","onCheckpointError","getDiffs","getBatchDocs","got","startNextBatch","processPendingBatch","abortReplication","immediate","fatalError","end_time","onChangesComplete","onChangesError","abortChanges","_abortChanges","startChanges","_addedListeners","Replication","_readyCalled","cleanup","toPouch","PouchConstructor","replicateWrapper","replicateRet","srcPouch","targetPouch","Sync","sync","canceled","optsPush","optsPull","pull","pushPaused","pullPaused","pullChange","direction","pushChange","pushDenied","pullDenied","pushActive","pullActive","removed","removeAll","isChange","isDenied","isPaused","isActive","addOneListener","out","success","replication","replicateMethods","other","require","localDB","default","remoteDB","fetchDocs","onDeleted","onUpdatedOrInserted","reactToChanges","dispatch","CustomEvent","bubbles","dispatchEvent","config","defaultConfig","cls","iconPosition","iconSpacing","flexDirection","flexOrder","icon","textContent","disabled","setDisabled","onclick","opacity","icons","ListItem","cell","class","nodeName","toggleSelection","selectedElement","selectedClasses","getElementById","firstElementChild","scrollIntoViewIfNeeded","childNodes","classList","Icon","border","items","spacing","Button","CollectionItem","Toolbar","width","collections","selectElementById","afterFieldDecorator","beforeFieldDecorator","required","label","help","content","Field","oninput","singleLine","attributes","autocapitalize","autocorrect","autocomplete","spellcheck","Input","timepicker","symbol","iec","bits","jedec","fullform","filesize","descriptor","base","full","fullforms","round","unix","separator","spacer","standard","symbols","suffixes","exponent","pow","suffix","partial","opt","define","amd","inputContainer","imageInput","accept","imageContainer","image","imageName","imageWidth","imageHeight","imageSize","replaceImageButton","click","deleteImageButton","confirm","toggleImageContainer","objectFit","ondragover","ondrop","setImageDetails","dataTransfer","files","contains","file","readAsDataURL","onload","naturalWidth","naturalHeight","toggle","arrow","option","backgroundImage","backgroundPosition","backgroundSize","backgroundRepeat","Option","track","innerTrack","checked","protocols","maxlength","minlength","pattern","startsWith","Color","Datetime","Email","Image","Plaintext","Phone","Reference","Richtext","Switch","URL","FieldComponents","form","deleteButton","saveButton","minWidth","scrollTop","setEnabled","focus","fecha","format","search","RecordItem","Search","filteredDocs","searchResults","toLocaleLowerCase","includes","clear","selectElementByIndex","applyFilter","selectRecord","CollectionsList","Record","RecordsList","records","App","render","hot"],"mappings":"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;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/uBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC7KA;AACA,IAAIkJ,UAAUjC,OAAO9C,OAAP,GAAiB,EAA/B;;AAEA;AACA;AACA;AACA;;AAEA,IAAIgF,gBAAJ;AACA,IAAIC,kBAAJ;;AAEA,SAASC,gBAAT,GAA4B;AACxB,UAAM,IAAInI,KAAJ,CAAU,iCAAV,CAAN;AACH;AACD,SAASoI,mBAAT,GAAgC;AAC5B,UAAM,IAAIpI,KAAJ,CAAU,mCAAV,CAAN;AACH;AACA,aAAY;AACT,QAAI;AACA,YAAI,OAAOqI,UAAP,KAAsB,UAA1B,EAAsC;AAClCJ,+BAAmBI,UAAnB;AACH,SAFD,MAEO;AACHJ,+BAAmBE,gBAAnB;AACH;AACJ,KAND,CAME,OAAO7E,CAAP,EAAU;AACR2E,2BAAmBE,gBAAnB;AACH;AACD,QAAI;AACA,YAAI,OAAOG,YAAP,KAAwB,UAA5B,EAAwC;AACpCJ,i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AAYg+C,OAAOt9C,IAAnB,CAAX;;AAEAH,mBAAOsC,IAAP,CACE,IAAImjD,gBAAgBhI,OAAO5+C,IAAvB,CAAJ,CAAiC4+C,MAAjC,EAAyCjhD,IAAzC,EAA+C4C,IAA/C,CADF;AAGD,WAND;;AAQAY,iBAAOsC,IAAP,CACE9G,EAAE,OAAF,EAAW,EAAE2E,MAAM,KAAR,EAAetB,MAAM,QAArB,EAA+BgI,OAAO,KAAKpH,MAAL,CAAYI,GAAlD,EAAX,CADF,EAEErE,EAAE,OAAF,EAAW,EAAE2E,MAAM,MAAR,EAAgBtB,MAAM,QAAtB,EAAgCgI,OAAO,KAAKpH,MAAL,CAAYmU,IAAnD,EAAX,CAFF;AAID;;AAED,aAAK+xC,YAAL,CAAkBI,UAAlB;AACA,aAAKH,UAAL,CAAgBG,UAAhB;AACD;;AAEDtqD,oCAAY,KAAKiqD,IAAjB,SAA0B1lD,MAA1B;;AAEA,UAAI,KAAK0lD,IAAL,CAAUlpC,QAAV,CAAmBhnB,MAAvB,EAA+B;AAC7B,aAAKkwD,IAAL,CAAUlpC,QAAV,CAAmB,CAAnB,EAAsBwpC,KAAtB;AACD;AACF;AAzFH;;AAAA;AAAA;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;eC9UcnJ,QAAQ,OAAR;IAANrhD,aAAAA;;AACR,IAAMyqD,QAAQpJ,QAAQ,OAAR,CAAd;AACA,IAAMsC,OAA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","file":"src.9a01e1c4.map","sourceRoot":"..","sourcesContent":["var HASH = '#'.charCodeAt(0);\nvar DOT = '.'.charCodeAt(0);\n\nvar TAG_NAME = 0;\nvar ID = 1;\nvar CLASS_NAME = 2;\n\nvar parseQuery = function (query) {\n  var tag = null;\n  var id = null;\n  var className = null;\n  var mode = TAG_NAME;\n  var offset = 0;\n\n  for (var i = 0; i <= query.length; i++) {\n    var char = query.charCodeAt(i);\n    var isHash = char === HASH;\n    var isDot = char === DOT;\n    var isEnd = !char;\n\n    if (isHash || isDot || isEnd) {\n      if (mode === TAG_NAME) {\n        if (i === 0) {\n          tag = 'div';\n        } else {\n          tag = query.substring(offset, i);\n        }\n      } else if (mode === ID) {\n        id = query.substring(offset, i);\n      } else {\n        if (className) {\n          className += ' ' + query.substring(offset, i);\n        } else {\n          className = query.substring(offset, i);\n        }\n      }\n\n      if (isHash) {\n        mode = ID;\n      } else if (isDot) {\n        mode = CLASS_NAME;\n      }\n\n      offset = i + 1;\n    }\n  }\n\n  return { tag: tag, id: id, className: className };\n};\n\nvar createElement = function (query, ns) {\n  var ref = parseQuery(query);\n  var tag = ref.tag;\n  var id = ref.id;\n  var className = ref.className;\n  var element = ns ? document.createElementNS(ns, tag) : document.createElement(tag);\n\n  if (id) {\n    element.id = id;\n  }\n\n  if (className) {\n    if (ns) {\n      element.setAttribute('class', className);\n    } else {\n      element.className = className;\n    }\n  }\n\n  return element;\n};\n\nvar unmount = function (parent, child) {\n  var parentEl = getEl(parent);\n  var childEl = getEl(child);\n\n  if (child === childEl && childEl.__redom_view) {\n    // try to look up the view if not provided\n    child = childEl.__redom_view;\n  }\n\n  if (childEl.parentNode) {\n    doUnmount(child, childEl, parentEl);\n\n    parentEl.removeChild(childEl);\n  }\n\n  return child;\n};\n\nvar doUnmount = function (child, childEl, parentEl) {\n  var hooks = childEl.__redom_lifecycle;\n\n  if (hooksAreEmpty(hooks)) {\n    childEl.__redom_mounted = false;\n    return;\n  }\n\n  var traverse = parentEl;\n\n  if (childEl.__redom_mounted) {\n    trigger(childEl, 'onunmount');\n  }\n\n  while (traverse) {\n    var parentHooks = traverse.__redom_lifecycle || {};\n\n    for (var hook in hooks) {\n      if (parentHooks[hook]) {\n        parentHooks[hook] -= hooks[hook];\n      }\n    }\n\n    if (hooksAreEmpty(parentHooks)) {\n      traverse.__redom_lifecycle = null;\n    }\n\n    traverse = traverse.parentNode;\n  }\n};\n\nvar hooksAreEmpty = function (hooks) {\n  if (hooks == null) {\n    return true;\n  }\n  for (var key in hooks) {\n    if (hooks[key]) {\n      return false;\n    }\n  }\n  return true;\n};\n\nvar hookNames = ['onmount', 'onunmount'];\nvar shadowRootAvailable = typeof window !== 'undefined' && 'ShadowRoot' in window;\n\nvar mount = function (parent, child, before) {\n  var parentEl = getEl(parent);\n  var childEl = getEl(child);\n\n  if (child === childEl && childEl.__redom_view) {\n    // try to look up the view if not provided\n    child = childEl.__redom_view;\n  }\n\n  if (child !== childEl) {\n    childEl.__redom_view = child;\n  }\n\n  var wasMounted = childEl.__redom_mounted;\n  var oldParent = childEl.parentNode;\n\n  if (wasMounted && (oldParent !== parentEl)) {\n    doUnmount(child, childEl, oldParent);\n  }\n\n  if (before != null) {\n    parentEl.insertBefore(childEl, getEl(before));\n  } else {\n    parentEl.appendChild(childEl);\n  }\n\n  doMount(child, childEl, parentEl, oldParent);\n\n  return child;\n};\n\nvar doMount = function (child, childEl, parentEl, oldParent) {\n  var hooks = childEl.__redom_lifecycle || (childEl.__redom_lifecycle = {});\n  var remount = (parentEl === oldParent);\n  var hooksFound = false;\n\n  for (var i = 0; i < hookNames.length; i++) {\n    var hookName = hookNames[i];\n\n    if (!remount && (child !== childEl) && (hookName in child)) {\n      hooks[hookName] = (hooks[hookName] || 0) + 1;\n    }\n    if (hooks[hookName]) {\n      hooksFound = true;\n    }\n  }\n\n  if (!hooksFound) {\n    childEl.__redom_mounted = true;\n    return;\n  }\n\n  var traverse = parentEl;\n  var triggered = false;\n\n  if (remount || (!triggered && (traverse && traverse.__redom_mounted))) {\n    trigger(childEl, remount ? 'onremount' : 'onmount');\n    triggered = true;\n  }\n\n  if (remount) {\n    return;\n  }\n\n  while (traverse) {\n    var parent = traverse.parentNode;\n    var parentHooks = traverse.__redom_lifecycle || (traverse.__redom_lifecycle = {});\n\n    for (var hook in hooks) {\n      parentHooks[hook] = (parentHooks[hook] || 0) + hooks[hook];\n    }\n\n    if (!triggered && (traverse === document || (shadowRootAvailable && (traverse instanceof window.ShadowRoot)) || (parent && parent.__redom_mounted))) {\n      trigger(traverse, remount ? 'onremount' : 'onmount');\n      triggered = true;\n    }\n\n    traverse = parent;\n  }\n};\n\nvar trigger = function (el, eventName) {\n  if (eventName === 'onmount') {\n    el.__redom_mounted = true;\n  } else if (eventName === 'onunmount') {\n    el.__redom_mounted = false;\n  }\n\n  var hooks = el.__redom_lifecycle;\n\n  if (!hooks) {\n    return;\n  }\n\n  var view = el.__redom_view;\n  var hookCount = 0;\n\n  view && view[eventName] && view[eventName]();\n\n  for (var hook in hooks) {\n    if (hook) {\n      hookCount++;\n    }\n  }\n\n  if (hookCount) {\n    var traverse = el.firstChild;\n\n    while (traverse) {\n      var next = traverse.nextSibling;\n\n      trigger(traverse, eventName);\n\n      traverse = next;\n    }\n  }\n};\n\nvar setStyle = function (view, arg1, arg2) {\n  var el = getEl(view);\n\n  if (arg2 !== undefined) {\n    el.style[arg1] = arg2;\n  } else if (isString(arg1)) {\n    el.setAttribute('style', arg1);\n  } else {\n    for (var key in arg1) {\n      setStyle(el, key, arg1[key]);\n    }\n  }\n};\n\n/* global SVGElement */\n\nvar xlinkns = 'http://www.w3.org/1999/xlink';\n\nvar setAttr = function (view, arg1, arg2) {\n  var el = getEl(view);\n  var isSVG = el instanceof SVGElement;\n\n  if (arg2 !== undefined) {\n    if (arg1 === 'style') {\n      setStyle(el, arg2);\n    } else if (isSVG && isFunction(arg2)) {\n      el[arg1] = arg2;\n    } else if (arg1 === 'dataset') {\n      setData(el, arg2);\n    } else if (!isSVG && (arg1 in el || isFunction(arg2))) {\n      el[arg1] = arg2;\n    } else {\n      if (isSVG && (arg1 === 'xlink')) {\n        setXlink(el, arg2);\n        return;\n      }\n      el.setAttribute(arg1, arg2);\n    }\n  } else {\n    for (var key in arg1) {\n      setAttr(el, key, arg1[key]);\n    }\n  }\n};\n\nfunction setXlink (el, obj) {\n  for (var key in obj) {\n    el.setAttributeNS(xlinkns, key, obj[key]);\n  }\n}\n\nfunction setData (el, obj) {\n  for (var key in obj) {\n    el.dataset[key] = obj[key];\n  }\n}\n\nvar text = function (str) { return document.createTextNode((str != null) ? str : ''); };\n\nvar parseArguments = function (element, args) {\n  for (var i = 0; i < args.length; i++) {\n    var arg = args[i];\n\n    if (arg !== 0 && !arg) {\n      continue;\n    }\n\n    // support middleware\n    if (typeof arg === 'function') {\n      arg(element);\n    } else if (isString(arg) || isNumber(arg)) {\n      element.appendChild(text(arg));\n    } else if (isNode(getEl(arg))) {\n      mount(element, arg);\n    } else if (arg.length) {\n      parseArguments(element, arg);\n    } else if (typeof arg === 'object') {\n      setAttr(element, arg);\n    }\n  }\n};\n\nvar ensureEl = function (parent) { return isString(parent) ? html(parent) : getEl(parent); };\nvar getEl = function (parent) { return (parent.nodeType && parent) || (!parent.el && parent) || getEl(parent.el); };\n\nvar isString = function (a) { return typeof a === 'string'; };\nvar isNumber = function (a) { return typeof a === 'number'; };\nvar isFunction = function (a) { return typeof a === 'function'; };\n\nvar isNode = function (a) { return a && a.nodeType; };\n\nvar htmlCache = {};\n\nvar memoizeHTML = function (query) { return htmlCache[query] || (htmlCache[query] = createElement(query)); };\n\nvar html = function (query) {\n  var args = [], len = arguments.length - 1;\n  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  var element;\n\n  if (isString(query)) {\n    element = memoizeHTML(query).cloneNode(false);\n  } else if (isNode(query)) {\n    element = query.cloneNode(false);\n  } else if (isFunction(query)) {\n    var Query = query;\n    element = new (Function.prototype.bind.apply( Query, [ null ].concat( args) ));\n  } else {\n    throw new Error('At least one argument required');\n  }\n\n  parseArguments(getEl(element), args);\n\n  return element;\n};\n\nhtml.extend = function (query) {\n  var args = [], len = arguments.length - 1;\n  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  var clone = memoizeHTML(query);\n\n  return html.bind.apply(html, [ this, clone ].concat( args ));\n};\n\nvar el = html;\nvar h = html;\n\nvar setChildren = function (parent) {\n  var children = [], len = arguments.length - 1;\n  while ( len-- > 0 ) children[ len ] = arguments[ len + 1 ];\n\n  var parentEl = getEl(parent);\n  var current = traverse(parent, children, parentEl.firstChild);\n\n  while (current) {\n    var next = current.nextSibling;\n\n    unmount(parent, current);\n\n    current = next;\n  }\n};\n\nfunction traverse (parent, children, _current) {\n  var current = _current;\n\n  for (var i = 0; i < children.length; i++) {\n    var child = children[i];\n\n    if (!child) {\n      continue;\n    }\n\n    var childEl = getEl(child);\n\n    if (childEl === current) {\n      current = current.nextSibling;\n      continue;\n    }\n\n    if (isNode(childEl)) {\n      mount(parent, child, current);\n      continue;\n    }\n\n    if (child.length != null) {\n      current = traverse(parent, child, current);\n    }\n  }\n\n  return current;\n}\n\nvar propKey = function (key) { return function (item) { return item[key]; }; };\n\nvar listPool = function (View, key, initData) {\n  return new ListPool(View, key, initData);\n};\n\nvar ListPool = function ListPool (View, key, initData) {\n  this.View = View;\n  this.initData = initData;\n  this.oldLookup = {};\n  this.lookup = {};\n  this.oldViews = [];\n  this.views = [];\n\n  if (key != null) {\n    this.lookup = {};\n    this.key = isFunction(key) ? key : propKey(key);\n  }\n};\nListPool.prototype.update = function update (data, context) {\n  var ref = this;\n    var View = ref.View;\n    var key = ref.key;\n    var initData = ref.initData;\n  var keySet = key != null;\n\n  var oldLookup = this.lookup;\n  var newLookup = {};\n\n  var newViews = new Array(data.length);\n  var oldViews = this.views;\n\n  for (var i = 0; i < data.length; i++) {\n    var item = data[i];\n    var view = (void 0);\n\n    if (keySet) {\n      var id = key(item);\n      view = oldLookup[id] || new View(initData, item, i, data);\n      newLookup[id] = view;\n      view.__redom_id = id;\n    } else {\n      view = oldViews[i] || new View(initData, item, i, data);\n    }\n    view.update && view.update(item, i, data, context);\n\n    var el = getEl(view.el);\n    el.__redom_view = view;\n    newViews[i] = view;\n  }\n\n  this.oldViews = oldViews;\n  this.views = newViews;\n\n  this.oldLookup = oldLookup;\n  this.lookup = newLookup;\n};\n\nvar list = function (parent, View, key, initData) {\n  return new List(parent, View, key, initData);\n};\n\nvar List = function List (parent, View, key, initData) {\n  this.__redom_list = true;\n  this.View = View;\n  this.initData = initData;\n  this.views = [];\n  this.pool = new ListPool(View, key, initData);\n  this.el = ensureEl(parent);\n  this.keySet = key != null;\n};\nList.prototype.update = function update (data, context) {\n    var this$1 = this;\n    if ( data === void 0 ) data = [];\n\n  var ref = this;\n    var keySet = ref.keySet;\n  var oldViews = this.views;\n  var oldLookup = keySet && this.lookup;\n\n  this.pool.update(data, context);\n  var ref$1 = this.pool;\n    var views = ref$1.views;\n    var lookup = ref$1.lookup;\n\n  if (keySet) {\n    for (var i = 0; i < oldViews.length; i++) {\n      var id = oldViews[i].__redom_id;\n      if (!(id in lookup)) {\n        unmount(this$1, oldLookup[id]);\n      }\n    }\n  }\n\n  setChildren(this, views);\n\n  if (keySet) {\n    this.lookup = lookup;\n  }\n  this.views = views;\n};\n\nList.extend = function (parent, View, key, initData) {\n  return List.bind(List, parent, View, key, initData);\n};\n\nlist.extend = List.extend;\n\n/* global Node */\n\nvar place = function (View, initData) {\n  return new Place(View, initData);\n};\n\nvar Place = function Place (View, initData) {\n  this.el = text('');\n  this.visible = false;\n  this.view = null;\n  this._placeholder = this.el;\n  if (View instanceof Node) {\n    this._el = View;\n  } else {\n    this._View = View;\n  }\n  this._initData = initData;\n};\nPlace.prototype.update = function update (visible, data) {\n  var placeholder = this._placeholder;\n  var parentNode = this.el.parentNode;\n\n  if (visible) {\n    if (!this.visible) {\n      if (this._el) {\n        mount(parentNode, this._el, placeholder);\n        unmount(parentNode, placeholder);\n        this.el = this._el;\n        this.visible = visible;\n        return;\n      }\n      var View = this._View;\n      var view = new View(this._initData);\n\n      this.el = getEl(view);\n      this.view = view;\n\n      mount(parentNode, view, placeholder);\n      unmount(parentNode, placeholder);\n    }\n    this.view && this.view.update && this.view.update(data);\n  } else {\n    if (this.visible) {\n      if (this._el) {\n        mount(parentNode, placeholder, this._el);\n        unmount(parentNode, this._el);\n        this.el = placeholder;\n        this.visible = visible;\n        return;\n      }\n      mount(parentNode, placeholder, this.view);\n      unmount(parentNode, this.view);\n\n      this.el = placeholder;\n      this.view = null;\n    }\n  }\n  this.visible = visible;\n};\n\nvar router = function (parent, Views, initData) {\n  return new Router(parent, Views, initData);\n};\n\nvar Router = function Router (parent, Views, initData) {\n  this.el = ensureEl(parent);\n  this.Views = Views;\n  this.initData = initData;\n};\nRouter.prototype.update = function update (route, data) {\n  if (route !== this.route) {\n    var Views = this.Views;\n    var View = Views[route];\n\n    this.route = route;\n    this.view = View && new View(this.initData, data);\n\n    setChildren(this.el, [ this.view ]);\n  }\n  this.view && this.view.update && this.view.update(data, route);\n};\n\nvar ns = 'http://www.w3.org/2000/svg';\n\nvar svgCache = {};\n\nvar memoizeSVG = function (query) { return svgCache[query] || (svgCache[query] = createElement(query, ns)); };\n\nvar svg = function (query) {\n  var args = [], len = arguments.length - 1;\n  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  var element;\n\n  if (isString(query)) {\n    element = memoizeSVG(query).cloneNode(false);\n  } else if (isNode(query)) {\n    element = query.cloneNode(false);\n  } else if (isFunction(query)) {\n    var Query = query;\n    element = new (Function.prototype.bind.apply( Query, [ null ].concat( args) ));\n  } else {\n    throw new Error('At least one argument required');\n  }\n\n  parseArguments(getEl(element), args);\n\n  return element;\n};\n\nsvg.extend = function (query) {\n  var clone = memoizeSVG(query);\n\n  return svg.bind(this, clone);\n};\n\nsvg.ns = ns;\n\nvar s = svg;\n\nexport { el, h, html, list, List, listPool, ListPool, mount, unmount, place, Place, router, Router, setAttr, setStyle, setChildren, s, svg, text };\n","exports.listen = (target, handlers) => {\n  const el = target.el || target\n  const handler = e => {\n    const { type, data } = e.detail\n    handlers[type] && handlers[type](data)\n  }\n\n  el.addEventListener('redom', handler)\n\n  return {\n    remove() {\n      el.removeEventListener('redom', handler)\n    }\n  }\n}\n","exports.actions = (app, db, docs) => {\n\n  return {\n    'collection:add': data => {\n\n    },\n\n    'list:selection': data => {\n      let selectedCollection = localStorage.getItem('selectedCollection')\n      let selectedRecord = localStorage.getItem('selectedRecord')\n\n      const id = data.target.id\n\n      switch (data.list.id) {\n        case 'collections':\n          if (id !== localStorage.getItem('selectedCollection')) {\n            const record = docs.filter(doc => doc.parent === id).shift()\n            selectedRecord = record ? record._id : null\n          }\n\n          selectedCollection = id\n        break\n\n        case 'records':\n          selectedRecord = id\n        break\n      }\n\n      localStorage.setItem('selectedCollection', selectedCollection)\n      localStorage.setItem('selectedRecord', selectedRecord)\n\n      app.update(docs)\n    },\n\n    'record:add': data => {\n      const selectedCollection = localStorage.getItem('selectedCollection')\n      const collection = docs.filter(doc => doc._id === selectedCollection).shift()\n      const fields = collection.fields.map(field => field.name)\n      const date = new Date().toJSON()\n      const doc = {\n        _id: `${collection.name}-${date}`,\n        created: date,\n        modified: date,\n        status: 'draft',\n        type: 'record',\n        parent: collection._id,\n      }\n\n      fields.forEach(field => doc[field] = '')\n\n      doc.name = `New Record`\n\n      db.put(doc).then(response => {\n        localStorage.setItem('selectedRecord', doc._id)\n        app.update(docs)\n      })\n    },\n\n    'record:delete': data => {\n      db.get(data.id)\n        .then(doc => db.remove(doc))\n        .then(result => {\n          const selectedCollection = localStorage.getItem('selectedCollection')\n          const selectedRecord = docs.filter(doc => doc.parent === selectedCollection).shift()\n          localStorage.setItem('selectedRecord', selectedRecord._id)\n          app.update(docs)\n        })\n        .catch(error => console.error(error))\n    },\n\n    'record:update': data => {\n\n    },\n  }\n}\n","'use strict';\n\nmodule.exports = argsArray;\n\nfunction argsArray(fun) {\n  return function () {\n    var len = arguments.length;\n    if (len) {\n      var args = [];\n      var i = -1;\n      while (++i < len) {\n        args[i] = arguments[i];\n      }\n      return fun.call(this, args);\n    } else {\n      return fun.call(this, []);\n    }\n  };\n}","'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a += (b & c | ~b & d) + k[0] - 680876936 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[1] - 389564586 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[2] + 606105819 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[4] - 176418897 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[7] - 45705983 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[10] - 42063 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[13] - 40341101 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n\n        a += (b & d | c & ~d) + k[1] - 165796510 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[11] + 643717713 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[0] - 373897302 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[5] - 701558691 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[10] + 38016083 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[15] - 660478335 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[4] - 405537848 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[9] + 568446438 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[3] - 187363961 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[2] - 51403784 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n\n        a += (b ^ c ^ d) + k[5] - 378558 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[14] - 35309556 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[7] - 155497632 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[13] + 681279174 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[0] - 358537222 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[3] - 722521979 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[6] + 76029189 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[9] - 640364487 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[12] - 421815835 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[15] + 530742520 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[2] - 995338651 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n\n        a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\n        b  = (b << 21 | b >>> 11) + c | 0;\n\n        x[0] = a + x[0] | 0;\n        x[1] = b + x[1] | 0;\n        x[2] = c + x[2] | 0;\n        x[3] = d + x[3] | 0;\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} raw     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     raw True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && msCrypto.getRandomValues.bind(msCrypto));\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","'use strict';\n\n/**\n * Stringify/parse functions that don't operate\n * recursively, so they avoid call stack exceeded\n * errors.\n */\nexports.stringify = function stringify(input) {\n  var queue = [];\n  queue.push({obj: input});\n\n  var res = '';\n  var next, obj, prefix, val, i, arrayPrefix, keys, k, key, value, objPrefix;\n  while ((next = queue.pop())) {\n    obj = next.obj;\n    prefix = next.prefix || '';\n    val = next.val || '';\n    res += prefix;\n    if (val) {\n      res += val;\n    } else if (typeof obj !== 'object') {\n      res += typeof obj === 'undefined' ? null : JSON.stringify(obj);\n    } else if (obj === null) {\n      res += 'null';\n    } else if (Array.isArray(obj)) {\n      queue.push({val: ']'});\n      for (i = obj.length - 1; i >= 0; i--) {\n        arrayPrefix = i === 0 ? '' : ',';\n        queue.push({obj: obj[i], prefix: arrayPrefix});\n      }\n      queue.push({val: '['});\n    } else { // object\n      keys = [];\n      for (k in obj) {\n        if (obj.hasOwnProperty(k)) {\n          keys.push(k);\n        }\n      }\n      queue.push({val: '}'});\n      for (i = keys.length - 1; i >= 0; i--) {\n        key = keys[i];\n        value = obj[key];\n        objPrefix = (i > 0 ? ',' : '');\n        objPrefix += JSON.stringify(key) + ':';\n        queue.push({obj: value, prefix: objPrefix});\n      }\n      queue.push({val: '{'});\n    }\n  }\n  return res;\n};\n\n// Convenience function for the parse function.\n// This pop function is basically copied from\n// pouchCollate.parseIndexableString\nfunction pop(obj, stack, metaStack) {\n  var lastMetaElement = metaStack[metaStack.length - 1];\n  if (obj === lastMetaElement.element) {\n    // popping a meta-element, e.g. an object whose value is another object\n    metaStack.pop();\n    lastMetaElement = metaStack[metaStack.length - 1];\n  }\n  var element = lastMetaElement.element;\n  var lastElementIndex = lastMetaElement.index;\n  if (Array.isArray(element)) {\n    element.push(obj);\n  } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n    var key = stack.pop();\n    element[key] = obj;\n  } else {\n    stack.push(obj); // obj with key only\n  }\n}\n\nexports.parse = function (str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n  var collationIndex,parsedNum,numChar;\n  var parsedString,lastCh,numConsecutiveSlashes,ch;\n  var arrayElement, objElement;\n  while (true) {\n    collationIndex = str[i++];\n    if (collationIndex === '}' ||\n        collationIndex === ']' ||\n        typeof collationIndex === 'undefined') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack.pop(), stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case ' ':\n      case '\\t':\n      case '\\n':\n      case ':':\n      case ',':\n        break;\n      case 'n':\n        i += 3; // 'ull'\n        pop(null, stack, metaStack);\n        break;\n      case 't':\n        i += 3; // 'rue'\n        pop(true, stack, metaStack);\n        break;\n      case 'f':\n        i += 4; // 'alse'\n        pop(false, stack, metaStack);\n        break;\n      case '0':\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n      case '7':\n      case '8':\n      case '9':\n      case '-':\n        parsedNum = '';\n        i--;\n        while (true) {\n          numChar = str[i++];\n          if (/[\\d\\.\\-e\\+]/.test(numChar)) {\n            parsedNum += numChar;\n          } else {\n            i--;\n            break;\n          }\n        }\n        pop(parseFloat(parsedNum), stack, metaStack);\n        break;\n      case '\"':\n        parsedString = '';\n        lastCh = void 0;\n        numConsecutiveSlashes = 0;\n        while (true) {\n          ch = str[i++];\n          if (ch !== '\"' || (lastCh === '\\\\' &&\n              numConsecutiveSlashes % 2 === 1)) {\n            parsedString += ch;\n            lastCh = ch;\n            if (lastCh === '\\\\') {\n              numConsecutiveSlashes++;\n            } else {\n              numConsecutiveSlashes = 0;\n            }\n          } else {\n            break;\n          }\n        }\n        pop(JSON.parse('\"' + parsedString + '\"'), stack, metaStack);\n        break;\n      case '[':\n        arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '{':\n        objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      default:\n        throw new Error(\n          'unexpectedly reached end of input: ' + collationIndex);\n    }\n  }\n};\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","import getArguments from 'argsarray';\nimport nextTick from 'immediate';\nimport { EventEmitter } from 'events';\nimport inherits from 'inherits';\nimport Md5 from 'spark-md5';\nimport uuidV4 from 'uuid';\nimport vuvuzela from 'vuvuzela';\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\nfunction mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new ExportedMap();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        nextTick(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar $inject_Object_assign = assign;\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nvar thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\n\nvar setImmediateShim = global.setImmediate || global.setTimeout;\nvar MD5_CHUNK_SIZE = 32768;\n\nfunction rawToBase64(raw) {\n  return thisBtoa(raw);\n}\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  }\n  return blob.slice(start, end);\n}\n\nfunction appendBlob(buffer, blob, start, end, callback) {\n  if (start > 0 || end < blob.size) {\n    // only slice blob if we really need to\n    blob = sliceBlob(blob, start, end);\n  }\n  readAsArrayBuffer(blob, function (arrayBuffer) {\n    buffer.append(arrayBuffer);\n    callback();\n  });\n}\n\nfunction appendString(buffer, string, start, end, callback) {\n  if (start > 0 || end < string.length) {\n    // only create a substring if we really need to\n    string = string.substring(start, end);\n  }\n  buffer.appendBinary(string);\n  callback();\n}\n\nfunction binaryMd5(data, callback) {\n  var inputIsString = typeof data === 'string';\n  var len = inputIsString ? data.length : data.size;\n  var chunkSize = Math.min(MD5_CHUNK_SIZE, len);\n  var chunks = Math.ceil(len / chunkSize);\n  var currentChunk = 0;\n  var buffer = inputIsString ? new Md5() : new Md5.ArrayBuffer();\n\n  var append = inputIsString ? appendString : appendBlob;\n\n  function next() {\n    setImmediateShim(loadNextChunk);\n  }\n\n  function done() {\n    var raw = buffer.end(true);\n    var base64 = rawToBase64(raw);\n    callback(base64);\n    buffer.destroy();\n  }\n\n  function loadNextChunk() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize;\n    currentChunk++;\n    if (currentChunk < chunks) {\n      append(buffer, data, start, end, next);\n    } else {\n      append(buffer, data, start, end, done);\n    }\n  }\n  loadNextChunk();\n}\n\nfunction stringMd5(string) {\n  return Md5.hash(string);\n}\n\nfunction rev$$1(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\n// We fetch all leafs of the revision tree, and sort them based on tree length\n// and whether they were deleted, undeleted documents with the longest revision\n// tree (most edits) win\n// The final sort algorithm is slightly documented in a sidebar here:\n// http://guide.couchdb.org/draft/conflicts.html\nfunction winningRev(metadata) {\n  var winningId;\n  var winningPos;\n  var winningDeleted;\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var tree = node.ids;\n    var branches = tree[2];\n    var pos = node.pos;\n    if (branches.length) { // non-leaf\n      for (var i = 0, len = branches.length; i < len; i++) {\n        toVisit.push({pos: pos + 1, ids: branches[i]});\n      }\n      continue;\n    }\n    var deleted = !!tree[1].deleted;\n    var id = tree[0];\n    // sort by deleted, then pos, then id\n    if (!winningId || (winningDeleted !== deleted ? winningDeleted :\n        winningPos !== pos ? winningPos < pos : winningId < id)) {\n      winningId = id;\n      winningPos = pos;\n      winningDeleted = deleted;\n    }\n  }\n\n  return winningPos + '-' + winningId;\n}\n\n// Pretty much all below can be combined into a higher order function to\n// traverse revisions\n// The return value from the callback will be passed as context to all\n// children of that node\nfunction traverseRevTree(revs, callback) {\n  var toVisit = revs.slice();\n\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var branches = tree[2];\n    var newCtx =\n      callback(branches.length === 0, pos, tree[0], node.ctx, tree[1]);\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], ctx: newCtx});\n    }\n  }\n}\n\nfunction sortByPos(a, b) {\n  return a.pos - b.pos;\n}\n\nfunction collectLeaves(revs) {\n  var leaves = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, acc, opts) {\n    if (isLeaf) {\n      leaves.push({rev: pos + \"-\" + id, pos: pos, opts: opts});\n    }\n  });\n  leaves.sort(sortByPos).reverse();\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    delete leaves[i].pos;\n  }\n  return leaves;\n}\n\n// returns revs of all conflicts that is leaves such that\n// 1. are not deleted and\n// 2. are different than winning revision\nfunction collectConflicts(metadata) {\n  var win = winningRev(metadata);\n  var leaves = collectLeaves(metadata.rev_tree);\n  var conflicts = [];\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    var leaf = leaves[i];\n    if (leaf.rev !== win && !leaf.opts.deleted) {\n      conflicts.push(leaf.rev);\n    }\n  }\n  return conflicts;\n}\n\n// compact a tree by marking its non-leafs as missing,\n// and return a list of revs to delete\nfunction compactTree(metadata) {\n  var revs = [];\n  traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                               revHash, ctx, opts) {\n    if (opts.status === 'available' && !isLeaf) {\n      revs.push(pos + '-' + revHash);\n      opts.status = 'missing';\n    }\n  });\n  return revs;\n}\n\n// build up a list of all the paths to the leafs in this revision tree\nfunction rootToLeaf(revs) {\n  var paths = [];\n  var toVisit = revs.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, opts: opts});\n    if (isLeaf) {\n      paths.push({pos: (pos + 1 - history.length), ids: history});\n    }\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], history: history});\n    }\n  }\n  return paths.reverse();\n}\n\n// for a better overview of what this is doing, read:\n\nfunction sortByPos$1(a, b) {\n  return a.pos - b.pos;\n}\n\n// classic binary search\nfunction binarySearch(arr, item, comparator) {\n  var low = 0;\n  var high = arr.length;\n  var mid;\n  while (low < high) {\n    mid = (low + high) >>> 1;\n    if (comparator(arr[mid], item) < 0) {\n      low = mid + 1;\n    } else {\n      high = mid;\n    }\n  }\n  return low;\n}\n\n// assuming the arr is sorted, insert the item in the proper place\nfunction insertSorted(arr, item, comparator) {\n  var idx = binarySearch(arr, item, comparator);\n  arr.splice(idx, 0, item);\n}\n\n// Turn a path as a flat array into a tree with a single branch.\n// If any should be stemmed from the beginning of the array, that's passed\n// in as the second argument\nfunction pathToTree(path, numStemmed) {\n  var root;\n  var leaf;\n  for (var i = numStemmed, len = path.length; i < len; i++) {\n    var node = path[i];\n    var currentLeaf = [node.id, node.opts, []];\n    if (leaf) {\n      leaf[2].push(currentLeaf);\n      leaf = currentLeaf;\n    } else {\n      root = leaf = currentLeaf;\n    }\n  }\n  return root;\n}\n\n// compare the IDs of two trees\nfunction compareTree(a, b) {\n  return a[0] < b[0] ? -1 : 1;\n}\n\n// Merge two trees together\n// The roots of tree1 and tree2 must be the same revision\nfunction mergeTree(in_tree1, in_tree2) {\n  var queue = [{tree1: in_tree1, tree2: in_tree2}];\n  var conflicts = false;\n  while (queue.length > 0) {\n    var item = queue.pop();\n    var tree1 = item.tree1;\n    var tree2 = item.tree2;\n\n    if (tree1[1].status || tree2[1].status) {\n      tree1[1].status =\n        (tree1[1].status ===  'available' ||\n        tree2[1].status === 'available') ? 'available' : 'missing';\n    }\n\n    for (var i = 0; i < tree2[2].length; i++) {\n      if (!tree1[2][0]) {\n        conflicts = 'new_leaf';\n        tree1[2][0] = tree2[2][i];\n        continue;\n      }\n\n      var merged = false;\n      for (var j = 0; j < tree1[2].length; j++) {\n        if (tree1[2][j][0] === tree2[2][i][0]) {\n          queue.push({tree1: tree1[2][j], tree2: tree2[2][i]});\n          merged = true;\n        }\n      }\n      if (!merged) {\n        conflicts = 'new_branch';\n        insertSorted(tree1[2], tree2[2][i], compareTree);\n      }\n    }\n  }\n  return {conflicts: conflicts, tree: in_tree1};\n}\n\nfunction doMerge(tree, path, dontExpand) {\n  var restree = [];\n  var conflicts = false;\n  var merged = false;\n  var res;\n\n  if (!tree.length) {\n    return {tree: [path], conflicts: 'new_leaf'};\n  }\n\n  for (var i = 0, len = tree.length; i < len; i++) {\n    var branch = tree[i];\n    if (branch.pos === path.pos && branch.ids[0] === path.ids[0]) {\n      // Paths start at the same position and have the same root, so they need\n      // merged\n      res = mergeTree(branch.ids, path.ids);\n      restree.push({pos: branch.pos, ids: res.tree});\n      conflicts = conflicts || res.conflicts;\n      merged = true;\n    } else if (dontExpand !== true) {\n      // The paths start at a different position, take the earliest path and\n      // traverse up until it as at the same point from root as the path we\n      // want to merge.  If the keys match we return the longer path with the\n      // other merged After stemming we dont want to expand the trees\n\n      var t1 = branch.pos < path.pos ? branch : path;\n      var t2 = branch.pos < path.pos ? path : branch;\n      var diff = t2.pos - t1.pos;\n\n      var candidateParents = [];\n\n      var trees = [];\n      trees.push({ids: t1.ids, diff: diff, parent: null, parentIdx: null});\n      while (trees.length > 0) {\n        var item = trees.pop();\n        if (item.diff === 0) {\n          if (item.ids[0] === t2.ids[0]) {\n            candidateParents.push(item);\n          }\n          continue;\n        }\n        var elements = item.ids[2];\n        for (var j = 0, elementsLen = elements.length; j < elementsLen; j++) {\n          trees.push({\n            ids: elements[j],\n            diff: item.diff - 1,\n            parent: item.ids,\n            parentIdx: j\n          });\n        }\n      }\n\n      var el = candidateParents[0];\n\n      if (!el) {\n        restree.push(branch);\n      } else {\n        res = mergeTree(el.ids, t2.ids);\n        el.parent[2][el.parentIdx] = res.tree;\n        restree.push({pos: t1.pos, ids: t1.ids});\n        conflicts = conflicts || res.conflicts;\n        merged = true;\n      }\n    } else {\n      restree.push(branch);\n    }\n  }\n\n  // We didnt find\n  if (!merged) {\n    restree.push(path);\n  }\n\n  restree.sort(sortByPos$1);\n\n  return {\n    tree: restree,\n    conflicts: conflicts || 'internal_node'\n  };\n}\n\n// To ensure we dont grow the revision tree infinitely, we stem old revisions\nfunction stem(tree, depth) {\n  // First we break out the tree into a complete list of root to leaf paths\n  var paths = rootToLeaf(tree);\n  var stemmedRevs;\n\n  var result;\n  for (var i = 0, len = paths.length; i < len; i++) {\n    // Then for each path, we cut off the start of the path based on the\n    // `depth` to stem to, and generate a new set of flat trees\n    var path = paths[i];\n    var stemmed = path.ids;\n    var node;\n    if (stemmed.length > depth) {\n      // only do the stemming work if we actually need to stem\n      if (!stemmedRevs) {\n        stemmedRevs = {}; // avoid allocating this object unnecessarily\n      }\n      var numStemmed = stemmed.length - depth;\n      node = {\n        pos: path.pos + numStemmed,\n        ids: pathToTree(stemmed, numStemmed)\n      };\n\n      for (var s = 0; s < numStemmed; s++) {\n        var rev = (path.pos + s) + '-' + stemmed[s].id;\n        stemmedRevs[rev] = true;\n      }\n    } else { // no need to actually stem\n      node = {\n        pos: path.pos,\n        ids: pathToTree(stemmed, 0)\n      };\n    }\n\n    // Then we remerge all those flat trees together, ensuring that we dont\n    // connect trees that would go beyond the depth limit\n    if (result) {\n      result = doMerge(result, node, true).tree;\n    } else {\n      result = [node];\n    }\n  }\n\n  // this is memory-heavy per Chrome profiler, avoid unless we actually stemmed\n  if (stemmedRevs) {\n    traverseRevTree(result, function (isLeaf, pos, revHash) {\n      // some revisions may have been removed in a branch but not in another\n      delete stemmedRevs[pos + '-' + revHash];\n    });\n  }\n\n  return {\n    tree: result,\n    revs: stemmedRevs ? Object.keys(stemmedRevs) : []\n  };\n}\n\nfunction merge(tree, path, depth) {\n  var newTree = doMerge(tree, path);\n  var stemmed = stem(newTree.tree, depth);\n  return {\n    tree: stemmed.tree,\n    stemmedRevs: stemmed.revs,\n    conflicts: newTree.conflicts\n  };\n}\n\n// return true if a rev exists in the rev tree, false otherwise\nfunction revExists(revs, rev) {\n  var toVisit = revs.slice();\n  var splitRev = rev.split('-');\n  var targetPos = parseInt(splitRev[0], 10);\n  var targetId = splitRev[1];\n\n  var node;\n  while ((node = toVisit.pop())) {\n    if (node.pos === targetPos && node.ids[0] === targetId) {\n      return true;\n    }\n    var branches = node.ids[2];\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: node.pos + 1, ids: branches[i]});\n    }\n  }\n  return false;\n}\n\nfunction getTrees(node) {\n  return node.ids;\n}\n\n// check if a specific revision of a doc has been deleted\n//  - metadata: the metadata object from the doc store\n//  - rev: (optional) the revision to check. defaults to winning revision\nfunction isDeleted(metadata, rev) {\n  if (!rev) {\n    rev = winningRev(metadata);\n  }\n  var id = rev.substring(rev.indexOf('-') + 1);\n  var toVisit = metadata.rev_tree.map(getTrees);\n\n  var tree;\n  while ((tree = toVisit.pop())) {\n    if (tree[0] === id) {\n      return !!tree[1].deleted;\n    }\n    toVisit = toVisit.concat(tree[2]);\n  }\n}\n\nfunction isLocalId(id) {\n  return (/^_local/).test(id);\n}\n\n// returns the current leaf node for a given revision\nfunction latest(rev, metadata) {\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, pos: pos, opts: opts});\n\n    if (isLeaf) {\n      for (var i = 0, len = history.length; i < len; i++) {\n        var historyNode = history[i];\n        var historyRev = historyNode.pos + '-' + historyNode.id;\n\n        if (historyRev === rev) {\n          // return the rev of this leaf\n          return pos + '-' + id;\n        }\n      }\n    }\n\n    for (var j = 0, l = branches.length; j < l; j++) {\n      toVisit.push({pos: pos + 1, ids: branches[j], history: history});\n    }\n  }\n\n  /* istanbul ignore next */\n  throw new Error('Unable to resolve latest revision for id ' + metadata.id + ', rev ' + rev);\n}\n\ninherits(Changes$1, EventEmitter);\n\nfunction tryCatchInChangeListener(self, change, pending, lastSeq) {\n  // isolate try/catches to avoid V8 deoptimizations\n  try {\n    self.emit('change', change, pending, lastSeq);\n  } catch (e) {\n    guardedConsole('error', 'Error in .on(\"change\", function):', e);\n  }\n}\n\nfunction Changes$1(db, opts, callback) {\n  EventEmitter.call(this);\n  var self = this;\n  this.db = db;\n  opts = opts ? clone(opts) : {};\n  var complete = opts.complete = once(function (err, resp) {\n    if (err) {\n      if (listenerCount(self, 'error') > 0) {\n        self.emit('error', err);\n      }\n    } else {\n      self.emit('complete', resp);\n    }\n    self.removeAllListeners();\n    db.removeListener('destroyed', onDestroy);\n  });\n  if (callback) {\n    self.on('complete', function (resp) {\n      callback(null, resp);\n    });\n    self.on('error', callback);\n  }\n  function onDestroy() {\n    self.cancel();\n  }\n  db.once('destroyed', onDestroy);\n\n  opts.onChange = function (change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (self.isCancelled) {\n      return;\n    }\n    tryCatchInChangeListener(self, change, pending, lastSeq);\n  };\n\n  var promise = new Promise(function (fulfill, reject) {\n    opts.complete = function (err, res) {\n      if (err) {\n        reject(err);\n      } else {\n        fulfill(res);\n      }\n    };\n  });\n  self.once('cancel', function () {\n    db.removeListener('destroyed', onDestroy);\n    opts.complete(null, {status: 'cancelled'});\n  });\n  this.then = promise.then.bind(promise);\n  this['catch'] = promise['catch'].bind(promise);\n  this.then(function (result) {\n    complete(null, result);\n  }, complete);\n\n\n\n  if (!db.taskqueue.isReady) {\n    db.taskqueue.addTask(function (failed) {\n      if (failed) {\n        opts.complete(failed);\n      } else if (self.isCancelled) {\n        self.emit('cancel');\n      } else {\n        self.validateChanges(opts);\n      }\n    });\n  } else {\n    self.validateChanges(opts);\n  }\n}\nChanges$1.prototype.cancel = function () {\n  this.isCancelled = true;\n  if (this.db.taskqueue.isReady) {\n    this.emit('cancel');\n  }\n};\nfunction processChange(doc, metadata, opts) {\n  var changeList = [{rev: doc._rev}];\n  if (opts.style === 'all_docs') {\n    changeList = collectLeaves(metadata.rev_tree)\n    .map(function (x) { return {rev: x.rev}; });\n  }\n  var change = {\n    id: metadata.id,\n    changes: changeList,\n    doc: doc\n  };\n\n  if (isDeleted(metadata, doc._rev)) {\n    change.deleted = true;\n  }\n  if (opts.conflicts) {\n    change.doc._conflicts = collectConflicts(metadata);\n    if (!change.doc._conflicts.length) {\n      delete change.doc._conflicts;\n    }\n  }\n  return change;\n}\n\nChanges$1.prototype.validateChanges = function (opts) {\n  var callback = opts.complete;\n  var self = this;\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.validate(opts, function (err) {\n      if (err) {\n        return callback(err);\n      }\n      self.doChanges(opts);\n    });\n  } else {\n    self.doChanges(opts);\n  }\n};\n\nChanges$1.prototype.doChanges = function (opts) {\n  var self = this;\n  var callback = opts.complete;\n\n  opts = clone(opts);\n  if ('live' in opts && !('continuous' in opts)) {\n    opts.continuous = opts.live;\n  }\n  opts.processChange = processChange;\n\n  if (opts.since === 'latest') {\n    opts.since = 'now';\n  }\n  if (!opts.since) {\n    opts.since = 0;\n  }\n  if (opts.since === 'now') {\n    this.db.info().then(function (info) {\n      /* istanbul ignore if */\n      if (self.isCancelled) {\n        callback(null, {status: 'cancelled'});\n        return;\n      }\n      opts.since = info.update_seq;\n      self.doChanges(opts);\n    }, callback);\n    return;\n  }\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.normalize(opts);\n    if (PouchDB._changesFilterPlugin.shouldFilter(this, opts)) {\n      return PouchDB._changesFilterPlugin.filter(this, opts);\n    }\n  } else {\n    ['doc_ids', 'filter', 'selector', 'view'].forEach(function (key) {\n      if (key in opts) {\n        guardedConsole('warn',\n          'The \"' + key + '\" option was passed in to changes/replicate, ' +\n          'but pouchdb-changes-filter plugin is not installed, so it ' +\n          'was ignored. Please install the plugin to enable filtering.'\n        );\n      }\n    });\n  }\n\n  if (!('descending' in opts)) {\n    opts.descending = false;\n  }\n\n  // 0 and 1 should return 1 document\n  opts.limit = opts.limit === 0 ? 1 : opts.limit;\n  opts.complete = callback;\n  var newPromise = this.db._changes(opts);\n  /* istanbul ignore else */\n  if (newPromise && typeof newPromise.cancel === 'function') {\n    var cancel = self.cancel;\n    self.cancel = getArguments(function (args) {\n      newPromise.cancel();\n      cancel.apply(this, args);\n    });\n  }\n};\n\n/*\n * A generic pouch adapter\n */\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Wrapper for functions that call the bulkdocs api with a single doc,\n// if the first result is an error, return an error\nfunction yankError(callback, docId) {\n  return function (err, results) {\n    if (err || (results[0] && results[0].error)) {\n      err = err || results[0];\n      err.docId = docId;\n      callback(err);\n    } else {\n      callback(null, results.length ? results[0]  : results);\n    }\n  };\n}\n\n// clean docs given to us by the user\nfunction cleanDocs(docs) {\n  for (var i = 0; i < docs.length; i++) {\n    var doc = docs[i];\n    if (doc._deleted) {\n      delete doc._attachments; // ignore atts for deleted docs\n    } else if (doc._attachments) {\n      // filter out extraneous keys from _attachments\n      var atts = Object.keys(doc._attachments);\n      for (var j = 0; j < atts.length; j++) {\n        var att = atts[j];\n        doc._attachments[att] = pick(doc._attachments[att],\n          ['data', 'digest', 'content_type', 'length', 'revpos', 'stub']);\n      }\n    }\n  }\n}\n\n// compare two docs, first by _id then by _rev\nfunction compareByIdThenRev(a, b) {\n  var idCompare = compare(a._id, b._id);\n  if (idCompare !== 0) {\n    return idCompare;\n  }\n  var aStart = a._revisions ? a._revisions.start : 0;\n  var bStart = b._revisions ? b._revisions.start : 0;\n  return compare(aStart, bStart);\n}\n\n// for every node in a revision tree computes its distance from the closest\n// leaf\nfunction computeHeight(revs) {\n  var height = {};\n  var edges = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, prnt) {\n    var rev = pos + \"-\" + id;\n    if (isLeaf) {\n      height[rev] = 0;\n    }\n    if (prnt !== undefined) {\n      edges.push({from: prnt, to: rev});\n    }\n    return rev;\n  });\n\n  edges.reverse();\n  edges.forEach(function (edge) {\n    if (height[edge.from] === undefined) {\n      height[edge.from] = 1 + height[edge.to];\n    } else {\n      height[edge.from] = Math.min(height[edge.from], 1 + height[edge.to]);\n    }\n  });\n  return height;\n}\n\nfunction allDocsKeysParse(opts) {\n  var keys =  ('limit' in opts) ?\n    opts.keys.slice(opts.skip, opts.limit + opts.skip) :\n    (opts.skip > 0) ? opts.keys.slice(opts.skip) : opts.keys;\n  opts.keys = keys;\n  opts.skip = 0;\n  delete opts.limit;\n  if (opts.descending) {\n    keys.reverse();\n    opts.descending = false;\n  }\n}\n\n// all compaction is done in a queue, to avoid attaching\n// too many listeners at once\nfunction doNextCompaction(self) {\n  var task = self._compactionQueue[0];\n  var opts = task.opts;\n  var callback = task.callback;\n  self.get('_local/compaction').catch(function () {\n    return false;\n  }).then(function (doc) {\n    if (doc && doc.last_seq) {\n      opts.last_seq = doc.last_seq;\n    }\n    self._compact(opts, function (err, res) {\n      /* istanbul ignore if */\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, res);\n      }\n      nextTick(function () {\n        self._compactionQueue.shift();\n        if (self._compactionQueue.length) {\n          doNextCompaction(self);\n        }\n      });\n    });\n  });\n}\n\nfunction attachmentNameError(name) {\n  if (name.charAt(0) === '_') {\n    return name + ' is not a valid attachment name, attachment ' +\n      'names cannot start with \\'_\\'';\n  }\n  return false;\n}\n\ninherits(AbstractPouchDB, EventEmitter);\n\nfunction AbstractPouchDB() {\n  EventEmitter.call(this);\n\n  // re-bind prototyped methods\n  for (var p in AbstractPouchDB.prototype) {\n    if (typeof this[p] === 'function') {\n      this[p] = this[p].bind(this);\n    }\n  }\n}\n\nAbstractPouchDB.prototype.post =\n  adapterFun('post', function (doc, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return callback(createError(NOT_AN_OBJECT));\n  }\n  this.bulkDocs({docs: [doc]}, opts, yankError(callback, doc._id));\n});\n\nAbstractPouchDB.prototype.put = adapterFun('put', function (doc, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return cb(createError(NOT_AN_OBJECT));\n  }\n  invalidIdError(doc._id);\n  if (isLocalId(doc._id) && typeof this._putLocal === 'function') {\n    if (doc._deleted) {\n      return this._removeLocal(doc, cb);\n    } else {\n      return this._putLocal(doc, cb);\n    }\n  }\n  var self = this;\n  if (opts.force && doc._rev) {\n    transformForceOptionToNewEditsOption();\n    putDoc(function (err) {\n      var result = err ? null : {ok: true, id: doc._id, rev: doc._rev};\n      cb(err, result);\n    });\n  } else {\n    putDoc(cb);\n  }\n\n  function transformForceOptionToNewEditsOption() {\n    var parts = doc._rev.split('-');\n    var oldRevId = parts[1];\n    var oldRevNum = parseInt(parts[0], 10);\n\n    var newRevNum = oldRevNum + 1;\n    var newRevId = rev$$1();\n\n    doc._revisions = {\n      start: newRevNum,\n      ids: [newRevId, oldRevId]\n    };\n    doc._rev = newRevNum + '-' + newRevId;\n    opts.new_edits = false;\n  }\n  function putDoc(next) {\n    if (typeof self._put === 'function' && opts.new_edits !== false) {\n      self._put(doc, opts, next);\n    } else {\n      self.bulkDocs({docs: [doc]}, opts, yankError(next, doc._id));\n    }\n  }\n});\n\nAbstractPouchDB.prototype.putAttachment =\n  adapterFun('putAttachment', function (docId, attachmentId, rev,\n                                              blob, type) {\n  var api = this;\n  if (typeof type === 'function') {\n    type = blob;\n    blob = rev;\n    rev = null;\n  }\n  // Lets fix in https://github.com/pouchdb/pouchdb/issues/3267\n  /* istanbul ignore if */\n  if (typeof type === 'undefined') {\n    type = blob;\n    blob = rev;\n    rev = null;\n  }\n  if (!type) {\n    guardedConsole('warn', 'Attachment', attachmentId, 'on document', docId, 'is missing content_type');\n  }\n\n  function createAttachment(doc) {\n    var prevrevpos = '_rev' in doc ? parseInt(doc._rev, 10) : 0;\n    doc._attachments = doc._attachments || {};\n    doc._attachments[attachmentId] = {\n      content_type: type,\n      data: blob,\n      revpos: ++prevrevpos\n    };\n    return api.put(doc);\n  }\n\n  return api.get(docId).then(function (doc) {\n    if (doc._rev !== rev) {\n      throw createError(REV_CONFLICT);\n    }\n\n    return createAttachment(doc);\n  }, function (err) {\n     // create new doc\n    /* istanbul ignore else */\n    if (err.reason === MISSING_DOC.message) {\n      return createAttachment({_id: docId});\n    } else {\n      throw err;\n    }\n  });\n});\n\nAbstractPouchDB.prototype.removeAttachment =\n  adapterFun('removeAttachment', function (docId, attachmentId, rev,\n                                                 callback) {\n  var self = this;\n  self.get(docId, function (err, obj) {\n    /* istanbul ignore if */\n    if (err) {\n      callback(err);\n      return;\n    }\n    if (obj._rev !== rev) {\n      callback(createError(REV_CONFLICT));\n      return;\n    }\n    /* istanbul ignore if */\n    if (!obj._attachments) {\n      return callback();\n    }\n    delete obj._attachments[attachmentId];\n    if (Object.keys(obj._attachments).length === 0) {\n      delete obj._attachments;\n    }\n    self.put(obj, callback);\n  });\n});\n\nAbstractPouchDB.prototype.remove =\n  adapterFun('remove', function (docOrId, optsOrRev, opts, callback) {\n  var doc;\n  if (typeof optsOrRev === 'string') {\n    // id, rev, opts, callback style\n    doc = {\n      _id: docOrId,\n      _rev: optsOrRev\n    };\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n  } else {\n    // doc, opts, callback style\n    doc = docOrId;\n    if (typeof optsOrRev === 'function') {\n      callback = optsOrRev;\n      opts = {};\n    } else {\n      callback = opts;\n      opts = optsOrRev;\n    }\n  }\n  opts = opts || {};\n  opts.was_delete = true;\n  var newDoc = {_id: doc._id, _rev: (doc._rev || opts.rev)};\n  newDoc._deleted = true;\n  if (isLocalId(newDoc._id) && typeof this._removeLocal === 'function') {\n    return this._removeLocal(doc, callback);\n  }\n  this.bulkDocs({docs: [newDoc]}, opts, yankError(callback, newDoc._id));\n});\n\nAbstractPouchDB.prototype.revsDiff =\n  adapterFun('revsDiff', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  var ids = Object.keys(req);\n\n  if (!ids.length) {\n    return callback(null, {});\n  }\n\n  var count = 0;\n  var missing = new ExportedMap();\n\n  function addToMissing(id, revId) {\n    if (!missing.has(id)) {\n      missing.set(id, {missing: []});\n    }\n    missing.get(id).missing.push(revId);\n  }\n\n  function processDoc(id, rev_tree) {\n    // Is this fast enough? Maybe we should switch to a set simulated by a map\n    var missingForId = req[id].slice(0);\n    traverseRevTree(rev_tree, function (isLeaf, pos, revHash, ctx,\n      opts) {\n        var rev = pos + '-' + revHash;\n        var idx = missingForId.indexOf(rev);\n        if (idx === -1) {\n          return;\n        }\n\n        missingForId.splice(idx, 1);\n        /* istanbul ignore if */\n        if (opts.status !== 'available') {\n          addToMissing(id, rev);\n        }\n      });\n\n    // Traversing the tree is synchronous, so now `missingForId` contains\n    // revisions that were not found in the tree\n    missingForId.forEach(function (rev) {\n      addToMissing(id, rev);\n    });\n  }\n\n  ids.map(function (id) {\n    this._getRevisionTree(id, function (err, rev_tree) {\n      if (err && err.status === 404 && err.message === 'missing') {\n        missing.set(id, {missing: req[id]});\n      } else if (err) {\n        /* istanbul ignore next */\n        return callback(err);\n      } else {\n        processDoc(id, rev_tree);\n      }\n\n      if (++count === ids.length) {\n        // convert LazyMap to object\n        var missingObj = {};\n        missing.forEach(function (value, key) {\n          missingObj[key] = value;\n        });\n        return callback(null, missingObj);\n      }\n    });\n  }, this);\n});\n\n// _bulk_get API for faster replication, as described in\n// https://github.com/apache/couchdb-chttpd/pull/33\n// At the \"abstract\" level, it will just run multiple get()s in\n// parallel, because this isn't much of a performance cost\n// for local databases (except the cost of multiple transactions, which is\n// small). The http adapter overrides this in order\n// to do a more efficient single HTTP request.\nAbstractPouchDB.prototype.bulkGet =\n  adapterFun('bulkGet', function (opts, callback) {\n  bulkGet(this, opts, callback);\n});\n\n// compact one document and fire callback\n// by compacting we mean removing all revisions which\n// are further from the leaf in revision tree than max_height\nAbstractPouchDB.prototype.compactDocument =\n  adapterFun('compactDocument', function (docId, maxHeight, callback) {\n  var self = this;\n  this._getRevisionTree(docId, function (err, revTree) {\n    /* istanbul ignore if */\n    if (err) {\n      return callback(err);\n    }\n    var height = computeHeight(revTree);\n    var candidates = [];\n    var revs = [];\n    Object.keys(height).forEach(function (rev) {\n      if (height[rev] > maxHeight) {\n        candidates.push(rev);\n      }\n    });\n\n    traverseRevTree(revTree, function (isLeaf, pos, revHash, ctx, opts) {\n      var rev = pos + '-' + revHash;\n      if (opts.status === 'available' && candidates.indexOf(rev) !== -1) {\n        revs.push(rev);\n      }\n    });\n    self._doCompaction(docId, revs, callback);\n  });\n});\n\n// compact the whole database using single document\n// compaction\nAbstractPouchDB.prototype.compact =\n  adapterFun('compact', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  self._compactionQueue = self._compactionQueue || [];\n  self._compactionQueue.push({opts: opts, callback: callback});\n  if (self._compactionQueue.length === 1) {\n    doNextCompaction(self);\n  }\n});\nAbstractPouchDB.prototype._compact = function (opts, callback) {\n  var self = this;\n  var changesOpts = {\n    return_docs: false,\n    last_seq: opts.last_seq || 0\n  };\n  var promises = [];\n\n  function onChange(row) {\n    promises.push(self.compactDocument(row.id, 0));\n  }\n  function onComplete(resp) {\n    var lastSeq = resp.last_seq;\n    Promise.all(promises).then(function () {\n      return upsert(self, '_local/compaction', function deltaFunc(doc) {\n        if (!doc.last_seq || doc.last_seq < lastSeq) {\n          doc.last_seq = lastSeq;\n          return doc;\n        }\n        return false; // somebody else got here first, don't update\n      });\n    }).then(function () {\n      callback(null, {ok: true});\n    }).catch(callback);\n  }\n  self.changes(changesOpts)\n    .on('change', onChange)\n    .on('complete', onComplete)\n    .on('error', callback);\n};\n\n/* Begin api wrappers. Specific functionality to storage belongs in the\n   _[method] */\nAbstractPouchDB.prototype.get = adapterFun('get', function (id, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof id !== 'string') {\n    return cb(createError(INVALID_ID));\n  }\n  if (isLocalId(id) && typeof this._getLocal === 'function') {\n    return this._getLocal(id, cb);\n  }\n  var leaves = [], self = this;\n\n  function finishOpenRevs() {\n    var result = [];\n    var count = leaves.length;\n    /* istanbul ignore if */\n    if (!count) {\n      return cb(null, result);\n    }\n\n    // order with open_revs is unspecified\n    leaves.forEach(function (leaf) {\n      self.get(id, {\n        rev: leaf,\n        revs: opts.revs,\n        latest: opts.latest,\n        attachments: opts.attachments,\n        binary: opts.binary\n      }, function (err, doc) {\n        if (!err) {\n          // using latest=true can produce duplicates\n          var existing;\n          for (var i = 0, l = result.length; i < l; i++) {\n            if (result[i].ok && result[i].ok._rev === doc._rev) {\n              existing = true;\n              break;\n            }\n          }\n          if (!existing) {\n            result.push({ok: doc});\n          }\n        } else {\n          result.push({missing: leaf});\n        }\n        count--;\n        if (!count) {\n          cb(null, result);\n        }\n      });\n    });\n  }\n\n  if (opts.open_revs) {\n    if (opts.open_revs === \"all\") {\n      this._getRevisionTree(id, function (err, rev_tree) {\n        /* istanbul ignore if */\n        if (err) {\n          return cb(err);\n        }\n        leaves = collectLeaves(rev_tree).map(function (leaf) {\n          return leaf.rev;\n        });\n        finishOpenRevs();\n      });\n    } else {\n      if (Array.isArray(opts.open_revs)) {\n        leaves = opts.open_revs;\n        for (var i = 0; i < leaves.length; i++) {\n          var l = leaves[i];\n          // looks like it's the only thing couchdb checks\n          if (!(typeof (l) === \"string\" && /^\\d+-/.test(l))) {\n            return cb(createError(INVALID_REV));\n          }\n        }\n        finishOpenRevs();\n      } else {\n        return cb(createError(UNKNOWN_ERROR, 'function_clause'));\n      }\n    }\n    return; // open_revs does not like other options\n  }\n\n  return this._get(id, opts, function (err, result) {\n    if (err) {\n      err.docId = id;\n      return cb(err);\n    }\n\n    var doc = result.doc;\n    var metadata = result.metadata;\n    var ctx = result.ctx;\n\n    if (opts.conflicts) {\n      var conflicts = collectConflicts(metadata);\n      if (conflicts.length) {\n        doc._conflicts = conflicts;\n      }\n    }\n\n    if (isDeleted(metadata, doc._rev)) {\n      doc._deleted = true;\n    }\n\n    if (opts.revs || opts.revs_info) {\n      var splittedRev = doc._rev.split('-');\n      var revNo       = parseInt(splittedRev[0], 10);\n      var revHash     = splittedRev[1];\n\n      var paths = rootToLeaf(metadata.rev_tree);\n      var path = null;\n\n      for (var i = 0; i < paths.length; i++) {\n        var currentPath = paths[i];\n        var hashIndex = currentPath.ids.map(function (x) { return x.id; })\n          .indexOf(revHash);\n        var hashFoundAtRevPos = hashIndex === (revNo - 1);\n\n        if (hashFoundAtRevPos || (!path && hashIndex !== -1)) {\n          path = currentPath;\n        }\n      }\n\n      var indexOfRev = path.ids.map(function (x) { return x.id; })\n        .indexOf(doc._rev.split('-')[1]) + 1;\n      var howMany = path.ids.length - indexOfRev;\n      path.ids.splice(indexOfRev, howMany);\n      path.ids.reverse();\n\n      if (opts.revs) {\n        doc._revisions = {\n          start: (path.pos + path.ids.length) - 1,\n          ids: path.ids.map(function (rev) {\n            return rev.id;\n          })\n        };\n      }\n      if (opts.revs_info) {\n        var pos =  path.pos + path.ids.length;\n        doc._revs_info = path.ids.map(function (rev) {\n          pos--;\n          return {\n            rev: pos + '-' + rev.id,\n            status: rev.opts.status\n          };\n        });\n      }\n    }\n\n    if (opts.attachments && doc._attachments) {\n      var attachments = doc._attachments;\n      var count = Object.keys(attachments).length;\n      if (count === 0) {\n        return cb(null, doc);\n      }\n      Object.keys(attachments).forEach(function (key) {\n        this._getAttachment(doc._id, key, attachments[key], {\n          // Previously the revision handling was done in adapter.js\n          // getAttachment, however since idb-next doesnt we need to\n          // pass the rev through\n          rev: doc._rev,\n          binary: opts.binary,\n          ctx: ctx\n        }, function (err, data) {\n          var att = doc._attachments[key];\n          att.data = data;\n          delete att.stub;\n          delete att.length;\n          if (!--count) {\n            cb(null, doc);\n          }\n        });\n      }, self);\n    } else {\n      if (doc._attachments) {\n        for (var key in doc._attachments) {\n          /* istanbul ignore else */\n          if (doc._attachments.hasOwnProperty(key)) {\n            doc._attachments[key].stub = true;\n          }\n        }\n      }\n      cb(null, doc);\n    }\n  });\n});\n\n// TODO: I dont like this, it forces an extra read for every\n// attachment read and enforces a confusing api between\n// adapter.js and the adapter implementation\nAbstractPouchDB.prototype.getAttachment =\n  adapterFun('getAttachment', function (docId, attachmentId, opts, callback) {\n  var self = this;\n  if (opts instanceof Function) {\n    callback = opts;\n    opts = {};\n  }\n  this._get(docId, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (res.doc._attachments && res.doc._attachments[attachmentId]) {\n      opts.ctx = res.ctx;\n      opts.binary = true;\n      self._getAttachment(docId, attachmentId,\n                          res.doc._attachments[attachmentId], opts, callback);\n    } else {\n      return callback(createError(MISSING_DOC));\n    }\n  });\n});\n\nAbstractPouchDB.prototype.allDocs =\n  adapterFun('allDocs', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  opts.skip = typeof opts.skip !== 'undefined' ? opts.skip : 0;\n  if (opts.start_key) {\n    opts.startkey = opts.start_key;\n  }\n  if (opts.end_key) {\n    opts.endkey = opts.end_key;\n  }\n  if ('keys' in opts) {\n    if (!Array.isArray(opts.keys)) {\n      return callback(new TypeError('options.keys must be an array'));\n    }\n    var incompatibleOpt =\n      ['startkey', 'endkey', 'key'].filter(function (incompatibleOpt) {\n      return incompatibleOpt in opts;\n    })[0];\n    if (incompatibleOpt) {\n      callback(createError(QUERY_PARSE_ERROR,\n        'Query parameter `' + incompatibleOpt +\n        '` is not compatible with multi-get'\n      ));\n      return;\n    }\n    if (!isRemote(this)) {\n      allDocsKeysParse(opts);\n      if (opts.keys.length === 0) {\n        return this._allDocs({limit: 0}, callback);\n      }\n    }\n  }\n\n  return this._allDocs(opts, callback);\n});\n\nAbstractPouchDB.prototype.changes = function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  // By default set return_docs to false if the caller has opts.live = true,\n  // this will prevent us from collecting the set of changes indefinitely\n  // resulting in growing memory\n  opts.return_docs = ('return_docs' in opts) ? opts.return_docs : !opts.live;\n\n  return new Changes$1(this, opts, callback);\n};\n\nAbstractPouchDB.prototype.close = adapterFun('close', function (callback) {\n  this._closed = true;\n  this.emit('closed');\n  return this._close(callback);\n});\n\nAbstractPouchDB.prototype.info = adapterFun('info', function (callback) {\n  var self = this;\n  this._info(function (err, info) {\n    if (err) {\n      return callback(err);\n    }\n    // assume we know better than the adapter, unless it informs us\n    info.db_name = info.db_name || self.name;\n    info.auto_compaction = !!(self.auto_compaction && !isRemote(self));\n    info.adapter = self.adapter;\n    callback(null, info);\n  });\n});\n\nAbstractPouchDB.prototype.id = adapterFun('id', function (callback) {\n  return this._id(callback);\n});\n\n/* istanbul ignore next */\nAbstractPouchDB.prototype.type = function () {\n  return (typeof this._type === 'function') ? this._type() : this.adapter;\n};\n\nAbstractPouchDB.prototype.bulkDocs =\n  adapterFun('bulkDocs', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  if (Array.isArray(req)) {\n    req = {\n      docs: req\n    };\n  }\n\n  if (!req || !req.docs || !Array.isArray(req.docs)) {\n    return callback(createError(MISSING_BULK_DOCS));\n  }\n\n  for (var i = 0; i < req.docs.length; ++i) {\n    if (typeof req.docs[i] !== 'object' || Array.isArray(req.docs[i])) {\n      return callback(createError(NOT_AN_OBJECT));\n    }\n  }\n\n  var attachmentError;\n  req.docs.forEach(function (doc) {\n    if (doc._attachments) {\n      Object.keys(doc._attachments).forEach(function (name) {\n        attachmentError = attachmentError || attachmentNameError(name);\n        if (!doc._attachments[name].content_type) {\n          guardedConsole('warn', 'Attachment', name, 'on document', doc._id, 'is missing content_type');\n        }\n      });\n    }\n  });\n\n  if (attachmentError) {\n    return callback(createError(BAD_REQUEST, attachmentError));\n  }\n\n  if (!('new_edits' in opts)) {\n    if ('new_edits' in req) {\n      opts.new_edits = req.new_edits;\n    } else {\n      opts.new_edits = true;\n    }\n  }\n\n  var adapter = this;\n  if (!opts.new_edits && !isRemote(adapter)) {\n    // ensure revisions of the same doc are sorted, so that\n    // the local adapter processes them correctly (#2935)\n    req.docs.sort(compareByIdThenRev);\n  }\n\n  cleanDocs(req.docs);\n\n  // in the case of conflicts, we want to return the _ids to the user\n  // however, the underlying adapter may destroy the docs array, so\n  // create a copy here\n  var ids = req.docs.map(function (doc) {\n    return doc._id;\n  });\n\n  return this._bulkDocs(req, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (!opts.new_edits) {\n      // this is what couch does when new_edits is false\n      res = res.filter(function (x) {\n        return x.error;\n      });\n    }\n    // add ids for error/conflict responses (not required for CouchDB)\n    if (!isRemote(adapter)) {\n      for (var i = 0, l = res.length; i < l; i++) {\n        res[i].id = res[i].id || ids[i];\n      }\n    }\n\n    callback(null, res);\n  });\n});\n\nAbstractPouchDB.prototype.registerDependentDatabase =\n  adapterFun('registerDependentDatabase', function (dependentDb,\n                                                          callback) {\n  var depDB = new this.constructor(dependentDb, this.__opts);\n\n  function diffFun(doc) {\n    doc.dependentDbs = doc.dependentDbs || {};\n    if (doc.dependentDbs[dependentDb]) {\n      return false; // no update required\n    }\n    doc.dependentDbs[dependentDb] = true;\n    return doc;\n  }\n  upsert(this, '_local/_pouch_dependentDbs', diffFun)\n    .then(function () {\n      callback(null, {db: depDB});\n    }).catch(callback);\n});\n\nAbstractPouchDB.prototype.destroy =\n  adapterFun('destroy', function (opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  var usePrefix = 'use_prefix' in self ? self.use_prefix : true;\n\n  function destroyDb() {\n    // call destroy method of the particular adaptor\n    self._destroy(opts, function (err, resp) {\n      if (err) {\n        return callback(err);\n      }\n      self._destroyed = true;\n      self.emit('destroyed');\n      callback(null, resp || { 'ok': true });\n    });\n  }\n\n  if (isRemote(self)) {\n    // no need to check for dependent DBs if it's a remote DB\n    return destroyDb();\n  }\n\n  self.get('_local/_pouch_dependentDbs', function (err, localDoc) {\n    if (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        return callback(err);\n      } else { // no dependencies\n        return destroyDb();\n      }\n    }\n    var dependentDbs = localDoc.dependentDbs;\n    var PouchDB = self.constructor;\n    var deletedMap = Object.keys(dependentDbs).map(function (name) {\n      // use_prefix is only false in the browser\n      /* istanbul ignore next */\n      var trueName = usePrefix ?\n        name.replace(new RegExp('^' + PouchDB.prefix), '') : name;\n      return new PouchDB(trueName, self.__opts).destroy();\n    });\n    Promise.all(deletedMap).then(destroyDb, callback);\n  });\n});\n\nfunction TaskQueue() {\n  this.isReady = false;\n  this.failed = false;\n  this.queue = [];\n}\n\nTaskQueue.prototype.execute = function () {\n  var fun;\n  if (this.failed) {\n    while ((fun = this.queue.shift())) {\n      fun(this.failed);\n    }\n  } else {\n    while ((fun = this.queue.shift())) {\n      fun();\n    }\n  }\n};\n\nTaskQueue.prototype.fail = function (err) {\n  this.failed = err;\n  this.execute();\n};\n\nTaskQueue.prototype.ready = function (db) {\n  this.isReady = true;\n  this.db = db;\n  this.execute();\n};\n\nTaskQueue.prototype.addTask = function (fun) {\n  this.queue.push(fun);\n  if (this.failed) {\n    this.execute();\n  }\n};\n\nfunction parseAdapter(name, opts) {\n  var match = name.match(/([a-z-]*):\\/\\/(.*)/);\n  if (match) {\n    // the http adapter expects the fully qualified name\n    return {\n      name: /https?/.test(match[1]) ? match[1] + '://' + match[2] : match[2],\n      adapter: match[1]\n    };\n  }\n\n  var adapters = PouchDB.adapters;\n  var preferredAdapters = PouchDB.preferredAdapters;\n  var prefix = PouchDB.prefix;\n  var adapterName = opts.adapter;\n\n  if (!adapterName) { // automatically determine adapter\n    for (var i = 0; i < preferredAdapters.length; ++i) {\n      adapterName = preferredAdapters[i];\n      // check for browsers that have been upgraded from websql-only to websql+idb\n      /* istanbul ignore if */\n      if (adapterName === 'idb' && 'websql' in adapters &&\n          hasLocalStorage() && localStorage['_pouch__websqldb_' + prefix + name]) {\n        // log it, because this can be confusing during development\n        guardedConsole('log', 'PouchDB is downgrading \"' + name + '\" to WebSQL to' +\n          ' avoid data loss, because it was already opened with WebSQL.');\n        continue; // keep using websql to avoid user data loss\n      }\n      break;\n    }\n  }\n\n  var adapter = adapters[adapterName];\n\n  // if adapter is invalid, then an error will be thrown later\n  var usePrefix = (adapter && 'use_prefix' in adapter) ?\n    adapter.use_prefix : true;\n\n  return {\n    name: usePrefix ? (prefix + name) : name,\n    adapter: adapterName\n  };\n}\n\n// OK, so here's the deal. Consider this code:\n//     var db1 = new PouchDB('foo');\n//     var db2 = new PouchDB('foo');\n//     db1.destroy();\n// ^ these two both need to emit 'destroyed' events,\n// as well as the PouchDB constructor itself.\n// So we have one db object (whichever one got destroy() called on it)\n// responsible for emitting the initial event, which then gets emitted\n// by the constructor, which then broadcasts it to any other dbs\n// that may have been created with the same name.\nfunction prepareForDestruction(self) {\n\n  function onDestroyed(from_constructor) {\n    self.removeListener('closed', onClosed);\n    if (!from_constructor) {\n      self.constructor.emit('destroyed', self.name);\n    }\n  }\n\n  function onClosed() {\n    self.removeListener('destroyed', onDestroyed);\n    self.constructor.emit('unref', self);\n  }\n\n  self.once('destroyed', onDestroyed);\n  self.once('closed', onClosed);\n  self.constructor.emit('ref', self);\n}\n\ninherits(PouchDB, AbstractPouchDB);\nfunction PouchDB(name, opts) {\n  // In Node our test suite only tests this for PouchAlt unfortunately\n  /* istanbul ignore if */\n  if (!(this instanceof PouchDB)) {\n    return new PouchDB(name, opts);\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  if (name && typeof name === 'object') {\n    opts = name;\n    name = opts.name;\n    delete opts.name;\n  }\n\n  if (opts.deterministic_revs === undefined) {\n    opts.deterministic_revs = true;\n  }\n\n  this.__opts = opts = clone(opts);\n\n  self.auto_compaction = opts.auto_compaction;\n  self.prefix = PouchDB.prefix;\n\n  if (typeof name !== 'string') {\n    throw new Error('Missing/invalid DB name');\n  }\n\n  var prefixedName = (opts.prefix || '') + name;\n  var backend = parseAdapter(prefixedName, opts);\n\n  opts.name = backend.name;\n  opts.adapter = opts.adapter || backend.adapter;\n\n  self.name = name;\n  self._adapter = opts.adapter;\n  PouchDB.emit('debug', ['adapter', 'Picked adapter: ', opts.adapter]);\n\n  if (!PouchDB.adapters[opts.adapter] ||\n      !PouchDB.adapters[opts.adapter].valid()) {\n    throw new Error('Invalid Adapter: ' + opts.adapter);\n  }\n\n  AbstractPouchDB.call(self);\n  self.taskqueue = new TaskQueue();\n\n  self.adapter = opts.adapter;\n\n  PouchDB.adapters[opts.adapter].call(self, opts, function (err) {\n    if (err) {\n      return self.taskqueue.fail(err);\n    }\n    prepareForDestruction(self);\n\n    self.emit('created', self);\n    PouchDB.emit('created', self.name);\n    self.taskqueue.ready(self);\n  });\n\n}\n\n// AbortController was introduced quite a while after fetch and\n// isnt required for PouchDB to function so polyfill if needed\nvar a = (typeof AbortController !== 'undefined')\n    ? AbortController\n    : function () { return {abort: function () {}}; };\n\nvar f$1 = fetch;\nvar h = Headers;\n\nPouchDB.adapters = {};\nPouchDB.preferredAdapters = [];\n\nPouchDB.prefix = '_pouch_';\n\nvar eventEmitter = new EventEmitter();\n\nfunction setUpEventEmitter(Pouch) {\n  Object.keys(EventEmitter.prototype).forEach(function (key) {\n    if (typeof EventEmitter.prototype[key] === 'function') {\n      Pouch[key] = eventEmitter[key].bind(eventEmitter);\n    }\n  });\n\n  // these are created in constructor.js, and allow us to notify each DB with\n  // the same name that it was destroyed, via the constructor object\n  var destructListeners = Pouch._destructionListeners = new ExportedMap();\n\n  Pouch.on('ref', function onConstructorRef(db) {\n    if (!destructListeners.has(db.name)) {\n      destructListeners.set(db.name, []);\n    }\n    destructListeners.get(db.name).push(db);\n  });\n\n  Pouch.on('unref', function onConstructorUnref(db) {\n    if (!destructListeners.has(db.name)) {\n      return;\n    }\n    var dbList = destructListeners.get(db.name);\n    var pos = dbList.indexOf(db);\n    if (pos < 0) {\n      /* istanbul ignore next */\n      return;\n    }\n    dbList.splice(pos, 1);\n    if (dbList.length > 1) {\n      /* istanbul ignore next */\n      destructListeners.set(db.name, dbList);\n    } else {\n      destructListeners.delete(db.name);\n    }\n  });\n\n  Pouch.on('destroyed', function onConstructorDestroyed(name) {\n    if (!destructListeners.has(name)) {\n      return;\n    }\n    var dbList = destructListeners.get(name);\n    destructListeners.delete(name);\n    dbList.forEach(function (db) {\n      db.emit('destroyed',true);\n    });\n  });\n}\n\nsetUpEventEmitter(PouchDB);\n\nPouchDB.adapter = function (id, obj, addToPreferredAdapters) {\n  /* istanbul ignore else */\n  if (obj.valid()) {\n    PouchDB.adapters[id] = obj;\n    if (addToPreferredAdapters) {\n      PouchDB.preferredAdapters.push(id);\n    }\n  }\n};\n\nPouchDB.plugin = function (obj) {\n  if (typeof obj === 'function') { // function style for plugins\n    obj(PouchDB);\n  } else if (typeof obj !== 'object' || Object.keys(obj).length === 0) {\n    throw new Error('Invalid plugin: got \"' + obj + '\", expected an object or a function');\n  } else {\n    Object.keys(obj).forEach(function (id) { // object style for plugins\n      PouchDB.prototype[id] = obj[id];\n    });\n  }\n  if (this.__defaults) {\n    PouchDB.__defaults = $inject_Object_assign({}, this.__defaults);\n  }\n  return PouchDB;\n};\n\nPouchDB.defaults = function (defaultOpts) {\n  function PouchAlt(name, opts) {\n    if (!(this instanceof PouchAlt)) {\n      return new PouchAlt(name, opts);\n    }\n\n    opts = opts || {};\n\n    if (name && typeof name === 'object') {\n      opts = name;\n      name = opts.name;\n      delete opts.name;\n    }\n\n    opts = $inject_Object_assign({}, PouchAlt.__defaults, opts);\n    PouchDB.call(this, name, opts);\n  }\n\n  inherits(PouchAlt, PouchDB);\n\n  PouchAlt.preferredAdapters = PouchDB.preferredAdapters.slice();\n  Object.keys(PouchDB).forEach(function (key) {\n    if (!(key in PouchAlt)) {\n      PouchAlt[key] = PouchDB[key];\n    }\n  });\n\n  // make default options transitive\n  // https://github.com/pouchdb/pouchdb/issues/5922\n  PouchAlt.__defaults = $inject_Object_assign({}, this.__defaults, defaultOpts);\n\n  return PouchAlt;\n};\n\nPouchDB.fetch = function (url, opts) {\n  return f$1(url, opts);\n};\n\n// managed automatically by set-version.js\nvar version = \"7.0.0\";\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction compare$1(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n  if ('$and' in result) {\n    result = mergeAndedSelectors(result['$and']);\n    wasAnded = true;\n  }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\nfunction pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare$1(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  return Object.keys(matcher).every(function (userOperator) {\n    var userValue = matcher[userOperator];\n    return match(userOperator, doc, userValue, parsedField, docFieldValue);\n  });\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nfunction evalFilter(input) {\n  return scopeEval('\"use strict\";\\nreturn ' + input + ';', {});\n}\n\nfunction evalView(input) {\n  var code = [\n    'return function(doc) {',\n    '  \"use strict\";',\n    '  var emitted = false;',\n    '  var emit = function (a, b) {',\n    '    emitted = true;',\n    '  };',\n    '  var view = ' + input + ';',\n    '  view(doc);',\n    '  if (emitted) {',\n    '    return true;',\n    '  }',\n    '};'\n  ].join('\\n');\n\n  return scopeEval(code, {});\n}\n\nfunction validate(opts, callback) {\n  if (opts.selector) {\n    if (opts.filter && opts.filter !== '_selector') {\n      var filterName = typeof opts.filter === 'string' ?\n        opts.filter : 'function';\n      return callback(new Error('selector invalid for filter \"' + filterName + '\"'));\n    }\n  }\n  callback();\n}\n\nfunction normalize(opts) {\n  if (opts.view && !opts.filter) {\n    opts.filter = '_view';\n  }\n\n  if (opts.selector && !opts.filter) {\n    opts.filter = '_selector';\n  }\n\n  if (opts.filter && typeof opts.filter === 'string') {\n    if (opts.filter === '_view') {\n      opts.view = normalizeDesignDocFunctionName(opts.view);\n    } else {\n      opts.filter = normalizeDesignDocFunctionName(opts.filter);\n    }\n  }\n}\n\nfunction shouldFilter(changesHandler, opts) {\n  return opts.filter && typeof opts.filter === 'string' &&\n    !opts.doc_ids && !isRemote(changesHandler.db);\n}\n\nfunction filter(changesHandler, opts) {\n  var callback = opts.complete;\n  if (opts.filter === '_view') {\n    if (!opts.view || typeof opts.view !== 'string') {\n      var err = createError(BAD_REQUEST,\n        '`view` filter parameter not found or invalid.');\n      return callback(err);\n    }\n    // fetch a view from a design doc, make it behave like a filter\n    var viewName = parseDesignDocFunctionName(opts.view);\n    changesHandler.db.get('_design/' + viewName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var mapFun = ddoc && ddoc.views && ddoc.views[viewName[1]] &&\n        ddoc.views[viewName[1]].map;\n      if (!mapFun) {\n        return callback(createError(MISSING_DOC,\n          (ddoc.views ? 'missing json key: ' + viewName[1] :\n            'missing json key: views')));\n      }\n      opts.filter = evalView(mapFun);\n      changesHandler.doChanges(opts);\n    });\n  } else if (opts.selector) {\n    opts.filter = function (doc) {\n      return matchesSelector(doc, opts.selector);\n    };\n    changesHandler.doChanges(opts);\n  } else {\n    // fetch a filter from a design doc\n    var filterName = parseDesignDocFunctionName(opts.filter);\n    changesHandler.db.get('_design/' + filterName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var filterFun = ddoc && ddoc.filters && ddoc.filters[filterName[1]];\n      if (!filterFun) {\n        return callback(createError(MISSING_DOC,\n          ((ddoc && ddoc.filters) ? 'missing json key: ' + filterName[1]\n            : 'missing json key: filters')));\n      }\n      opts.filter = evalFilter(filterFun);\n      changesHandler.doChanges(opts);\n    });\n  }\n}\n\nfunction applyChangesFilterPlugin(PouchDB) {\n  PouchDB._changesFilterPlugin = {\n    validate: validate,\n    normalize: normalize,\n    shouldFilter: shouldFilter,\n    filter: filter\n  };\n}\n\n// TODO: remove from pouchdb-core (breaking)\nPouchDB.plugin(applyChangesFilterPlugin);\n\nPouchDB.version = version;\n\nfunction toObject(array) {\n  return array.reduce(function (obj, item) {\n    obj[item] = true;\n    return obj;\n  }, {});\n}\n// List of top level reserved words for doc\nvar reservedWords = toObject([\n  '_id',\n  '_rev',\n  '_attachments',\n  '_deleted',\n  '_revisions',\n  '_revs_info',\n  '_conflicts',\n  '_deleted_conflicts',\n  '_local_seq',\n  '_rev_tree',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats',\n  // Specific to Couchbase Sync Gateway\n  '_removed'\n]);\n\n// List of reserved words that should end up the document\nvar dataWords = toObject([\n  '_attachments',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats'\n]);\n\nfunction parseRevisionInfo(rev) {\n  if (!/^\\d+-./.test(rev)) {\n    return createError(INVALID_REV);\n  }\n  var idx = rev.indexOf('-');\n  var left = rev.substring(0, idx);\n  var right = rev.substring(idx + 1);\n  return {\n    prefix: parseInt(left, 10),\n    id: right\n  };\n}\n\nfunction makeRevTreeFromRevisions(revisions, opts) {\n  var pos = revisions.start - revisions.ids.length + 1;\n\n  var revisionIds = revisions.ids;\n  var ids = [revisionIds[0], opts, []];\n\n  for (var i = 1, len = revisionIds.length; i < len; i++) {\n    ids = [revisionIds[i], {status: 'missing'}, [ids]];\n  }\n\n  return [{\n    pos: pos,\n    ids: ids\n  }];\n}\n\n// Preprocess documents, parse their revisions, assign an id and a\n// revision for new writes that are missing them, etc\nfunction parseDoc(doc, newEdits, dbOpts) {\n  if (!dbOpts) {\n    dbOpts = {\n      deterministic_revs: true\n    };\n  }\n\n  var nRevNum;\n  var newRevId;\n  var revInfo;\n  var opts = {status: 'available'};\n  if (doc._deleted) {\n    opts.deleted = true;\n  }\n\n  if (newEdits) {\n    if (!doc._id) {\n      doc._id = uuid();\n    }\n    newRevId = rev$$1(doc, dbOpts.deterministic_revs);\n    if (doc._rev) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      doc._rev_tree = [{\n        pos: revInfo.prefix,\n        ids: [revInfo.id, {status: 'missing'}, [[newRevId, opts, []]]]\n      }];\n      nRevNum = revInfo.prefix + 1;\n    } else {\n      doc._rev_tree = [{\n        pos: 1,\n        ids : [newRevId, opts, []]\n      }];\n      nRevNum = 1;\n    }\n  } else {\n    if (doc._revisions) {\n      doc._rev_tree = makeRevTreeFromRevisions(doc._revisions, opts);\n      nRevNum = doc._revisions.start;\n      newRevId = doc._revisions.ids[0];\n    }\n    if (!doc._rev_tree) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      nRevNum = revInfo.prefix;\n      newRevId = revInfo.id;\n      doc._rev_tree = [{\n        pos: nRevNum,\n        ids: [newRevId, opts, []]\n      }];\n    }\n  }\n\n  invalidIdError(doc._id);\n\n  doc._rev = nRevNum + '-' + newRevId;\n\n  var result = {metadata : {}, data : {}};\n  for (var key in doc) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(doc, key)) {\n      var specialKey = key[0] === '_';\n      if (specialKey && !reservedWords[key]) {\n        var error = createError(DOC_VALIDATION, key);\n        error.message = DOC_VALIDATION.message + ': ' + key;\n        throw error;\n      } else if (specialKey && !dataWords[key]) {\n        result.metadata[key.slice(1)] = doc[key];\n      } else {\n        result.data[key] = doc[key];\n      }\n    }\n  }\n  return result;\n}\n\nfunction parseBase64(data) {\n  try {\n    return thisAtob(data);\n  } catch (e) {\n    var err = createError(BAD_ARG,\n      'Attachment is not a valid base64 string');\n    return {error: err};\n  }\n}\n\nfunction preprocessString(att, blobType, callback) {\n  var asBinary = parseBase64(att.data);\n  if (asBinary.error) {\n    return callback(asBinary.error);\n  }\n\n  att.length = asBinary.length;\n  if (blobType === 'blob') {\n    att.data = binStringToBluffer(asBinary, att.content_type);\n  } else if (blobType === 'base64') {\n    att.data = thisBtoa(asBinary);\n  } else { // binary\n    att.data = asBinary;\n  }\n  binaryMd5(asBinary, function (result) {\n    att.digest = 'md5-' + result;\n    callback();\n  });\n}\n\nfunction preprocessBlob(att, blobType, callback) {\n  binaryMd5(att.data, function (md5) {\n    att.digest = 'md5-' + md5;\n    // size is for blobs (browser), length is for buffers (node)\n    att.length = att.data.size || att.data.length || 0;\n    if (blobType === 'binary') {\n      blobToBinaryString(att.data, function (binString) {\n        att.data = binString;\n        callback();\n      });\n    } else if (blobType === 'base64') {\n      blobToBase64(att.data, function (b64) {\n        att.data = b64;\n        callback();\n      });\n    } else {\n      callback();\n    }\n  });\n}\n\nfunction preprocessAttachment(att, blobType, callback) {\n  if (att.stub) {\n    return callback();\n  }\n  if (typeof att.data === 'string') { // input is a base64 string\n    preprocessString(att, blobType, callback);\n  } else { // input is a blob\n    preprocessBlob(att, blobType, callback);\n  }\n}\n\nfunction preprocessAttachments(docInfos, blobType, callback) {\n\n  if (!docInfos.length) {\n    return callback();\n  }\n\n  var docv = 0;\n  var overallErr;\n\n  docInfos.forEach(function (docInfo) {\n    var attachments = docInfo.data && docInfo.data._attachments ?\n      Object.keys(docInfo.data._attachments) : [];\n    var recv = 0;\n\n    if (!attachments.length) {\n      return done();\n    }\n\n    function processedAttachment(err) {\n      overallErr = err;\n      recv++;\n      if (recv === attachments.length) {\n        done();\n      }\n    }\n\n    for (var key in docInfo.data._attachments) {\n      if (docInfo.data._attachments.hasOwnProperty(key)) {\n        preprocessAttachment(docInfo.data._attachments[key],\n          blobType, processedAttachment);\n      }\n    }\n  });\n\n  function done() {\n    docv++;\n    if (docInfos.length === docv) {\n      if (overallErr) {\n        callback(overallErr);\n      } else {\n        callback();\n      }\n    }\n  }\n}\n\nfunction updateDoc(revLimit, prev, docInfo, results,\n                   i, cb, writeDoc, newEdits) {\n\n  if (revExists(prev.rev_tree, docInfo.metadata.rev) && !newEdits) {\n    results[i] = docInfo;\n    return cb();\n  }\n\n  // sometimes this is pre-calculated. historically not always\n  var previousWinningRev = prev.winningRev || winningRev(prev);\n  var previouslyDeleted = 'deleted' in prev ? prev.deleted :\n    isDeleted(prev, previousWinningRev);\n  var deleted = 'deleted' in docInfo.metadata ? docInfo.metadata.deleted :\n    isDeleted(docInfo.metadata);\n  var isRoot = /^1-/.test(docInfo.metadata.rev);\n\n  if (previouslyDeleted && !deleted && newEdits && isRoot) {\n    var newDoc = docInfo.data;\n    newDoc._rev = previousWinningRev;\n    newDoc._id = docInfo.metadata.id;\n    docInfo = parseDoc(newDoc, newEdits);\n  }\n\n  var merged = merge(prev.rev_tree, docInfo.metadata.rev_tree[0], revLimit);\n\n  var inConflict = newEdits && ((\n    (previouslyDeleted && deleted && merged.conflicts !== 'new_leaf') ||\n    (!previouslyDeleted && merged.conflicts !== 'new_leaf') ||\n    (previouslyDeleted && !deleted && merged.conflicts === 'new_branch')));\n\n  if (inConflict) {\n    var err = createError(REV_CONFLICT);\n    results[i] = err;\n    return cb();\n  }\n\n  var newRev = docInfo.metadata.rev;\n  docInfo.metadata.rev_tree = merged.tree;\n  docInfo.stemmedRevs = merged.stemmedRevs || [];\n  /* istanbul ignore else */\n  if (prev.rev_map) {\n    docInfo.metadata.rev_map = prev.rev_map; // used only by leveldb\n  }\n\n  // recalculate\n  var winningRev$$1 = winningRev(docInfo.metadata);\n  var winningRevIsDeleted = isDeleted(docInfo.metadata, winningRev$$1);\n\n  // calculate the total number of documents that were added/removed,\n  // from the perspective of total_rows/doc_count\n  var delta = (previouslyDeleted === winningRevIsDeleted) ? 0 :\n    previouslyDeleted < winningRevIsDeleted ? -1 : 1;\n\n  var newRevIsDeleted;\n  if (newRev === winningRev$$1) {\n    // if the new rev is the same as the winning rev, we can reuse that value\n    newRevIsDeleted = winningRevIsDeleted;\n  } else {\n    // if they're not the same, then we need to recalculate\n    newRevIsDeleted = isDeleted(docInfo.metadata, newRev);\n  }\n\n  writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n    true, delta, i, cb);\n}\n\nfunction rootIsMissing(docInfo) {\n  return docInfo.metadata.rev_tree[0].ids[1].status === 'missing';\n}\n\nfunction processDocs(revLimit, docInfos, api, fetchedDocs, tx, results,\n                     writeDoc, opts, overallCallback) {\n\n  // Default to 1000 locally\n  revLimit = revLimit || 1000;\n\n  function insertDoc(docInfo, resultsIdx, callback) {\n    // Cant insert new deleted documents\n    var winningRev$$1 = winningRev(docInfo.metadata);\n    var deleted = isDeleted(docInfo.metadata, winningRev$$1);\n    if ('was_delete' in opts && deleted) {\n      results[resultsIdx] = createError(MISSING_DOC, 'deleted');\n      return callback();\n    }\n\n    // 4712 - detect whether a new document was inserted with a _rev\n    var inConflict = newEdits && rootIsMissing(docInfo);\n\n    if (inConflict) {\n      var err = createError(REV_CONFLICT);\n      results[resultsIdx] = err;\n      return callback();\n    }\n\n    var delta = deleted ? 0 : 1;\n\n    writeDoc(docInfo, winningRev$$1, deleted, deleted, false,\n      delta, resultsIdx, callback);\n  }\n\n  var newEdits = opts.new_edits;\n  var idsToDocs = new ExportedMap();\n\n  var docsDone = 0;\n  var docsToDo = docInfos.length;\n\n  function checkAllDocsDone() {\n    if (++docsDone === docsToDo && overallCallback) {\n      overallCallback();\n    }\n  }\n\n  docInfos.forEach(function (currentDoc, resultsIdx) {\n\n    if (currentDoc._id && isLocalId(currentDoc._id)) {\n      var fun = currentDoc._deleted ? '_removeLocal' : '_putLocal';\n      api[fun](currentDoc, {ctx: tx}, function (err, res) {\n        results[resultsIdx] = err || res;\n        checkAllDocsDone();\n      });\n      return;\n    }\n\n    var id = currentDoc.metadata.id;\n    if (idsToDocs.has(id)) {\n      docsToDo--; // duplicate\n      idsToDocs.get(id).push([currentDoc, resultsIdx]);\n    } else {\n      idsToDocs.set(id, [[currentDoc, resultsIdx]]);\n    }\n  });\n\n  // in the case of new_edits, the user can provide multiple docs\n  // with the same id. these need to be processed sequentially\n  idsToDocs.forEach(function (docs, id) {\n    var numDone = 0;\n\n    function docWritten() {\n      if (++numDone < docs.length) {\n        nextDoc();\n      } else {\n        checkAllDocsDone();\n      }\n    }\n    function nextDoc() {\n      var value = docs[numDone];\n      var currentDoc = value[0];\n      var resultsIdx = value[1];\n\n      if (fetchedDocs.has(id)) {\n        updateDoc(revLimit, fetchedDocs.get(id), currentDoc, results,\n          resultsIdx, docWritten, writeDoc, newEdits);\n      } else {\n        // Ensure stemming applies to new writes as well\n        var merged = merge([], currentDoc.metadata.rev_tree[0], revLimit);\n        currentDoc.metadata.rev_tree = merged.tree;\n        currentDoc.stemmedRevs = merged.stemmedRevs || [];\n        insertDoc(currentDoc, resultsIdx, docWritten);\n      }\n    }\n    nextDoc();\n  });\n}\n\n// IndexedDB requires a versioned database structure, so we use the\n// version here to manage migrations.\nvar ADAPTER_VERSION = 5;\n\n// The object stores created for each database\n// DOC_STORE stores the document meta data, its revision history and state\n// Keyed by document id\nvar DOC_STORE = 'document-store';\n// BY_SEQ_STORE stores a particular version of a document, keyed by its\n// sequence id\nvar BY_SEQ_STORE = 'by-sequence';\n// Where we store attachments\nvar ATTACH_STORE = 'attach-store';\n// Where we store many-to-many relations\n// between attachment digests and seqs\nvar ATTACH_AND_SEQ_STORE = 'attach-seq-store';\n\n// Where we store database-wide meta data in a single record\n// keyed by id: META_STORE\nvar META_STORE = 'meta-store';\n// Where we store local documents\nvar LOCAL_STORE = 'local-store';\n// Where we detect blob support\nvar DETECT_BLOB_SUPPORT_STORE = 'detect-blob-support';\n\nfunction safeJsonParse(str) {\n  // This try/catch guards against stack overflow errors.\n  // JSON.parse() is faster than vuvuzela.parse() but vuvuzela\n  // cannot overflow.\n  try {\n    return JSON.parse(str);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.parse(str);\n  }\n}\n\nfunction safeJsonStringify(json) {\n  try {\n    return JSON.stringify(json);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.stringify(json);\n  }\n}\n\nfunction idbError(callback) {\n  return function (evt) {\n    var message = 'unknown_error';\n    if (evt.target && evt.target.error) {\n      message = evt.target.error.name || evt.target.error.message;\n    }\n    callback(createError(IDB_ERROR, message, evt.type));\n  };\n}\n\n// Unfortunately, the metadata has to be stringified\n// when it is put into the database, because otherwise\n// IndexedDB can throw errors for deeply-nested objects.\n// Originally we just used JSON.parse/JSON.stringify; now\n// we use this custom vuvuzela library that avoids recursion.\n// If we could do it all over again, we'd probably use a\n// format for the revision trees other than JSON.\nfunction encodeMetadata(metadata, winningRev, deleted) {\n  return {\n    data: safeJsonStringify(metadata),\n    winningRev: winningRev,\n    deletedOrLocal: deleted ? '1' : '0',\n    seq: metadata.seq, // highest seq for this doc\n    id: metadata.id\n  };\n}\n\nfunction decodeMetadata(storedObject) {\n  if (!storedObject) {\n    return null;\n  }\n  var metadata = safeJsonParse(storedObject.data);\n  metadata.winningRev = storedObject.winningRev;\n  metadata.deleted = storedObject.deletedOrLocal === '1';\n  metadata.seq = storedObject.seq;\n  return metadata;\n}\n\n// read the doc back out from the database. we don't store the\n// _id or _rev because we already have _doc_id_rev.\nfunction decodeDoc(doc) {\n  if (!doc) {\n    return doc;\n  }\n  var idx = doc._doc_id_rev.lastIndexOf(':');\n  doc._id = doc._doc_id_rev.substring(0, idx - 1);\n  doc._rev = doc._doc_id_rev.substring(idx + 1);\n  delete doc._doc_id_rev;\n  return doc;\n}\n\n// Read a blob from the database, encoding as necessary\n// and translating from base64 if the IDB doesn't support\n// native Blobs\nfunction readBlobData(body, type, asBlob, callback) {\n  if (asBlob) {\n    if (!body) {\n      callback(createBlob([''], {type: type}));\n    } else if (typeof body !== 'string') { // we have blob support\n      callback(body);\n    } else { // no blob support\n      callback(b64ToBluffer(body, type));\n    }\n  } else { // as base64 string\n    if (!body) {\n      callback('');\n    } else if (typeof body !== 'string') { // we have blob support\n      readAsBinaryString(body, function (binary) {\n        callback(thisBtoa(binary));\n      });\n    } else { // no blob support\n      callback(body);\n    }\n  }\n}\n\nfunction fetchAttachmentsIfNecessary(doc, opts, txn, cb) {\n  var attachments = Object.keys(doc._attachments || {});\n  if (!attachments.length) {\n    return cb && cb();\n  }\n  var numDone = 0;\n\n  function checkDone() {\n    if (++numDone === attachments.length && cb) {\n      cb();\n    }\n  }\n\n  function fetchAttachment(doc, att) {\n    var attObj = doc._attachments[att];\n    var digest = attObj.digest;\n    var req = txn.objectStore(ATTACH_STORE).get(digest);\n    req.onsuccess = function (e) {\n      attObj.body = e.target.result.body;\n      checkDone();\n    };\n  }\n\n  attachments.forEach(function (att) {\n    if (opts.attachments && opts.include_docs) {\n      fetchAttachment(doc, att);\n    } else {\n      doc._attachments[att].stub = true;\n      checkDone();\n    }\n  });\n}\n\n// IDB-specific postprocessing necessary because\n// we don't know whether we stored a true Blob or\n// a base64-encoded string, and if it's a Blob it\n// needs to be read outside of the transaction context\nfunction postProcessAttachments(results, asBlob) {\n  return Promise.all(results.map(function (row) {\n    if (row.doc && row.doc._attachments) {\n      var attNames = Object.keys(row.doc._attachments);\n      return Promise.all(attNames.map(function (att) {\n        var attObj = row.doc._attachments[att];\n        if (!('body' in attObj)) { // already processed\n          return;\n        }\n        var body = attObj.body;\n        var type = attObj.content_type;\n        return new Promise(function (resolve) {\n          readBlobData(body, type, asBlob, function (data) {\n            row.doc._attachments[att] = $inject_Object_assign(\n              pick(attObj, ['digest', 'content_type']),\n              {data: data}\n            );\n            resolve();\n          });\n        });\n      }));\n    }\n  }));\n}\n\nfunction compactRevs(revs, docId, txn) {\n\n  var possiblyOrphanedDigests = [];\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var attStore = txn.objectStore(ATTACH_STORE);\n  var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n  var count = revs.length;\n\n  function checkDone() {\n    count--;\n    if (!count) { // done processing all revs\n      deleteOrphanedAttachments();\n    }\n  }\n\n  function deleteOrphanedAttachments() {\n    if (!possiblyOrphanedDigests.length) {\n      return;\n    }\n    possiblyOrphanedDigests.forEach(function (digest) {\n      var countReq = attAndSeqStore.index('digestSeq').count(\n        IDBKeyRange.bound(\n          digest + '::', digest + '::\\uffff', false, false));\n      countReq.onsuccess = function (e) {\n        var count = e.target.result;\n        if (!count) {\n          // orphaned\n          attStore.delete(digest);\n        }\n      };\n    });\n  }\n\n  revs.forEach(function (rev) {\n    var index = seqStore.index('_doc_id_rev');\n    var key = docId + \"::\" + rev;\n    index.getKey(key).onsuccess = function (e) {\n      var seq = e.target.result;\n      if (typeof seq !== 'number') {\n        return checkDone();\n      }\n      seqStore.delete(seq);\n\n      var cursor = attAndSeqStore.index('seq')\n        .openCursor(IDBKeyRange.only(seq));\n\n      cursor.onsuccess = function (event) {\n        var cursor = event.target.result;\n        if (cursor) {\n          var digest = cursor.value.digestSeq.split('::')[0];\n          possiblyOrphanedDigests.push(digest);\n          attAndSeqStore.delete(cursor.primaryKey);\n          cursor.continue();\n        } else { // done\n          checkDone();\n        }\n      };\n    };\n  });\n}\n\nfunction openTransactionSafely(idb, stores, mode) {\n  try {\n    return {\n      txn: idb.transaction(stores, mode)\n    };\n  } catch (err) {\n    return {\n      error: err\n    };\n  }\n}\n\nvar changesHandler = new Changes();\n\nfunction idbBulkDocs(dbOpts, req, opts, api, idb, callback) {\n  var docInfos = req.docs;\n  var txn;\n  var docStore;\n  var bySeqStore;\n  var attachStore;\n  var attachAndSeqStore;\n  var metaStore;\n  var docInfoError;\n  var metaDoc;\n\n  for (var i = 0, len = docInfos.length; i < len; i++) {\n    var doc = docInfos[i];\n    if (doc._id && isLocalId(doc._id)) {\n      continue;\n    }\n    doc = docInfos[i] = parseDoc(doc, opts.new_edits, dbOpts);\n    if (doc.error && !docInfoError) {\n      docInfoError = doc;\n    }\n  }\n\n  if (docInfoError) {\n    return callback(docInfoError);\n  }\n\n  var allDocsProcessed = false;\n  var docCountDelta = 0;\n  var results = new Array(docInfos.length);\n  var fetchedDocs = new ExportedMap();\n  var preconditionErrored = false;\n  var blobType = api._meta.blobSupport ? 'blob' : 'base64';\n\n  preprocessAttachments(docInfos, blobType, function (err) {\n    if (err) {\n      return callback(err);\n    }\n    startTransaction();\n  });\n\n  function startTransaction() {\n\n    var stores = [\n      DOC_STORE, BY_SEQ_STORE,\n      ATTACH_STORE,\n      LOCAL_STORE, ATTACH_AND_SEQ_STORE,\n      META_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    txn = txnResult.txn;\n    txn.onabort = idbError(callback);\n    txn.ontimeout = idbError(callback);\n    txn.oncomplete = complete;\n    docStore = txn.objectStore(DOC_STORE);\n    bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    attachStore = txn.objectStore(ATTACH_STORE);\n    attachAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n    metaStore = txn.objectStore(META_STORE);\n\n    metaStore.get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result;\n      updateDocCountIfReady();\n    };\n\n    verifyAttachments(function (err) {\n      if (err) {\n        preconditionErrored = true;\n        return callback(err);\n      }\n      fetchExistingDocs();\n    });\n  }\n\n  function onAllDocsProcessed() {\n    allDocsProcessed = true;\n    updateDocCountIfReady();\n  }\n\n  function idbProcessDocs() {\n    processDocs(dbOpts.revs_limit, docInfos, api, fetchedDocs,\n                txn, results, writeDoc, opts, onAllDocsProcessed);\n  }\n\n  function updateDocCountIfReady() {\n    if (!metaDoc || !allDocsProcessed) {\n      return;\n    }\n    // caching the docCount saves a lot of time in allDocs() and\n    // info(), which is why we go to all the trouble of doing this\n    metaDoc.docCount += docCountDelta;\n    metaStore.put(metaDoc);\n  }\n\n  function fetchExistingDocs() {\n\n    if (!docInfos.length) {\n      return;\n    }\n\n    var numFetched = 0;\n\n    function checkDone() {\n      if (++numFetched === docInfos.length) {\n        idbProcessDocs();\n      }\n    }\n\n    function readMetadata(event) {\n      var metadata = decodeMetadata(event.target.result);\n\n      if (metadata) {\n        fetchedDocs.set(metadata.id, metadata);\n      }\n      checkDone();\n    }\n\n    for (var i = 0, len = docInfos.length; i < len; i++) {\n      var docInfo = docInfos[i];\n      if (docInfo._id && isLocalId(docInfo._id)) {\n        checkDone(); // skip local docs\n        continue;\n      }\n      var req = docStore.get(docInfo.metadata.id);\n      req.onsuccess = readMetadata;\n    }\n  }\n\n  function complete() {\n    if (preconditionErrored) {\n      return;\n    }\n\n    changesHandler.notify(api._meta.name);\n    callback(null, results);\n  }\n\n  function verifyAttachment(digest, callback) {\n\n    var req = attachStore.get(digest);\n    req.onsuccess = function (e) {\n      if (!e.target.result) {\n        var err = createError(MISSING_STUB,\n          'unknown stub attachment with digest ' +\n          digest);\n        err.status = 412;\n        callback(err);\n      } else {\n        callback();\n      }\n    };\n  }\n\n  function verifyAttachments(finish) {\n\n\n    var digests = [];\n    docInfos.forEach(function (docInfo) {\n      if (docInfo.data && docInfo.data._attachments) {\n        Object.keys(docInfo.data._attachments).forEach(function (filename) {\n          var att = docInfo.data._attachments[filename];\n          if (att.stub) {\n            digests.push(att.digest);\n          }\n        });\n      }\n    });\n    if (!digests.length) {\n      return finish();\n    }\n    var numDone = 0;\n    var err;\n\n    function checkDone() {\n      if (++numDone === digests.length) {\n        finish(err);\n      }\n    }\n    digests.forEach(function (digest) {\n      verifyAttachment(digest, function (attErr) {\n        if (attErr && !err) {\n          err = attErr;\n        }\n        checkDone();\n      });\n    });\n  }\n\n  function writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n                    isUpdate, delta, resultsIdx, callback) {\n\n    docInfo.metadata.winningRev = winningRev$$1;\n    docInfo.metadata.deleted = winningRevIsDeleted;\n\n    var doc = docInfo.data;\n    doc._id = docInfo.metadata.id;\n    doc._rev = docInfo.metadata.rev;\n\n    if (newRevIsDeleted) {\n      doc._deleted = true;\n    }\n\n    var hasAttachments = doc._attachments &&\n      Object.keys(doc._attachments).length;\n    if (hasAttachments) {\n      return writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n        isUpdate, resultsIdx, callback);\n    }\n\n    docCountDelta += delta;\n    updateDocCountIfReady();\n\n    finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n      isUpdate, resultsIdx, callback);\n  }\n\n  function finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n                     isUpdate, resultsIdx, callback) {\n\n    var doc = docInfo.data;\n    var metadata = docInfo.metadata;\n\n    doc._doc_id_rev = metadata.id + '::' + metadata.rev;\n    delete doc._id;\n    delete doc._rev;\n\n    function afterPutDoc(e) {\n      var revsToDelete = docInfo.stemmedRevs || [];\n\n      if (isUpdate && api.auto_compaction) {\n        revsToDelete = revsToDelete.concat(compactTree(docInfo.metadata));\n      }\n\n      if (revsToDelete && revsToDelete.length) {\n        compactRevs(revsToDelete, docInfo.metadata.id, txn);\n      }\n\n      metadata.seq = e.target.result;\n      // Current _rev is calculated from _rev_tree on read\n      // delete metadata.rev;\n      var metadataToStore = encodeMetadata(metadata, winningRev$$1,\n        winningRevIsDeleted);\n      var metaDataReq = docStore.put(metadataToStore);\n      metaDataReq.onsuccess = afterPutMetadata;\n    }\n\n    function afterPutDocError(e) {\n      // ConstraintError, need to update, not put (see #1638 for details)\n      e.preventDefault(); // avoid transaction abort\n      e.stopPropagation(); // avoid transaction onerror\n      var index = bySeqStore.index('_doc_id_rev');\n      var getKeyReq = index.getKey(doc._doc_id_rev);\n      getKeyReq.onsuccess = function (e) {\n        var putReq = bySeqStore.put(doc, e.target.result);\n        putReq.onsuccess = afterPutDoc;\n      };\n    }\n\n    function afterPutMetadata() {\n      results[resultsIdx] = {\n        ok: true,\n        id: metadata.id,\n        rev: metadata.rev\n      };\n      fetchedDocs.set(docInfo.metadata.id, docInfo.metadata);\n      insertAttachmentMappings(docInfo, metadata.seq, callback);\n    }\n\n    var putReq = bySeqStore.put(doc);\n\n    putReq.onsuccess = afterPutDoc;\n    putReq.onerror = afterPutDocError;\n  }\n\n  function writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n                            isUpdate, resultsIdx, callback) {\n\n\n    var doc = docInfo.data;\n\n    var numDone = 0;\n    var attachments = Object.keys(doc._attachments);\n\n    function collectResults() {\n      if (numDone === attachments.length) {\n        finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n          isUpdate, resultsIdx, callback);\n      }\n    }\n\n    function attachmentSaved() {\n      numDone++;\n      collectResults();\n    }\n\n    attachments.forEach(function (key) {\n      var att = docInfo.data._attachments[key];\n      if (!att.stub) {\n        var data = att.data;\n        delete att.data;\n        att.revpos = parseInt(winningRev$$1, 10);\n        var digest = att.digest;\n        saveAttachment(digest, data, attachmentSaved);\n      } else {\n        numDone++;\n        collectResults();\n      }\n    });\n  }\n\n  // map seqs to attachment digests, which\n  // we will need later during compaction\n  function insertAttachmentMappings(docInfo, seq, callback) {\n\n    var attsAdded = 0;\n    var attsToAdd = Object.keys(docInfo.data._attachments || {});\n\n    if (!attsToAdd.length) {\n      return callback();\n    }\n\n    function checkDone() {\n      if (++attsAdded === attsToAdd.length) {\n        callback();\n      }\n    }\n\n    function add(att) {\n      var digest = docInfo.data._attachments[att].digest;\n      var req = attachAndSeqStore.put({\n        seq: seq,\n        digestSeq: digest + '::' + seq\n      });\n\n      req.onsuccess = checkDone;\n      req.onerror = function (e) {\n        // this callback is for a constaint error, which we ignore\n        // because this docid/rev has already been associated with\n        // the digest (e.g. when new_edits == false)\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n        checkDone();\n      };\n    }\n    for (var i = 0; i < attsToAdd.length; i++) {\n      add(attsToAdd[i]); // do in parallel\n    }\n  }\n\n  function saveAttachment(digest, data, callback) {\n\n\n    var getKeyReq = attachStore.count(digest);\n    getKeyReq.onsuccess = function (e) {\n      var count = e.target.result;\n      if (count) {\n        return callback(); // already exists\n      }\n      var newAtt = {\n        digest: digest,\n        body: data\n      };\n      var putReq = attachStore.put(newAtt);\n      putReq.onsuccess = callback;\n    };\n  }\n}\n\n// Abstraction over IDBCursor and getAll()/getAllKeys() that allows us to batch our operations\n// while falling back to a normal IDBCursor operation on browsers that don't support getAll() or\n// getAllKeys(). This allows for a much faster implementation than just straight-up cursors, because\n// we're not processing each document one-at-a-time.\nfunction runBatchedCursor(objectStore, keyRange, descending, batchSize, onBatch) {\n\n  if (batchSize === -1) {\n    batchSize = 1000;\n  }\n\n  // Bail out of getAll()/getAllKeys() in the following cases:\n  // 1) either method is unsupported - we need both\n  // 2) batchSize is 1 (might as well use IDBCursor)\n  // 3) descending – no real way to do this via getAll()/getAllKeys()\n\n  var useGetAll = typeof objectStore.getAll === 'function' &&\n    typeof objectStore.getAllKeys === 'function' &&\n    batchSize > 1 && !descending;\n\n  var keysBatch;\n  var valuesBatch;\n  var pseudoCursor;\n\n  function onGetAll(e) {\n    valuesBatch = e.target.result;\n    if (keysBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function onGetAllKeys(e) {\n    keysBatch = e.target.result;\n    if (valuesBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function continuePseudoCursor() {\n    if (!keysBatch.length) { // no more results\n      return onBatch();\n    }\n    // fetch next batch, exclusive start\n    var lastKey = keysBatch[keysBatch.length - 1];\n    var newKeyRange;\n    if (keyRange && keyRange.upper) {\n      try {\n        newKeyRange = IDBKeyRange.bound(lastKey, keyRange.upper,\n          true, keyRange.upperOpen);\n      } catch (e) {\n        if (e.name === \"DataError\" && e.code === 0) {\n          return onBatch(); // we're done, startkey and endkey are equal\n        }\n      }\n    } else {\n      newKeyRange = IDBKeyRange.lowerBound(lastKey, true);\n    }\n    keyRange = newKeyRange;\n    keysBatch = null;\n    valuesBatch = null;\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  }\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (!cursor) { // done\n      return onBatch();\n    }\n    // regular IDBCursor acts like a batch where batch size is always 1\n    onBatch([cursor.key], [cursor.value], cursor);\n  }\n\n  if (useGetAll) {\n    pseudoCursor = {\"continue\": continuePseudoCursor};\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  } else if (descending) {\n    objectStore.openCursor(keyRange, 'prev').onsuccess = onCursor;\n  } else {\n    objectStore.openCursor(keyRange).onsuccess = onCursor;\n  }\n}\n\n// simple shim for objectStore.getAll(), falling back to IDBCursor\nfunction getAll(objectStore, keyRange, onSuccess) {\n  if (typeof objectStore.getAll === 'function') {\n    // use native getAll\n    objectStore.getAll(keyRange).onsuccess = onSuccess;\n    return;\n  }\n  // fall back to cursors\n  var values = [];\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (cursor) {\n      values.push(cursor.value);\n      cursor.continue();\n    } else {\n      onSuccess({\n        target: {\n          result: values\n        }\n      });\n    }\n  }\n\n  objectStore.openCursor(keyRange).onsuccess = onCursor;\n}\n\nfunction allDocsKeys(keys, docStore, onBatch) {\n  // It's not guaranted to be returned in right order  \n  var valuesBatch = new Array(keys.length);\n  var count = 0;\n  keys.forEach(function (key, index) {\n    docStore.get(key).onsuccess = function (event) {\n      if (event.target.result) {\n        valuesBatch[index] = event.target.result;\n      } else {\n        valuesBatch[index] = {key: key, error: 'not_found'};\n      }\n      count++;\n      if (count === keys.length) {\n        onBatch(keys, valuesBatch, {});\n      }\n    };\n  });\n}\n\nfunction createKeyRange(start, end, inclusiveEnd, key, descending) {\n  try {\n    if (start && end) {\n      if (descending) {\n        return IDBKeyRange.bound(end, start, !inclusiveEnd, false);\n      } else {\n        return IDBKeyRange.bound(start, end, false, !inclusiveEnd);\n      }\n    } else if (start) {\n      if (descending) {\n        return IDBKeyRange.upperBound(start);\n      } else {\n        return IDBKeyRange.lowerBound(start);\n      }\n    } else if (end) {\n      if (descending) {\n        return IDBKeyRange.lowerBound(end, !inclusiveEnd);\n      } else {\n        return IDBKeyRange.upperBound(end, !inclusiveEnd);\n      }\n    } else if (key) {\n      return IDBKeyRange.only(key);\n    }\n  } catch (e) {\n    return {error: e};\n  }\n  return null;\n}\n\nfunction idbAllDocs(opts, idb, callback) {\n  var start = 'startkey' in opts ? opts.startkey : false;\n  var end = 'endkey' in opts ? opts.endkey : false;\n  var key = 'key' in opts ? opts.key : false;\n  var keys = 'keys' in opts ? opts.keys : false; \n  var skip = opts.skip || 0;\n  var limit = typeof opts.limit === 'number' ? opts.limit : -1;\n  var inclusiveEnd = opts.inclusive_end !== false;\n\n  var keyRange ; \n  var keyRangeError;\n  if (!keys) {\n    keyRange = createKeyRange(start, end, inclusiveEnd, key, opts.descending);\n    keyRangeError = keyRange && keyRange.error;\n    if (keyRangeError && \n      !(keyRangeError.name === \"DataError\" && keyRangeError.code === 0)) {\n      // DataError with error code 0 indicates start is less than end, so\n      // can just do an empty query. Else need to throw\n      return callback(createError(IDB_ERROR,\n        keyRangeError.name, keyRangeError.message));\n    }\n  }\n\n  var stores = [DOC_STORE, BY_SEQ_STORE, META_STORE];\n\n  if (opts.attachments) {\n    stores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, stores, 'readonly');\n  if (txnResult.error) {\n    return callback(txnResult.error);\n  }\n  var txn = txnResult.txn;\n  txn.oncomplete = onTxnComplete;\n  txn.onabort = idbError(callback);\n  var docStore = txn.objectStore(DOC_STORE);\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var metaStore = txn.objectStore(META_STORE);\n  var docIdRevIndex = seqStore.index('_doc_id_rev');\n  var results = [];\n  var docCount;\n  var updateSeq;\n\n  metaStore.get(META_STORE).onsuccess = function (e) {\n    docCount = e.target.result.docCount;\n  };\n\n  /* istanbul ignore if */\n  if (opts.update_seq) {\n    getMaxUpdateSeq(seqStore, function (e) { \n      if (e.target.result && e.target.result.length > 0) {\n        updateSeq = e.target.result[0];\n      }\n    });\n  }\n\n  function getMaxUpdateSeq(objectStore, onSuccess) {\n    function onCursor(e) {\n      var cursor = e.target.result;\n      var maxKey = undefined;\n      if (cursor && cursor.key) {\n        maxKey = cursor.key;\n      } \n      return onSuccess({\n        target: {\n          result: [maxKey]\n        }\n      });\n    }\n    objectStore.openCursor(null, 'prev').onsuccess = onCursor;\n  }\n\n  // if the user specifies include_docs=true, then we don't\n  // want to block the main cursor while we're fetching the doc\n  function fetchDocAsynchronously(metadata, row, winningRev$$1) {\n    var key = metadata.id + \"::\" + winningRev$$1;\n    docIdRevIndex.get(key).onsuccess =  function onGetDoc(e) {\n      row.doc = decodeDoc(e.target.result) || {};\n      if (opts.conflicts) {\n        var conflicts = collectConflicts(metadata);\n        if (conflicts.length) {\n          row.doc._conflicts = conflicts;\n        }\n      }\n      fetchAttachmentsIfNecessary(row.doc, opts, txn);\n    };\n  }\n\n  function allDocsInner(winningRev$$1, metadata) {\n    var row = {\n      id: metadata.id,\n      key: metadata.id,\n      value: {\n        rev: winningRev$$1\n      }\n    };\n    var deleted = metadata.deleted;\n    if (deleted) {\n      if (keys) {\n        results.push(row);\n        // deleted docs are okay with \"keys\" requests\n        row.value.deleted = true;\n        row.doc = null;\n      }\n    } else if (skip-- <= 0) {\n      results.push(row);\n      if (opts.include_docs) {\n        fetchDocAsynchronously(metadata, row, winningRev$$1);\n      }\n    }\n  }\n\n  function processBatch(batchValues) {\n    for (var i = 0, len = batchValues.length; i < len; i++) {\n      if (results.length === limit) {\n        break;\n      }\n      var batchValue = batchValues[i];\n      if (batchValue.error && keys) {\n        // key was not found with \"keys\" requests\n        results.push(batchValue);\n        continue;\n      }\n      var metadata = decodeMetadata(batchValue);\n      var winningRev$$1 = metadata.winningRev;\n      allDocsInner(winningRev$$1, metadata);\n    }\n  }\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor) {\n      return;\n    }\n    processBatch(batchValues);\n    if (results.length < limit) {\n      cursor.continue();\n    }\n  }\n\n  function onGetAll(e) {\n    var values = e.target.result;\n    if (opts.descending) {\n      values = values.reverse();\n    }\n    processBatch(values);\n  }\n\n  function onResultsReady() {\n    var returnVal = {\n      total_rows: docCount,\n      offset: opts.skip,\n      rows: results\n    };\n    \n    /* istanbul ignore if */\n    if (opts.update_seq && updateSeq !== undefined) {\n      returnVal.update_seq = updateSeq;\n    }\n    callback(null, returnVal);\n  }\n\n  function onTxnComplete() {\n    if (opts.attachments) {\n      postProcessAttachments(results, opts.binary).then(onResultsReady);\n    } else {\n      onResultsReady();\n    }\n  }\n\n  // don't bother doing any requests if start > end or limit === 0\n  if (keyRangeError || limit === 0) {\n    return;\n  }\n  if (keys) {\n    return allDocsKeys(opts.keys, docStore, onBatch);\n  }\n  if (limit === -1) { // just fetch everything\n    return getAll(docStore, keyRange, onGetAll);\n  }\n  // else do a cursor\n  // choose a batch size based on the skip, since we'll need to skip that many\n  runBatchedCursor(docStore, keyRange, opts.descending, limit + skip, onBatch);\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\nfunction checkBlobSupport(txn) {\n  return new Promise(function (resolve) {\n    var blob$$1 = createBlob(['']);\n    var req = txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob$$1, 'key');\n\n    req.onsuccess = function () {\n      var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n      var matchedEdge = navigator.userAgent.match(/Edge\\//);\n      // MS Edge pretends to be Chrome 42:\n      // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n      resolve(matchedEdge || !matchedChrome ||\n        parseInt(matchedChrome[1], 10) >= 43);\n    };\n\n    req.onerror = txn.onabort = function (e) {\n      // If the transaction aborts now its due to not being able to\n      // write to the database, likely due to the disk being full\n      e.preventDefault();\n      e.stopPropagation();\n      resolve(false);\n    };\n  }).catch(function () {\n    return false; // error, so assume unsupported\n  });\n}\n\nfunction countDocs(txn, cb) {\n  var index = txn.objectStore(DOC_STORE).index('deletedOrLocal');\n  index.count(IDBKeyRange.only('0')).onsuccess = function (e) {\n    cb(e.target.result);\n  };\n}\n\n// This task queue ensures that IDB open calls are done in their own tick\n\nvar running = false;\nvar queue = [];\n\nfunction tryCode(fun, err, res, PouchDB) {\n  try {\n    fun(err, res);\n  } catch (err) {\n    // Shouldn't happen, but in some odd cases\n    // IndexedDB implementations might throw a sync\n    // error, in which case this will at least log it.\n    PouchDB.emit('error', err);\n  }\n}\n\nfunction applyNext() {\n  if (running || !queue.length) {\n    return;\n  }\n  running = true;\n  queue.shift()();\n}\n\nfunction enqueueTask(action, callback, PouchDB) {\n  queue.push(function runAction() {\n    action(function runCallback(err, res) {\n      tryCode(callback, err, res, PouchDB);\n      running = false;\n      nextTick(function runNext() {\n        applyNext(PouchDB);\n      });\n    });\n  });\n  applyNext();\n}\n\nfunction changes(opts, api, dbName, idb) {\n  opts = clone(opts);\n\n  if (opts.continuous) {\n    var id = dbName + ':' + uuid();\n    changesHandler.addListener(dbName, id, api, opts);\n    changesHandler.notify(dbName);\n    return {\n      cancel: function () {\n        changesHandler.removeListener(dbName, id);\n      }\n    };\n  }\n\n  var docIds = opts.doc_ids && new ExportedSet(opts.doc_ids);\n\n  opts.since = opts.since || 0;\n  var lastSeq = opts.since;\n\n  var limit = 'limit' in opts ? opts.limit : -1;\n  if (limit === 0) {\n    limit = 1; // per CouchDB _changes spec\n  }\n\n  var results = [];\n  var numResults = 0;\n  var filter = filterChange(opts);\n  var docIdsToMetadata = new ExportedMap();\n\n  var txn;\n  var bySeqStore;\n  var docStore;\n  var docIdRevIndex;\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor || !batchKeys.length) { // done\n      return;\n    }\n\n    var winningDocs = new Array(batchKeys.length);\n    var metadatas = new Array(batchKeys.length);\n\n    function processMetadataAndWinningDoc(metadata, winningDoc) {\n      var change = opts.processChange(winningDoc, metadata, opts);\n      lastSeq = change.seq = metadata.seq;\n\n      var filtered = filter(change);\n      if (typeof filtered === 'object') { // anything but true/false indicates error\n        return Promise.reject(filtered);\n      }\n\n      if (!filtered) {\n        return Promise.resolve();\n      }\n      numResults++;\n      if (opts.return_docs) {\n        results.push(change);\n      }\n      // process the attachment immediately\n      // for the benefit of live listeners\n      if (opts.attachments && opts.include_docs) {\n        return new Promise(function (resolve) {\n          fetchAttachmentsIfNecessary(winningDoc, opts, txn, function () {\n            postProcessAttachments([change], opts.binary).then(function () {\n              resolve(change);\n            });\n          });\n        });\n      } else {\n        return Promise.resolve(change);\n      }\n    }\n\n    function onBatchDone() {\n      var promises = [];\n      for (var i = 0, len = winningDocs.length; i < len; i++) {\n        if (numResults === limit) {\n          break;\n        }\n        var winningDoc = winningDocs[i];\n        if (!winningDoc) {\n          continue;\n        }\n        var metadata = metadatas[i];\n        promises.push(processMetadataAndWinningDoc(metadata, winningDoc));\n      }\n\n      Promise.all(promises).then(function (changes) {\n        for (var i = 0, len = changes.length; i < len; i++) {\n          if (changes[i]) {\n            opts.onChange(changes[i]);\n          }\n        }\n      }).catch(opts.complete);\n\n      if (numResults !== limit) {\n        cursor.continue();\n      }\n    }\n\n    // Fetch all metadatas/winningdocs from this batch in parallel, then process\n    // them all only once all data has been collected. This is done in parallel\n    // because it's faster than doing it one-at-a-time.\n    var numDone = 0;\n    batchValues.forEach(function (value, i) {\n      var doc = decodeDoc(value);\n      var seq = batchKeys[i];\n      fetchWinningDocAndMetadata(doc, seq, function (metadata, winningDoc) {\n        metadatas[i] = metadata;\n        winningDocs[i] = winningDoc;\n        if (++numDone === batchKeys.length) {\n          onBatchDone();\n        }\n      });\n    });\n  }\n\n  function onGetMetadata(doc, seq, metadata, cb) {\n    if (metadata.seq !== seq) {\n      // some other seq is later\n      return cb();\n    }\n\n    if (metadata.winningRev === doc._rev) {\n      // this is the winning doc\n      return cb(metadata, doc);\n    }\n\n    // fetch winning doc in separate request\n    var docIdRev = doc._id + '::' + metadata.winningRev;\n    var req = docIdRevIndex.get(docIdRev);\n    req.onsuccess = function (e) {\n      cb(metadata, decodeDoc(e.target.result));\n    };\n  }\n\n  function fetchWinningDocAndMetadata(doc, seq, cb) {\n    if (docIds && !docIds.has(doc._id)) {\n      return cb();\n    }\n\n    var metadata = docIdsToMetadata.get(doc._id);\n    if (metadata) { // cached\n      return onGetMetadata(doc, seq, metadata, cb);\n    }\n    // metadata not cached, have to go fetch it\n    docStore.get(doc._id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      docIdsToMetadata.set(doc._id, metadata);\n      onGetMetadata(doc, seq, metadata, cb);\n    };\n  }\n\n  function finish() {\n    opts.complete(null, {\n      results: results,\n      last_seq: lastSeq\n    });\n  }\n\n  function onTxnComplete() {\n    if (!opts.continuous && opts.attachments) {\n      // cannot guarantee that postProcessing was already done,\n      // so do it again\n      postProcessAttachments(results).then(finish);\n    } else {\n      finish();\n    }\n  }\n\n  var objectStores = [DOC_STORE, BY_SEQ_STORE];\n  if (opts.attachments) {\n    objectStores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, objectStores, 'readonly');\n  if (txnResult.error) {\n    return opts.complete(txnResult.error);\n  }\n  txn = txnResult.txn;\n  txn.onabort = idbError(opts.complete);\n  txn.oncomplete = onTxnComplete;\n\n  bySeqStore = txn.objectStore(BY_SEQ_STORE);\n  docStore = txn.objectStore(DOC_STORE);\n  docIdRevIndex = bySeqStore.index('_doc_id_rev');\n\n  var keyRange = (opts.since && !opts.descending) ?\n    IDBKeyRange.lowerBound(opts.since, true) : null;\n\n  runBatchedCursor(bySeqStore, keyRange, opts.descending, limit, onBatch);\n}\n\nvar cachedDBs = new ExportedMap();\nvar blobSupportPromise;\nvar openReqList = new ExportedMap();\n\nfunction IdbPouch(opts, callback) {\n  var api = this;\n\n  enqueueTask(function (thisCallback) {\n    init(api, opts, thisCallback);\n  }, callback, api.constructor);\n}\n\nfunction init(api, opts, callback) {\n\n  var dbName = opts.name;\n\n  var idb = null;\n  api._meta = null;\n\n  // called when creating a fresh new database\n  function createSchema(db) {\n    var docStore = db.createObjectStore(DOC_STORE, {keyPath : 'id'});\n    db.createObjectStore(BY_SEQ_STORE, {autoIncrement: true})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n    db.createObjectStore(ATTACH_STORE, {keyPath: 'digest'});\n    db.createObjectStore(META_STORE, {keyPath: 'id', autoIncrement: false});\n    db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n\n    // added in v2\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    // added in v3\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'});\n\n    // added in v4\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 2\n  // unfortunately \"deletedOrLocal\" is a misnomer now that we no longer\n  // store local docs in the main doc-store, but whaddyagonnado\n  function addDeletedOrLocalIndex(txn, callback) {\n    var docStore = txn.objectStore(DOC_STORE);\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    docStore.openCursor().onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var deleted = isDeleted(metadata);\n        metadata.deletedOrLocal = deleted ? \"1\" : \"0\";\n        docStore.put(metadata);\n        cursor.continue();\n      } else {\n        callback();\n      }\n    };\n  }\n\n  // migration to version 3 (part 1)\n  function createLocalStoreSchema(db) {\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n  }\n\n  // migration to version 3 (part 2)\n  function migrateLocalStore(txn, cb) {\n    var localStore = txn.objectStore(LOCAL_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var docId = metadata.id;\n        var local = isLocalId(docId);\n        var rev = winningRev(metadata);\n        if (local) {\n          var docIdRev = docId + \"::\" + rev;\n          // remove all seq entries\n          // associated with this docId\n          var start = docId + \"::\";\n          var end = docId + \"::~\";\n          var index = seqStore.index('_doc_id_rev');\n          var range = IDBKeyRange.bound(start, end, false, false);\n          var seqCursor = index.openCursor(range);\n          seqCursor.onsuccess = function (e) {\n            seqCursor = e.target.result;\n            if (!seqCursor) {\n              // done\n              docStore.delete(cursor.primaryKey);\n              cursor.continue();\n            } else {\n              var data = seqCursor.value;\n              if (data._doc_id_rev === docIdRev) {\n                localStore.put(data);\n              }\n              seqStore.delete(seqCursor.primaryKey);\n              seqCursor.continue();\n            }\n          };\n        } else {\n          cursor.continue();\n        }\n      } else if (cb) {\n        cb();\n      }\n    };\n  }\n\n  // migration to version 4 (part 1)\n  function addAttachAndSeqStore(db) {\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 4 (part 2)\n  function migrateAttsAndSeqs(txn, callback) {\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n    var attStore = txn.objectStore(ATTACH_STORE);\n    var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n\n    // need to actually populate the table. this is the expensive part,\n    // so as an optimization, check first that this database even\n    // contains attachments\n    var req = attStore.count();\n    req.onsuccess = function (e) {\n      var count = e.target.result;\n      if (!count) {\n        return callback(); // done\n      }\n\n      seqStore.openCursor().onsuccess = function (e) {\n        var cursor = e.target.result;\n        if (!cursor) {\n          return callback(); // done\n        }\n        var doc = cursor.value;\n        var seq = cursor.primaryKey;\n        var atts = Object.keys(doc._attachments || {});\n        var digestMap = {};\n        for (var j = 0; j < atts.length; j++) {\n          var att = doc._attachments[atts[j]];\n          digestMap[att.digest] = true; // uniq digests, just in case\n        }\n        var digests = Object.keys(digestMap);\n        for (j = 0; j < digests.length; j++) {\n          var digest = digests[j];\n          attAndSeqStore.put({\n            seq: seq,\n            digestSeq: digest + '::' + seq\n          });\n        }\n        cursor.continue();\n      };\n    };\n  }\n\n  // migration to version 5\n  // Instead of relying on on-the-fly migration of metadata,\n  // this brings the doc-store to its modern form:\n  // - metadata.winningrev\n  // - metadata.seq\n  // - stringify the metadata when storing it\n  function migrateMetadata(txn) {\n\n    function decodeMetadataCompat(storedObject) {\n      if (!storedObject.data) {\n        // old format, when we didn't store it stringified\n        storedObject.deleted = storedObject.deletedOrLocal === '1';\n        return storedObject;\n      }\n      return decodeMetadata(storedObject);\n    }\n\n    // ensure that every metadata has a winningRev and seq,\n    // which was previously created on-the-fly but better to migrate\n    var bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (e) {\n      var cursor = e.target.result;\n      if (!cursor) {\n        return; // done\n      }\n      var metadata = decodeMetadataCompat(cursor.value);\n\n      metadata.winningRev = metadata.winningRev ||\n        winningRev(metadata);\n\n      function fetchMetadataSeq() {\n        // metadata.seq was added post-3.2.0, so if it's missing,\n        // we need to fetch it manually\n        var start = metadata.id + '::';\n        var end = metadata.id + '::\\uffff';\n        var req = bySeqStore.index('_doc_id_rev').openCursor(\n          IDBKeyRange.bound(start, end));\n\n        var metadataSeq = 0;\n        req.onsuccess = function (e) {\n          var cursor = e.target.result;\n          if (!cursor) {\n            metadata.seq = metadataSeq;\n            return onGetMetadataSeq();\n          }\n          var seq = cursor.primaryKey;\n          if (seq > metadataSeq) {\n            metadataSeq = seq;\n          }\n          cursor.continue();\n        };\n      }\n\n      function onGetMetadataSeq() {\n        var metadataToStore = encodeMetadata(metadata,\n          metadata.winningRev, metadata.deleted);\n\n        var req = docStore.put(metadataToStore);\n        req.onsuccess = function () {\n          cursor.continue();\n        };\n      }\n\n      if (metadata.seq) {\n        return onGetMetadataSeq();\n      }\n\n      fetchMetadataSeq();\n    };\n\n  }\n\n  api._remote = false;\n  api.type = function () {\n    return 'idb';\n  };\n\n  api._id = toPromise(function (callback) {\n    callback(null, api._meta.instanceId);\n  });\n\n  api._bulkDocs = function idb_bulkDocs(req, reqOpts, callback) {\n    idbBulkDocs(opts, req, reqOpts, api, idb, callback);\n  };\n\n  // First we look up the metadata in the ids database, then we fetch the\n  // current revision(s) from the by sequence store\n  api._get = function idb_get(id, opts, callback) {\n    var doc;\n    var metadata;\n    var err;\n    var txn = opts.ctx;\n    if (!txn) {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n\n    function finish() {\n      callback(err, {doc: doc, metadata: metadata, ctx: txn});\n    }\n\n    txn.objectStore(DOC_STORE).get(id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      // we can determine the result here if:\n      // 1. there is no such document\n      // 2. the document is deleted and we don't ask about specific rev\n      // When we ask with opts.rev we expect the answer to be either\n      // doc (possibly with _deleted=true) or missing error\n      if (!metadata) {\n        err = createError(MISSING_DOC, 'missing');\n        return finish();\n      }\n\n      var rev;\n      if (!opts.rev) {\n        rev = metadata.winningRev;\n        var deleted = isDeleted(metadata);\n        if (deleted) {\n          err = createError(MISSING_DOC, \"deleted\");\n          return finish();\n        }\n      } else {\n        rev = opts.latest ? latest(opts.rev, metadata) : opts.rev;\n      }\n\n      var objectStore = txn.objectStore(BY_SEQ_STORE);\n      var key = metadata.id + '::' + rev;\n\n      objectStore.index('_doc_id_rev').get(key).onsuccess = function (e) {\n        doc = e.target.result;\n        if (doc) {\n          doc = decodeDoc(doc);\n        }\n        if (!doc) {\n          err = createError(MISSING_DOC, 'missing');\n          return finish();\n        }\n        finish();\n      };\n    };\n  };\n\n  api._getAttachment = function (docId, attachId, attachment, opts, callback) {\n    var txn;\n    if (opts.ctx) {\n      txn = opts.ctx;\n    } else {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n    var digest = attachment.digest;\n    var type = attachment.content_type;\n\n    txn.objectStore(ATTACH_STORE).get(digest).onsuccess = function (e) {\n      var body = e.target.result.body;\n      readBlobData(body, type, opts.binary, function (blobData) {\n        callback(null, blobData);\n      });\n    };\n  };\n\n  api._info = function idb_info(callback) {\n    var updateSeq;\n    var docCount;\n\n    var txnResult = openTransactionSafely(idb, [META_STORE, BY_SEQ_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      docCount = e.target.result.docCount;\n    };\n    txn.objectStore(BY_SEQ_STORE).openCursor(null, 'prev').onsuccess = function (e) {\n      var cursor = e.target.result;\n      updateSeq = cursor ? cursor.key : 0;\n    };\n\n    txn.oncomplete = function () {\n      callback(null, {\n        doc_count: docCount,\n        update_seq: updateSeq,\n        // for debugging\n        idb_attachment_format: (api._meta.blobSupport ? 'binary' : 'base64')\n      });\n    };\n  };\n\n  api._allDocs = function idb_allDocs(opts, callback) {\n    idbAllDocs(opts, idb, callback);\n  };\n\n  api._changes = function idbChanges(opts) {\n    return changes(opts, api, dbName, idb);\n  };\n\n  api._close = function (callback) {\n    // https://developer.mozilla.org/en-US/docs/IndexedDB/IDBDatabase#close\n    // \"Returns immediately and closes the connection in a separate thread...\"\n    idb.close();\n    cachedDBs.delete(dbName);\n    callback();\n  };\n\n  api._getRevisionTree = function (docId, callback) {\n    var txnResult = openTransactionSafely(idb, [DOC_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    var req = txn.objectStore(DOC_STORE).get(docId);\n    req.onsuccess = function (event) {\n      var doc = decodeMetadata(event.target.result);\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        callback(null, doc.rev_tree);\n      }\n    };\n  };\n\n  // This function removes revisions of document docId\n  // which are listed in revs and sets this document\n  // revision to to rev_tree\n  api._doCompaction = function (docId, revs, callback) {\n    var stores = [\n      DOC_STORE,\n      BY_SEQ_STORE,\n      ATTACH_STORE,\n      ATTACH_AND_SEQ_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n\n    var docStore = txn.objectStore(DOC_STORE);\n\n    docStore.get(docId).onsuccess = function (event) {\n      var metadata = decodeMetadata(event.target.result);\n      traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                                         revHash, ctx, opts) {\n        var rev = pos + '-' + revHash;\n        if (revs.indexOf(rev) !== -1) {\n          opts.status = 'missing';\n        }\n      });\n      compactRevs(revs, docId, txn);\n      var winningRev$$1 = metadata.winningRev;\n      var deleted = metadata.deleted;\n      txn.objectStore(DOC_STORE).put(\n        encodeMetadata(metadata, winningRev$$1, deleted));\n    };\n    txn.onabort = idbError(callback);\n    txn.oncomplete = function () {\n      callback();\n    };\n  };\n\n\n  api._getLocal = function (id, callback) {\n    var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var tx = txnResult.txn;\n    var req = tx.objectStore(LOCAL_STORE).get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var doc = e.target.result;\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        delete doc['_doc_id_rev']; // for backwards compat\n        callback(null, doc);\n      }\n    };\n  };\n\n  api._putLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    delete doc._revisions; // ignore this, trust the rev\n    var oldRev = doc._rev;\n    var id = doc._id;\n    if (!oldRev) {\n      doc._rev = '0-1';\n    } else {\n      doc._rev = '0-' + (parseInt(oldRev.split('-')[1], 10) + 1);\n    }\n\n    var tx = opts.ctx;\n    var ret;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.onerror = idbError(callback);\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req;\n    if (oldRev) {\n      req = oStore.get(id);\n      req.onsuccess = function (e) {\n        var oldDoc = e.target.result;\n        if (!oldDoc || oldDoc._rev !== oldRev) {\n          callback(createError(REV_CONFLICT));\n        } else { // update\n          var req = oStore.put(doc);\n          req.onsuccess = function () {\n            ret = {ok: true, id: doc._id, rev: doc._rev};\n            if (opts.ctx) { // return immediately\n              callback(null, ret);\n            }\n          };\n        }\n      };\n    } else { // new doc\n      req = oStore.add(doc);\n      req.onerror = function (e) {\n        // constraint error, already exists\n        callback(createError(REV_CONFLICT));\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n      };\n      req.onsuccess = function () {\n        ret = {ok: true, id: doc._id, rev: doc._rev};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      };\n    }\n  };\n\n  api._removeLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var tx = opts.ctx;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n    var ret;\n    var id = doc._id;\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req = oStore.get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var oldDoc = e.target.result;\n      if (!oldDoc || oldDoc._rev !== doc._rev) {\n        callback(createError(MISSING_DOC));\n      } else {\n        oStore.delete(id);\n        ret = {ok: true, id: id, rev: '0-0'};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      }\n    };\n  };\n\n  api._destroy = function (opts, callback) {\n    changesHandler.removeAllListeners(dbName);\n\n    //Close open request for \"dbName\" database to fix ie delay.\n    var openReq = openReqList.get(dbName);\n    if (openReq && openReq.result) {\n      openReq.result.close();\n      cachedDBs.delete(dbName);\n    }\n    var req = indexedDB.deleteDatabase(dbName);\n\n    req.onsuccess = function () {\n      //Remove open request from the list.\n      openReqList.delete(dbName);\n      if (hasLocalStorage() && (dbName in localStorage)) {\n        delete localStorage[dbName];\n      }\n      callback(null, { 'ok': true });\n    };\n\n    req.onerror = idbError(callback);\n  };\n\n  var cached = cachedDBs.get(dbName);\n\n  if (cached) {\n    idb = cached.idb;\n    api._meta = cached.global;\n    return nextTick(function () {\n      callback(null, api);\n    });\n  }\n\n  var req = indexedDB.open(dbName, ADAPTER_VERSION);\n  openReqList.set(dbName, req);\n\n  req.onupgradeneeded = function (e) {\n    var db = e.target.result;\n    if (e.oldVersion < 1) {\n      return createSchema(db); // new db, initial schema\n    }\n    // do migrations\n\n    var txn = e.currentTarget.transaction;\n    // these migrations have to be done in this function, before\n    // control is returned to the event loop, because IndexedDB\n\n    if (e.oldVersion < 3) {\n      createLocalStoreSchema(db); // v2 -> v3\n    }\n    if (e.oldVersion < 4) {\n      addAttachAndSeqStore(db); // v3 -> v4\n    }\n\n    var migrations = [\n      addDeletedOrLocalIndex, // v1 -> v2\n      migrateLocalStore,      // v2 -> v3\n      migrateAttsAndSeqs,     // v3 -> v4\n      migrateMetadata         // v4 -> v5\n    ];\n\n    var i = e.oldVersion;\n\n    function next() {\n      var migration = migrations[i - 1];\n      i++;\n      if (migration) {\n        migration(txn, next);\n      }\n    }\n\n    next();\n  };\n\n  req.onsuccess = function (e) {\n\n    idb = e.target.result;\n\n    idb.onversionchange = function () {\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    idb.onabort = function (e) {\n      guardedConsole('error', 'Database has a global failure', e.target.error);\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    // Do a few setup operations (in parallel as much as possible):\n    // 1. Fetch meta doc\n    // 2. Check blob support\n    // 3. Calculate docCount\n    // 4. Generate an instanceId if necessary\n    // 5. Store docCount and instanceId on meta doc\n\n    var txn = idb.transaction([\n      META_STORE,\n      DETECT_BLOB_SUPPORT_STORE,\n      DOC_STORE\n    ], 'readwrite');\n\n    var storedMetaDoc = false;\n    var metaDoc;\n    var docCount;\n    var blobSupport;\n    var instanceId;\n\n    function completeSetup() {\n      if (typeof blobSupport === 'undefined' || !storedMetaDoc) {\n        return;\n      }\n      api._meta = {\n        name: dbName,\n        instanceId: instanceId,\n        blobSupport: blobSupport\n      };\n\n      cachedDBs.set(dbName, {\n        idb: idb,\n        global: api._meta\n      });\n      callback(null, api);\n    }\n\n    function storeMetaDocIfReady() {\n      if (typeof docCount === 'undefined' || typeof metaDoc === 'undefined') {\n        return;\n      }\n      var instanceKey = dbName + '_id';\n      if (instanceKey in metaDoc) {\n        instanceId = metaDoc[instanceKey];\n      } else {\n        metaDoc[instanceKey] = instanceId = uuid();\n      }\n      metaDoc.docCount = docCount;\n      txn.objectStore(META_STORE).put(metaDoc);\n    }\n\n    //\n    // fetch or generate the instanceId\n    //\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result || { id: META_STORE };\n      storeMetaDocIfReady();\n    };\n\n    //\n    // countDocs\n    //\n    countDocs(txn, function (count) {\n      docCount = count;\n      storeMetaDocIfReady();\n    });\n\n    //\n    // check blob support\n    //\n    if (!blobSupportPromise) {\n      // make sure blob support is only checked once\n      blobSupportPromise = checkBlobSupport(txn);\n    }\n\n    blobSupportPromise.then(function (val) {\n      blobSupport = val;\n      completeSetup();\n    });\n\n    // only when the metadata put transaction has completed,\n    // consider the setup done\n    txn.oncomplete = function () {\n      storedMetaDoc = true;\n      completeSetup();\n    };\n    txn.onabort = idbError(callback);\n  };\n\n  req.onerror = function () {\n    var msg = 'Failed to open indexedDB, are you in private browsing mode?';\n    guardedConsole('error', msg);\n    callback(createError(IDB_ERROR, msg));\n  };\n}\n\nIdbPouch.valid = function () {\n  // Following #7085 buggy idb versions (typically Safari < 10.1) are\n  // considered valid.\n\n  // On Firefox SecurityError is thrown while referencing indexedDB if cookies\n  // are not allowed. `typeof indexedDB` also triggers the error.\n  try {\n    // some outdated implementations of IDB that appear on Samsung\n    // and HTC Android devices <4.4 are missing IDBKeyRange\n    return typeof indexedDB !== 'undefined' && typeof IDBKeyRange !== 'undefined';\n  } catch (e) {\n    return false;\n  }\n};\n\nfunction IDBPouch (PouchDB) {\n  PouchDB.adapter('idb', IdbPouch, true);\n}\n\n// dead simple promise pool, inspired by https://github.com/timdp/es6-promise-pool\n// but much smaller in code size. limits the number of concurrent promises that are executed\n\n\nfunction pool(promiseFactories, limit) {\n  return new Promise(function (resolve, reject) {\n    var running = 0;\n    var current = 0;\n    var done = 0;\n    var len = promiseFactories.length;\n    var err;\n\n    function runNext() {\n      running++;\n      promiseFactories[current++]().then(onSuccess, onError);\n    }\n\n    function doNext() {\n      if (++done === len) {\n        /* istanbul ignore if */\n        if (err) {\n          reject(err);\n        } else {\n          resolve();\n        }\n      } else {\n        runNextBatch();\n      }\n    }\n\n    function onSuccess() {\n      running--;\n      doNext();\n    }\n\n    /* istanbul ignore next */\n    function onError(thisErr) {\n      running--;\n      err = err || thisErr;\n      doNext();\n    }\n\n    function runNextBatch() {\n      while (running < limit && current < len) {\n        runNext();\n      }\n    }\n\n    runNextBatch();\n  });\n}\n\nvar CHANGES_BATCH_SIZE = 25;\nvar MAX_SIMULTANEOUS_REVS = 50;\nvar CHANGES_TIMEOUT_BUFFER = 5000;\nvar DEFAULT_HEARTBEAT = 10000;\n\nvar supportsBulkGetMap = {};\n\nfunction readAttachmentsAsBlobOrBuffer(row) {\n  var doc = row.doc || row.ok;\n  var atts = doc._attachments;\n  if (!atts) {\n    return;\n  }\n  Object.keys(atts).forEach(function (filename) {\n    var att = atts[filename];\n    att.data = b64ToBluffer(att.data, att.content_type);\n  });\n}\n\nfunction encodeDocId(id) {\n  if (/^_design/.test(id)) {\n    return '_design/' + encodeURIComponent(id.slice(8));\n  }\n  if (/^_local/.test(id)) {\n    return '_local/' + encodeURIComponent(id.slice(7));\n  }\n  return encodeURIComponent(id);\n}\n\nfunction preprocessAttachments$1(doc) {\n  if (!doc._attachments || !Object.keys(doc._attachments)) {\n    return Promise.resolve();\n  }\n\n  return Promise.all(Object.keys(doc._attachments).map(function (key) {\n    var attachment = doc._attachments[key];\n    if (attachment.data && typeof attachment.data !== 'string') {\n      return new Promise(function (resolve) {\n        blobToBase64(attachment.data, resolve);\n      }).then(function (b64) {\n        attachment.data = b64;\n      });\n    }\n  }));\n}\n\nfunction hasUrlPrefix(opts) {\n  if (!opts.prefix) {\n    return false;\n  }\n  var protocol = parseUri(opts.prefix).protocol;\n  return protocol === 'http' || protocol === 'https';\n}\n\n// Get all the information you possibly can about the URI given by name and\n// return it as a suitable object.\nfunction getHost(name, opts) {\n  // encode db name if opts.prefix is a url (#5574)\n  if (hasUrlPrefix(opts)) {\n    var dbName = opts.name.substr(opts.prefix.length);\n    // Ensure prefix has a trailing slash\n    var prefix = opts.prefix.replace(/\\/?$/, '/');\n    name = prefix + encodeURIComponent(dbName);\n  }\n\n  var uri = parseUri(name);\n  if (uri.user || uri.password) {\n    uri.auth = {username: uri.user, password: uri.password};\n  }\n\n  // Split the path part of the URI into parts using '/' as the delimiter\n  // after removing any leading '/' and any trailing '/'\n  var parts = uri.path.replace(/(^\\/|\\/$)/g, '').split('/');\n\n  uri.db = parts.pop();\n  // Prevent double encoding of URI component\n  if (uri.db.indexOf('%') === -1) {\n    uri.db = encodeURIComponent(uri.db);\n  }\n\n  uri.path = parts.join('/');\n\n  return uri;\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genDBUrl(opts, path) {\n  return genUrl(opts, opts.db + '/' + path);\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genUrl(opts, path) {\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  var pathDel = !opts.path ? '' : '/';\n\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  return opts.protocol + '://' + opts.host +\n         (opts.port ? (':' + opts.port) : '') +\n         '/' + opts.path + pathDel + path;\n}\n\nfunction paramsToStr(params) {\n  return '?' + Object.keys(params).map(function (k) {\n    return k + '=' + encodeURIComponent(params[k]);\n  }).join('&');\n}\n\nfunction shouldCacheBust(opts) {\n  var ua = (typeof navigator !== 'undefined' && navigator.userAgent) ?\n      navigator.userAgent.toLowerCase() : '';\n  var isIE = ua.indexOf('msie') !== -1;\n  var isTrident = ua.indexOf('trident') !== -1;\n  var isEdge = ua.indexOf('edge') !== -1;\n  var isGET = !('method' in opts) || opts.method === 'GET';\n  return (isIE || isTrident || isEdge) && isGET;\n}\n\n// Implements the PouchDB API for dealing with CouchDB instances over HTTP\nfunction HttpPouch(opts, callback) {\n\n  // The functions that will be publicly available for HttpPouch\n  var api = this;\n\n  var host = getHost(opts.name, opts);\n  var dbUrl = genDBUrl(host, '');\n\n  opts = clone(opts);\n\n  var ourFetch = function (url, options) {\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    if (opts.auth || host.auth) {\n      var nAuth = opts.auth || host.auth;\n      var str = nAuth.username + ':' + nAuth.password;\n      var token = thisBtoa(unescape(encodeURIComponent(str)));\n      options.headers.set('Authorization', 'Basic ' + token);\n    }\n\n    var headers = opts.headers || {};\n    Object.keys(headers).forEach(function (key) {\n      options.headers.append(key, headers[key]);\n    });\n\n    /* istanbul ignore if */\n    if (shouldCacheBust(options)) {\n      url += (url.indexOf('?') === -1 ? '?' : '&') + '_nonce=' + Date.now();\n    }\n\n    var fetchFun = opts.fetch || f$1;\n    return fetchFun(url, options);\n  };\n\n  function adapterFun$$1(name, fun) {\n    return adapterFun(name, getArguments(function (args) {\n      setup().then(function () {\n        return fun.apply(this, args);\n      }).catch(function (e) {\n        var callback = args.pop();\n        callback(e);\n      });\n    })).bind(api);\n  }\n\n  function fetchJSON(url, options, callback) {\n\n    var result = {};\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    if (!options.headers.get('Content-Type')) {\n      options.headers.set('Content-Type', 'application/json');\n    }\n    if (!options.headers.get('Accept')) {\n      options.headers.set('Accept', 'application/json');\n    }\n\n    return ourFetch(url, options).then(function (response) {\n      result.ok = response.ok;\n      result.status = response.status;\n      return response.json();\n    }).then(function (json) {\n      result.data = json;\n      if (!result.ok) {\n        result.data.status = result.status;\n        var err = generateErrorFromResponse(result.data);\n        if (callback) {\n          return callback(err);\n        } else {\n          throw err;\n        }\n      }\n\n      if (Array.isArray(result.data)) {\n        result.data = result.data.map(function (v) {\n          if (v.error || v.missing) {\n            return generateErrorFromResponse(v);\n          } else {\n            return v;\n          }\n        });\n      }\n\n      if (callback) {\n        callback(null, result.data);\n      } else {\n        return result;\n      }\n    });\n  }\n\n  var setupPromise;\n\n  function setup() {\n    if (opts.skip_setup) {\n      return Promise.resolve();\n    }\n\n    // If there is a setup in process or previous successful setup\n    // done then we will use that\n    // If previous setups have been rejected we will try again\n    if (setupPromise) {\n      return setupPromise;\n    }\n\n    setupPromise = fetchJSON(dbUrl).catch(function (err) {\n      if (err && err.status && err.status === 404) {\n        // Doesnt exist, create it\n        explainError(404, 'PouchDB is just detecting if the remote exists.');\n        return fetchJSON(dbUrl, {method: 'PUT'});\n      } else {\n        return Promise.reject(err);\n      }\n    }).catch(function (err) {\n      // If we try to create a database that already exists, skipped in\n      // istanbul since its catching a race condition.\n      /* istanbul ignore if */\n      if (err && err.status && err.status === 412) {\n        return true;\n      }\n      return Promise.reject(err);\n    });\n\n    setupPromise.catch(function () {\n      setupPromise = null;\n    });\n\n    return setupPromise;\n  }\n\n  nextTick(function () {\n    callback(null, api);\n  });\n\n  api._remote = true;\n\n  /* istanbul ignore next */\n  api.type = function () {\n    return 'http';\n  };\n\n  api.id = adapterFun$$1('id', function (callback) {\n    ourFetch(genUrl(host, '')).then(function (response) {\n      return response.json();\n    }).then(function (result) {\n      var uuid$$1 = (result && result.uuid) ?\n          (result.uuid + host.db) : genDBUrl(host, '');\n      callback(null, uuid$$1);\n    }).catch(function (err) {\n      callback(err);\n    });\n  });\n\n  // Sends a POST request to the host calling the couchdb _compact function\n  //    version: The version of CouchDB it is running\n  api.compact = adapterFun$$1('compact', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    fetchJSON(genDBUrl(host, '_compact'), {method: 'POST'}).then(function () {\n      function ping() {\n        api.info(function (err, res) {\n          // CouchDB may send a \"compact_running:true\" if it's\n          // already compacting. PouchDB Server doesn't.\n          /* istanbul ignore else */\n          if (res && !res.compact_running) {\n            callback(null, {ok: true});\n          } else {\n            setTimeout(ping, opts.interval || 200);\n          }\n        });\n      }\n      // Ping the http if it's finished compaction\n      ping();\n    });\n  });\n\n  api.bulkGet = adapterFun('bulkGet', function (opts, callback) {\n    var self = this;\n\n    function doBulkGet(cb) {\n      var params = {};\n      if (opts.revs) {\n        params.revs = true;\n      }\n      if (opts.attachments) {\n        /* istanbul ignore next */\n        params.attachments = true;\n      }\n      if (opts.latest) {\n        params.latest = true;\n      }\n      fetchJSON(genDBUrl(host, '_bulk_get' + paramsToStr(params)), {\n        method: 'POST',\n        body: JSON.stringify({ docs: opts.docs})\n      }).then(function (result) {\n        if (opts.attachments && opts.binary) {\n          result.data.results.forEach(function (res) {\n            res.docs.forEach(readAttachmentsAsBlobOrBuffer);\n          });\n        }\n        cb(null, result.data);\n      }).catch(cb);\n    }\n\n    /* istanbul ignore next */\n    function doBulkGetShim() {\n      // avoid \"url too long error\" by splitting up into multiple requests\n      var batchSize = MAX_SIMULTANEOUS_REVS;\n      var numBatches = Math.ceil(opts.docs.length / batchSize);\n      var numDone = 0;\n      var results = new Array(numBatches);\n\n      function onResult(batchNum) {\n        return function (err, res) {\n          // err is impossible because shim returns a list of errs in that case\n          results[batchNum] = res.results;\n          if (++numDone === numBatches) {\n            callback(null, {results: flatten(results)});\n          }\n        };\n      }\n\n      for (var i = 0; i < numBatches; i++) {\n        var subOpts = pick(opts, ['revs', 'attachments', 'binary', 'latest']);\n        subOpts.docs = opts.docs.slice(i * batchSize,\n          Math.min(opts.docs.length, (i + 1) * batchSize));\n        bulkGet(self, subOpts, onResult(i));\n      }\n    }\n\n    // mark the whole database as either supporting or not supporting _bulk_get\n    var dbUrl = genUrl(host, '');\n    var supportsBulkGet = supportsBulkGetMap[dbUrl];\n\n    /* istanbul ignore next */\n    if (typeof supportsBulkGet !== 'boolean') {\n      // check if this database supports _bulk_get\n      doBulkGet(function (err, res) {\n        if (err) {\n          supportsBulkGetMap[dbUrl] = false;\n          explainError(\n            err.status,\n            'PouchDB is just detecting if the remote ' +\n            'supports the _bulk_get API.'\n          );\n          doBulkGetShim();\n        } else {\n          supportsBulkGetMap[dbUrl] = true;\n          callback(null, res);\n        }\n      });\n    } else if (supportsBulkGet) {\n      doBulkGet(callback);\n    } else {\n      doBulkGetShim();\n    }\n  });\n\n  // Calls GET on the host, which gets back a JSON string containing\n  //    couchdb: A welcome string\n  //    version: The version of CouchDB it is running\n  api._info = function (callback) {\n    setup().then(function () {\n      return ourFetch(genDBUrl(host, ''));\n    }).then(function (response) {\n      return response.json();\n    }).then(function (info) {\n      info.host = genDBUrl(host, '');\n      callback(null, info);\n    }).catch(callback);\n  };\n\n  api.fetch = function (path, options) {\n    return setup().then(function () {\n      return ourFetch(genDBUrl(host, path), options);\n    });\n  };\n\n  // Get the document with the given id from the database given by host.\n  // The id could be solely the _id in the database, or it may be a\n  // _design/ID or _local/ID path\n  api.get = adapterFun$$1('get', function (id, opts, callback) {\n    // If no options were given, set the callback to the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n\n    if (opts.revs) {\n      params.revs = true;\n    }\n\n    if (opts.revs_info) {\n      params.revs_info = true;\n    }\n\n    if (opts.latest) {\n      params.latest = true;\n    }\n\n    if (opts.open_revs) {\n      if (opts.open_revs !== \"all\") {\n        opts.open_revs = JSON.stringify(opts.open_revs);\n      }\n      params.open_revs = opts.open_revs;\n    }\n\n    if (opts.rev) {\n      params.rev = opts.rev;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = opts.conflicts;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = opts.update_seq;\n    }\n\n    id = encodeDocId(id);\n\n    function fetchAttachments(doc) {\n      var atts = doc._attachments;\n      var filenames = atts && Object.keys(atts);\n      if (!atts || !filenames.length) {\n        return;\n      }\n      // we fetch these manually in separate XHRs, because\n      // Sync Gateway would normally send it back as multipart/mixed,\n      // which we cannot parse. Also, this is more efficient than\n      // receiving attachments as base64-encoded strings.\n      function fetchData(filename) {\n        var att = atts[filename];\n        var path = encodeDocId(doc._id) + '/' + encodeAttachmentId(filename) +\n            '?rev=' + doc._rev;\n        return ourFetch(genDBUrl(host, path)).then(function (response) {\n          if (typeof process !== 'undefined' && !process.browser) {\n            return response.buffer();\n          } else {\n            /* istanbul ignore next */\n            return response.blob();\n          }\n        }).then(function (blob) {\n          if (opts.binary) {\n            // TODO: Can we remove this?\n            if (typeof process !== 'undefined' && !process.browser) {\n              blob.type = att.content_type;\n            }\n            return blob;\n          }\n          return new Promise(function (resolve) {\n            blobToBase64(blob, resolve);\n          });\n        }).then(function (data) {\n          delete att.stub;\n          delete att.length;\n          att.data = data;\n        });\n      }\n\n      var promiseFactories = filenames.map(function (filename) {\n        return function () {\n          return fetchData(filename);\n        };\n      });\n\n      // This limits the number of parallel xhr requests to 5 any time\n      // to avoid issues with maximum browser request limits\n      return pool(promiseFactories, 5);\n    }\n\n    function fetchAllAttachments(docOrDocs) {\n      if (Array.isArray(docOrDocs)) {\n        return Promise.all(docOrDocs.map(function (doc) {\n          if (doc.ok) {\n            return fetchAttachments(doc.ok);\n          }\n        }));\n      }\n      return fetchAttachments(docOrDocs);\n    }\n\n    var url = genDBUrl(host, id + paramsToStr(params));\n    fetchJSON(url).then(function (res) {\n      return Promise.resolve().then(function () {\n        if (opts.attachments) {\n          return fetchAllAttachments(res.data);\n        }\n      }).then(function () {\n        callback(null, res.data);\n      });\n    }).catch(function (e) {\n      e.docId = id;\n      callback(e);\n    });\n  });\n\n\n  // Delete the document given by doc from the database given by host.\n  api.remove = adapterFun$$1('remove', function (docOrId, optsOrRev, opts, cb) {\n    var doc;\n    if (typeof optsOrRev === 'string') {\n      // id, rev, opts, callback style\n      doc = {\n        _id: docOrId,\n        _rev: optsOrRev\n      };\n      if (typeof opts === 'function') {\n        cb = opts;\n        opts = {};\n      }\n    } else {\n      // doc, opts, callback style\n      doc = docOrId;\n      if (typeof optsOrRev === 'function') {\n        cb = optsOrRev;\n        opts = {};\n      } else {\n        cb = opts;\n        opts = optsOrRev;\n      }\n    }\n\n    var rev = (doc._rev || opts.rev);\n    var url = genDBUrl(host, encodeDocId(doc._id)) + '?rev=' + rev;\n\n    fetchJSON(url, {method: 'DELETE'}, cb).catch(cb);\n  });\n\n  function encodeAttachmentId(attachmentId) {\n    return attachmentId.split(\"/\").map(encodeURIComponent).join(\"/\");\n  }\n\n  // Get the attachment\n  api.getAttachment = adapterFun$$1('getAttachment', function (docId, attachmentId,\n                                                            opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var params = opts.rev ? ('?rev=' + opts.rev) : '';\n    var url = genDBUrl(host, encodeDocId(docId)) + '/' +\n        encodeAttachmentId(attachmentId) + params;\n    var contentType;\n    ourFetch(url, {method: 'GET'}).then(function (response) {\n      contentType = response.headers.get('content-type');\n      if (!response.ok) {\n        throw response;\n      } else {\n        if (typeof process !== 'undefined' && !process.browser) {\n          return response.buffer();\n        } else {\n          /* istanbul ignore next */\n          return response.blob();\n        }\n      }\n    }).then(function (blob) {\n      // TODO: also remove\n      if (typeof process !== 'undefined' && !process.browser) {\n        blob.type = contentType;\n      }\n      callback(null, blob);\n    }).catch(function (err) {\n      callback(err);\n    });\n  });\n\n  // Remove the attachment given by the id and rev\n  api.removeAttachment =  adapterFun$$1('removeAttachment', function (docId,\n                                                                   attachmentId,\n                                                                   rev,\n                                                                   callback) {\n    var url = genDBUrl(host, encodeDocId(docId) + '/' +\n                       encodeAttachmentId(attachmentId)) + '?rev=' + rev;\n    fetchJSON(url, {method: 'DELETE'}, callback).catch(callback);\n  });\n\n  // Add the attachment given by blob and its contentType property\n  // to the document with the given id, the revision given by rev, and\n  // add it to the database given by host.\n  api.putAttachment = adapterFun$$1('putAttachment', function (docId, attachmentId,\n                                                            rev, blob,\n                                                            type, callback) {\n    if (typeof type === 'function') {\n      callback = type;\n      type = blob;\n      blob = rev;\n      rev = null;\n    }\n    var id = encodeDocId(docId) + '/' + encodeAttachmentId(attachmentId);\n    var url = genDBUrl(host, id);\n    if (rev) {\n      url += '?rev=' + rev;\n    }\n\n    if (typeof blob === 'string') {\n      // input is assumed to be a base64 string\n      var binary;\n      try {\n        binary = thisAtob(blob);\n      } catch (err) {\n        return callback(createError(BAD_ARG,\n                        'Attachment is not a valid base64 string'));\n      }\n      blob = binary ? binStringToBluffer(binary, type) : '';\n    }\n\n    // Add the attachment\n    fetchJSON(url, {\n      headers: new h({'Content-Type': type}),\n      method: 'PUT',\n      body: blob\n    }, callback).catch(callback);\n  });\n\n  // Update/create multiple documents given by req in the database\n  // given by host.\n  api._bulkDocs = function (req, opts, callback) {\n    // If new_edits=false then it prevents the database from creating\n    // new revision numbers for the documents. Instead it just uses\n    // the old ones. This is used in database replication.\n    req.new_edits = opts.new_edits;\n\n    setup().then(function () {\n      return Promise.all(req.docs.map(preprocessAttachments$1));\n    }).then(function () {\n      // Update/create the documents\n      return fetchJSON(genDBUrl(host, '_bulk_docs'), {\n        method: 'POST',\n        body: JSON.stringify(req)\n      }, callback);\n    }).catch(callback);\n  };\n\n\n  // Update/create document\n  api._put = function (doc, opts, callback) {\n    setup().then(function () {\n      return preprocessAttachments$1(doc);\n    }).then(function () {\n      return fetchJSON(genDBUrl(host, encodeDocId(doc._id)), {\n        method: 'PUT',\n        body: JSON.stringify(doc)\n      });\n    }).then(function (result) {\n      callback(null, result.data);\n    }).catch(function (err) {\n      err.docId = doc && doc._id;\n      callback(err);\n    });\n  };\n\n\n  // Get a listing of the documents in the database given\n  // by host and ordered by increasing id.\n  api.allDocs = adapterFun$$1('allDocs', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n    var body;\n    var method = 'GET';\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    if (opts.include_docs) {\n      params.include_docs = true;\n    }\n\n    // added in CouchDB 1.6.0\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.key) {\n      params.key = JSON.stringify(opts.key);\n    }\n\n    if (opts.start_key) {\n      opts.startkey = opts.start_key;\n    }\n\n    if (opts.startkey) {\n      params.startkey = JSON.stringify(opts.startkey);\n    }\n\n    if (opts.end_key) {\n      opts.endkey = opts.end_key;\n    }\n\n    if (opts.endkey) {\n      params.endkey = JSON.stringify(opts.endkey);\n    }\n\n    if (typeof opts.inclusive_end !== 'undefined') {\n      params.inclusive_end = !!opts.inclusive_end;\n    }\n\n    if (typeof opts.limit !== 'undefined') {\n      params.limit = opts.limit;\n    }\n\n    if (typeof opts.skip !== 'undefined') {\n      params.skip = opts.skip;\n    }\n\n    var paramStr = paramsToStr(params);\n\n    if (typeof opts.keys !== 'undefined') {\n      method = 'POST';\n      body = {keys: opts.keys};\n    }\n\n    fetchJSON(genDBUrl(host, '_all_docs' + paramStr), {\n       method: method,\n      body: JSON.stringify(body)\n    }).then(function (result) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        result.data.rows.forEach(readAttachmentsAsBlobOrBuffer);\n      }\n      callback(null, result.data);\n    }).catch(callback);\n  });\n\n  // Get a list of changes made to documents in the database given by host.\n  // TODO According to the README, there should be two other methods here,\n  // api.changes.addListener and api.changes.removeListener.\n  api._changes = function (opts) {\n\n    // We internally page the results of a changes request, this means\n    // if there is a large set of changes to be returned we can start\n    // processing them quicker instead of waiting on the entire\n    // set of changes to return and attempting to process them at once\n    var batchSize = 'batch_size' in opts ? opts.batch_size : CHANGES_BATCH_SIZE;\n\n    opts = clone(opts);\n\n    if (opts.continuous && !('heartbeat' in opts)) {\n      opts.heartbeat = DEFAULT_HEARTBEAT;\n    }\n\n    var requestTimeout = ('timeout' in opts) ? opts.timeout : 30 * 1000;\n\n    // ensure CHANGES_TIMEOUT_BUFFER applies\n    if ('timeout' in opts && opts.timeout &&\n      (requestTimeout - opts.timeout) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.timeout + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    /* istanbul ignore if */\n    if ('heartbeat' in opts && opts.heartbeat &&\n       (requestTimeout - opts.heartbeat) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.heartbeat + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    var params = {};\n    if ('timeout' in opts && opts.timeout) {\n      params.timeout = opts.timeout;\n    }\n\n    var limit = (typeof opts.limit !== 'undefined') ? opts.limit : false;\n    var leftToFetch = limit;\n\n    if (opts.style) {\n      params.style = opts.style;\n    }\n\n    if (opts.include_docs || opts.filter && typeof opts.filter === 'function') {\n      params.include_docs = true;\n    }\n\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.continuous) {\n      params.feed = 'longpoll';\n    }\n\n    if (opts.seq_interval) {\n      params.seq_interval = opts.seq_interval;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n    \n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if ('heartbeat' in opts) {\n      // If the heartbeat value is false, it disables the default heartbeat\n      if (opts.heartbeat) {\n        params.heartbeat = opts.heartbeat;\n      }\n    }\n\n    if (opts.filter && typeof opts.filter === 'string') {\n      params.filter = opts.filter;\n    }\n\n    if (opts.view && typeof opts.view === 'string') {\n      params.filter = '_view';\n      params.view = opts.view;\n    }\n\n    // If opts.query_params exists, pass it through to the changes request.\n    // These parameters may be used by the filter on the source database.\n    if (opts.query_params && typeof opts.query_params === 'object') {\n      for (var param_name in opts.query_params) {\n        /* istanbul ignore else */\n        if (opts.query_params.hasOwnProperty(param_name)) {\n          params[param_name] = opts.query_params[param_name];\n        }\n      }\n    }\n\n    var method = 'GET';\n    var body;\n\n    if (opts.doc_ids) {\n      // set this automagically for the user; it's annoying that couchdb\n      // requires both a \"filter\" and a \"doc_ids\" param.\n      params.filter = '_doc_ids';\n      method = 'POST';\n      body = {doc_ids: opts.doc_ids };\n    }\n    /* istanbul ignore next */\n    else if (opts.selector) {\n      // set this automagically for the user, similar to above\n      params.filter = '_selector';\n      method = 'POST';\n      body = {selector: opts.selector };\n    }\n\n    var controller = new a();\n    var lastFetchedSeq;\n\n    // Get all the changes starting wtih the one immediately after the\n    // sequence number given by since.\n    var fetchData = function (since, callback) {\n      if (opts.aborted) {\n        return;\n      }\n      params.since = since;\n      // \"since\" can be any kind of json object in Cloudant/CouchDB 2.x\n      /* istanbul ignore next */\n      if (typeof params.since === \"object\") {\n        params.since = JSON.stringify(params.since);\n      }\n\n      if (opts.descending) {\n        if (limit) {\n          params.limit = leftToFetch;\n        }\n      } else {\n        params.limit = (!limit || leftToFetch > batchSize) ?\n          batchSize : leftToFetch;\n      }\n\n      // Set the options for the ajax call\n      var url = genDBUrl(host, '_changes' + paramsToStr(params));\n      var fetchOpts = {\n        signal: controller.signal,\n        method: method,\n        body: JSON.stringify(body)\n      };\n      lastFetchedSeq = since;\n\n      /* istanbul ignore if */\n      if (opts.aborted) {\n        return;\n      }\n\n      // Get the changes\n      setup().then(function () {\n        return fetchJSON(url, fetchOpts, callback);\n      }).catch(callback);\n    };\n\n    // If opts.since exists, get all the changes from the sequence\n    // number given by opts.since. Otherwise, get all the changes\n    // from the sequence number 0.\n    var results = {results: []};\n\n    var fetched = function (err, res) {\n      if (opts.aborted) {\n        return;\n      }\n      var raw_results_length = 0;\n      // If the result of the ajax call (res) contains changes (res.results)\n      if (res && res.results) {\n        raw_results_length = res.results.length;\n        results.last_seq = res.last_seq;\n        var pending = null;\n        var lastSeq = null;\n        // Attach 'pending' property if server supports it (CouchDB 2.0+)\n        /* istanbul ignore if */\n        if (typeof res.pending === 'number') {\n          pending = res.pending;\n        }\n        if (typeof results.last_seq === 'string' || typeof results.last_seq === 'number') {\n          lastSeq = results.last_seq;\n        }\n        // For each change\n        var req = {};\n        req.query = opts.query_params;\n        res.results = res.results.filter(function (c) {\n          leftToFetch--;\n          var ret = filterChange(opts)(c);\n          if (ret) {\n            if (opts.include_docs && opts.attachments && opts.binary) {\n              readAttachmentsAsBlobOrBuffer(c);\n            }\n            if (opts.return_docs) {\n              results.results.push(c);\n            }\n            opts.onChange(c, pending, lastSeq);\n          }\n          return ret;\n        });\n      } else if (err) {\n        // In case of an error, stop listening for changes and call\n        // opts.complete\n        opts.aborted = true;\n        opts.complete(err);\n        return;\n      }\n\n      // The changes feed may have timed out with no results\n      // if so reuse last update sequence\n      if (res && res.last_seq) {\n        lastFetchedSeq = res.last_seq;\n      }\n\n      var finished = (limit && leftToFetch <= 0) ||\n        (res && raw_results_length < batchSize) ||\n        (opts.descending);\n\n      if ((opts.continuous && !(limit && leftToFetch <= 0)) || !finished) {\n        // Queue a call to fetch again with the newest sequence number\n        nextTick(function () { fetchData(lastFetchedSeq, fetched); });\n      } else {\n        // We're done, call the callback\n        opts.complete(null, results);\n      }\n    };\n\n    fetchData(opts.since || 0, fetched);\n\n    // Return a method to cancel this method from processing any more\n    return {\n      cancel: function () {\n        opts.aborted = true;\n        controller.abort();\n      }\n    };\n  };\n\n  // Given a set of document/revision IDs (given by req), tets the subset of\n  // those that do NOT correspond to revisions stored in the database.\n  // See http://wiki.apache.org/couchdb/HttpPostRevsDiff\n  api.revsDiff = adapterFun$$1('revsDiff', function (req, opts, callback) {\n    // If no options were given, set the callback to be the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n\n    // Get the missing document/revision IDs\n    fetchJSON(genDBUrl(host, '_revs_diff'), {\n      method: 'POST',\n      body: JSON.stringify(req)\n    }, callback).catch(callback);\n  });\n\n  api._close = function (callback) {\n    callback();\n  };\n\n  api._destroy = function (options, callback) {\n    fetchJSON(genDBUrl(host, ''), {method: 'DELETE'}).then(function (json) {\n      callback(null, json);\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status === 404) {\n        callback(null, {ok: true});\n      } else {\n        callback(err);\n      }\n    });\n  };\n}\n\n// HttpPouch is a valid adapter.\nHttpPouch.valid = function () {\n  return true;\n};\n\nfunction HttpPouch$1 (PouchDB) {\n  PouchDB.adapter('http', HttpPouch, false);\n  PouchDB.adapter('https', HttpPouch, false);\n}\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      nextTick(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      nextTick(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new ExportedSet(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nfunction createBuiltInError(name) {\n  var message = 'builtin ' + name +\n    ' function requires map values to be numbers' +\n    ' or number arrays';\n  return new BuiltInError(message);\n}\n\nfunction sum(values) {\n  var result = 0;\n  for (var i = 0, len = values.length; i < len; i++) {\n    var num = values[i];\n    if (typeof num !== 'number') {\n      if (Array.isArray(num)) {\n        // lists of numbers are also allowed, sum them separately\n        result = typeof result === 'number' ? [result] : result;\n        for (var j = 0, jLen = num.length; j < jLen; j++) {\n          var jNum = num[j];\n          if (typeof jNum !== 'number') {\n            throw createBuiltInError('_sum');\n          } else if (typeof result[j] === 'undefined') {\n            result.push(jNum);\n          } else {\n            result[j] += jNum;\n          }\n        }\n      } else { // not array/number\n        throw createBuiltInError('_sum');\n      }\n    } else if (typeof result === 'number') {\n      result += num;\n    } else { // add number to array\n      result[0] += num;\n    }\n  }\n  return result;\n}\n\nvar log = guardedConsole.bind(null, 'log');\nvar isArray = Array.isArray;\nvar toJSON = JSON.parse;\n\nfunction evalFunctionWithEval(func, emit) {\n  return scopeEval(\n    \"return (\" + func.replace(/;\\s*$/, \"\") + \");\",\n    {\n      emit: emit,\n      sum: sum,\n      log: log,\n      isArray: isArray,\n      toJSON: toJSON\n    }\n  );\n}\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue$1() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue$1.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue$1.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue$1();\nvar CHANGES_BATCH_SIZE$1 = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = b64ToBluffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new h({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new ExportedSet();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue$1();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue$1();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE$1\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE$1) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new ExportedMap();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new ExportedMap();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new ExportedMap();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new ExportedMap();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new ExportedSet();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              nextTick(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nvar builtInReduce = {\n  _sum: function (keys, values) {\n    return sum(values);\n  },\n\n  _count: function (keys, values) {\n    return values.length;\n  },\n\n  _stats: function (keys, values) {\n    // no need to implement rereduce=true, because Pouch\n    // will never call it\n    function sumsqr(values) {\n      var _sumsqr = 0;\n      for (var i = 0, len = values.length; i < len; i++) {\n        var num = values[i];\n        _sumsqr += (num * num);\n      }\n      return _sumsqr;\n    }\n    return {\n      sum     : sum(values),\n      min     : Math.min.apply(null, values),\n      max     : Math.max.apply(null, values),\n      count   : values.length,\n      sumsqr : sumsqr(values)\n    };\n  }\n};\n\nfunction getBuiltIn(reduceFunString) {\n  if (/^_sum/.test(reduceFunString)) {\n    return builtInReduce._sum;\n  } else if (/^_count/.test(reduceFunString)) {\n    return builtInReduce._count;\n  } else if (/^_stats/.test(reduceFunString)) {\n    return builtInReduce._stats;\n  } else if (/^_/.test(reduceFunString)) {\n    throw new Error(reduceFunString + ' is not a supported reduce function.');\n  }\n}\n\nfunction mapper(mapFun, emit) {\n  // for temp_views one can use emit(doc, emit), see #38\n  if (typeof mapFun === \"function\" && mapFun.length === 2) {\n    var origMap = mapFun;\n    return function (doc) {\n      return origMap(doc, emit);\n    };\n  } else {\n    return evalFunctionWithEval(mapFun.toString(), emit);\n  }\n}\n\nfunction reducer(reduceFun) {\n  var reduceFunString = reduceFun.toString();\n  var builtIn = getBuiltIn(reduceFunString);\n  if (builtIn) {\n    return builtIn;\n  } else {\n    return evalFunctionWithEval(reduceFunString);\n  }\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var fun = ddoc.views && ddoc.views[viewName];\n  if (typeof fun.map !== 'string') {\n    throw new NotFoundError('ddoc ' + ddoc._id + ' has no string view named ' +\n      viewName + ', instead found object of type: ' + typeof fun.map);\n  }\n}\n\nvar localDocName = 'mrviews';\nvar abstract = createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator);\n\nfunction query(fun, opts, callback) {\n  return abstract.query.call(this, fun, opts, callback);\n}\n\nfunction viewCleanup(callback) {\n  return abstract.viewCleanup.call(this, callback);\n}\n\nvar mapreduce = {\n  query: query,\n  viewCleanup: viewCleanup\n};\n\nfunction isGenOne$1(rev) {\n  return /^1-/.test(rev);\n}\n\nfunction fileHasChanged(localDoc, remoteDoc, filename) {\n  return !localDoc._attachments ||\n         !localDoc._attachments[filename] ||\n         localDoc._attachments[filename].digest !== remoteDoc._attachments[filename].digest;\n}\n\nfunction getDocAttachments(db, doc) {\n  var filenames = Object.keys(doc._attachments);\n  return Promise.all(filenames.map(function (filename) {\n    return db.getAttachment(doc._id, filename, {rev: doc._rev});\n  }));\n}\n\nfunction getDocAttachmentsFromTargetOrSource(target, src, doc) {\n  var doCheckForLocalAttachments = isRemote(src) && !isRemote(target);\n  var filenames = Object.keys(doc._attachments);\n\n  if (!doCheckForLocalAttachments) {\n    return getDocAttachments(src, doc);\n  }\n\n  return target.get(doc._id).then(function (localDoc) {\n    return Promise.all(filenames.map(function (filename) {\n      if (fileHasChanged(localDoc, doc, filename)) {\n        return src.getAttachment(doc._id, filename);\n      }\n\n      return target.getAttachment(localDoc._id, filename);\n    }));\n  }).catch(function (error) {\n    /* istanbul ignore if */\n    if (error.status !== 404) {\n      throw error;\n    }\n\n    return getDocAttachments(src, doc);\n  });\n}\n\nfunction createBulkGetOpts(diffs) {\n  var requests = [];\n  Object.keys(diffs).forEach(function (id) {\n    var missingRevs = diffs[id].missing;\n    missingRevs.forEach(function (missingRev) {\n      requests.push({\n        id: id,\n        rev: missingRev\n      });\n    });\n  });\n\n  return {\n    docs: requests,\n    revs: true,\n    latest: true\n  };\n}\n\n//\n// Fetch all the documents from the src as described in the \"diffs\",\n// which is a mapping of docs IDs to revisions. If the state ever\n// changes to \"cancelled\", then the returned promise will be rejected.\n// Else it will be resolved with a list of fetched documents.\n//\nfunction getDocs(src, target, diffs, state) {\n  diffs = clone(diffs); // we do not need to modify this\n\n  var resultDocs = [],\n      ok = true;\n\n  function getAllDocs() {\n\n    var bulkGetOpts = createBulkGetOpts(diffs);\n\n    if (!bulkGetOpts.docs.length) { // optimization: skip empty requests\n      return;\n    }\n\n    return src.bulkGet(bulkGetOpts).then(function (bulkGetResponse) {\n      /* istanbul ignore if */\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      return Promise.all(bulkGetResponse.results.map(function (bulkGetInfo) {\n        return Promise.all(bulkGetInfo.docs.map(function (doc) {\n          var remoteDoc = doc.ok;\n\n          if (doc.error) {\n            // when AUTO_COMPACTION is set, docs can be returned which look\n            // like this: {\"missing\":\"1-7c3ac256b693c462af8442f992b83696\"}\n            ok = false;\n          }\n\n          if (!remoteDoc || !remoteDoc._attachments) {\n            return remoteDoc;\n          }\n\n          return getDocAttachmentsFromTargetOrSource(target, src, remoteDoc)\n                   .then(function (attachments) {\n                           var filenames = Object.keys(remoteDoc._attachments);\n                           attachments\n                             .forEach(function (attachment, i) {\n                                        var att = remoteDoc._attachments[filenames[i]];\n                                        delete att.stub;\n                                        delete att.length;\n                                        att.data = attachment;\n                                      });\n\n                                      return remoteDoc;\n                                    });\n        }));\n      }))\n\n      .then(function (results) {\n        resultDocs = resultDocs.concat(flatten(results).filter(Boolean));\n      });\n    });\n  }\n\n  function hasAttachments(doc) {\n    return doc._attachments && Object.keys(doc._attachments).length > 0;\n  }\n\n  function hasConflicts(doc) {\n    return doc._conflicts && doc._conflicts.length > 0;\n  }\n\n  function fetchRevisionOneDocs(ids) {\n    // Optimization: fetch gen-1 docs and attachments in\n    // a single request using _all_docs\n    return src.allDocs({\n      keys: ids,\n      include_docs: true,\n      conflicts: true\n    }).then(function (res) {\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      res.rows.forEach(function (row) {\n        if (row.deleted || !row.doc || !isGenOne$1(row.value.rev) ||\n            hasAttachments(row.doc) || hasConflicts(row.doc)) {\n          // if any of these conditions apply, we need to fetch using get()\n          return;\n        }\n\n        // strip _conflicts array to appease CSG (#5793)\n        /* istanbul ignore if */\n        if (row.doc._conflicts) {\n          delete row.doc._conflicts;\n        }\n\n        // the doc we got back from allDocs() is sufficient\n        resultDocs.push(row.doc);\n        delete diffs[row.id];\n      });\n    });\n  }\n\n  function getRevisionOneDocs() {\n    // filter out the generation 1 docs and get them\n    // leaving the non-generation one docs to be got otherwise\n    var ids = Object.keys(diffs).filter(function (id) {\n      var missing = diffs[id].missing;\n      return missing.length === 1 && isGenOne$1(missing[0]);\n    });\n    if (ids.length > 0) {\n      return fetchRevisionOneDocs(ids);\n    }\n  }\n\n  function returnResult() {\n    return { ok:ok, docs:resultDocs };\n  }\n\n  return Promise.resolve()\n    .then(getRevisionOneDocs)\n    .then(getAllDocs)\n    .then(returnResult);\n}\n\nvar CHECKPOINT_VERSION = 1;\nvar REPLICATOR = \"pouchdb\";\n// This is an arbitrary number to limit the\n// amount of replication history we save in the checkpoint.\n// If we save too much, the checkpoing docs will become very big,\n// if we save fewer, we'll run a greater risk of having to\n// read all the changes from 0 when checkpoint PUTs fail\n// CouchDB 2.0 has a more involved history pruning,\n// but let's go for the simple version for now.\nvar CHECKPOINT_HISTORY_SIZE = 5;\nvar LOWEST_SEQ = 0;\n\nfunction updateCheckpoint(db, id, checkpoint, session, returnValue) {\n  return db.get(id).catch(function (err) {\n    if (err.status === 404) {\n      if (db.adapter === 'http' || db.adapter === 'https') {\n        explainError(\n          404, 'PouchDB is just checking if a remote checkpoint exists.'\n        );\n      }\n      return {\n        session_id: session,\n        _id: id,\n        history: [],\n        replicator: REPLICATOR,\n        version: CHECKPOINT_VERSION\n      };\n    }\n    throw err;\n  }).then(function (doc) {\n    if (returnValue.cancelled) {\n      return;\n    }\n\n    // if the checkpoint has not changed, do not update\n    if (doc.last_seq === checkpoint) {\n      return;\n    }\n\n    // Filter out current entry for this replication\n    doc.history = (doc.history || []).filter(function (item) {\n      return item.session_id !== session;\n    });\n\n    // Add the latest checkpoint to history\n    doc.history.unshift({\n      last_seq: checkpoint,\n      session_id: session\n    });\n\n    // Just take the last pieces in history, to\n    // avoid really big checkpoint docs.\n    // see comment on history size above\n    doc.history = doc.history.slice(0, CHECKPOINT_HISTORY_SIZE);\n\n    doc.version = CHECKPOINT_VERSION;\n    doc.replicator = REPLICATOR;\n\n    doc.session_id = session;\n    doc.last_seq = checkpoint;\n\n    return db.put(doc).catch(function (err) {\n      if (err.status === 409) {\n        // retry; someone is trying to write a checkpoint simultaneously\n        return updateCheckpoint(db, id, checkpoint, session, returnValue);\n      }\n      throw err;\n    });\n  });\n}\n\nfunction Checkpointer(src, target, id, returnValue, opts) {\n  this.src = src;\n  this.target = target;\n  this.id = id;\n  this.returnValue = returnValue;\n  this.opts = opts || {};\n}\n\nCheckpointer.prototype.writeCheckpoint = function (checkpoint, session) {\n  var self = this;\n  return this.updateTarget(checkpoint, session).then(function () {\n    return self.updateSource(checkpoint, session);\n  });\n};\n\nCheckpointer.prototype.updateTarget = function (checkpoint, session) {\n  if (this.opts.writeTargetCheckpoint) {\n    return updateCheckpoint(this.target, this.id, checkpoint,\n      session, this.returnValue);\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nCheckpointer.prototype.updateSource = function (checkpoint, session) {\n  if (this.opts.writeSourceCheckpoint) {\n    var self = this;\n    return updateCheckpoint(this.src, this.id, checkpoint,\n      session, this.returnValue)\n      .catch(function (err) {\n        if (isForbiddenError(err)) {\n          self.opts.writeSourceCheckpoint = false;\n          return true;\n        }\n        throw err;\n      });\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nvar comparisons = {\n  \"undefined\": function (targetDoc, sourceDoc) {\n    // This is the previous comparison function\n    if (collate(targetDoc.last_seq, sourceDoc.last_seq) === 0) {\n      return sourceDoc.last_seq;\n    }\n    /* istanbul ignore next */\n    return 0;\n  },\n  \"1\": function (targetDoc, sourceDoc) {\n    // This is the comparison function ported from CouchDB\n    return compareReplicationLogs(sourceDoc, targetDoc).last_seq;\n  }\n};\n\nCheckpointer.prototype.getCheckpoint = function () {\n  var self = this;\n\n  if (self.opts && self.opts.writeSourceCheckpoint && !self.opts.writeTargetCheckpoint) {\n    return self.src.get(self.id).then(function (sourceDoc) {\n      return sourceDoc.last_seq || LOWEST_SEQ;\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        throw err;\n      }\n      return LOWEST_SEQ;\n    });\n  }\n\n  return self.target.get(self.id).then(function (targetDoc) {\n    if (self.opts && self.opts.writeTargetCheckpoint && !self.opts.writeSourceCheckpoint) {\n      return targetDoc.last_seq || LOWEST_SEQ;\n    }\n\n    return self.src.get(self.id).then(function (sourceDoc) {\n      // Since we can't migrate an old version doc to a new one\n      // (no session id), we just go with the lowest seq in this case\n      /* istanbul ignore if */\n      if (targetDoc.version !== sourceDoc.version) {\n        return LOWEST_SEQ;\n      }\n\n      var version;\n      if (targetDoc.version) {\n        version = targetDoc.version.toString();\n      } else {\n        version = \"undefined\";\n      }\n\n      if (version in comparisons) {\n        return comparisons[version](targetDoc, sourceDoc);\n      }\n      /* istanbul ignore next */\n      return LOWEST_SEQ;\n    }, function (err) {\n      if (err.status === 404 && targetDoc.last_seq) {\n        return self.src.put({\n          _id: self.id,\n          last_seq: LOWEST_SEQ\n        }).then(function () {\n          return LOWEST_SEQ;\n        }, function (err) {\n          if (isForbiddenError(err)) {\n            self.opts.writeSourceCheckpoint = false;\n            return targetDoc.last_seq;\n          }\n          /* istanbul ignore next */\n          return LOWEST_SEQ;\n        });\n      }\n      throw err;\n    });\n  }).catch(function (err) {\n    if (err.status !== 404) {\n      throw err;\n    }\n    return LOWEST_SEQ;\n  });\n};\n// This checkpoint comparison is ported from CouchDBs source\n// they come from here:\n// https://github.com/apache/couchdb-couch-replicator/blob/master/src/couch_replicator.erl#L863-L906\n\nfunction compareReplicationLogs(srcDoc, tgtDoc) {\n  if (srcDoc.session_id === tgtDoc.session_id) {\n    return {\n      last_seq: srcDoc.last_seq,\n      history: srcDoc.history\n    };\n  }\n\n  return compareReplicationHistory(srcDoc.history, tgtDoc.history);\n}\n\nfunction compareReplicationHistory(sourceHistory, targetHistory) {\n  // the erlang loop via function arguments is not so easy to repeat in JS\n  // therefore, doing this as recursion\n  var S = sourceHistory[0];\n  var sourceRest = sourceHistory.slice(1);\n  var T = targetHistory[0];\n  var targetRest = targetHistory.slice(1);\n\n  if (!S || targetHistory.length === 0) {\n    return {\n      last_seq: LOWEST_SEQ,\n      history: []\n    };\n  }\n\n  var sourceId = S.session_id;\n  /* istanbul ignore if */\n  if (hasSessionId(sourceId, targetHistory)) {\n    return {\n      last_seq: S.last_seq,\n      history: sourceHistory\n    };\n  }\n\n  var targetId = T.session_id;\n  if (hasSessionId(targetId, sourceRest)) {\n    return {\n      last_seq: T.last_seq,\n      history: targetRest\n    };\n  }\n\n  return compareReplicationHistory(sourceRest, targetRest);\n}\n\nfunction hasSessionId(sessionId, history) {\n  var props = history[0];\n  var rest = history.slice(1);\n\n  if (!sessionId || history.length === 0) {\n    return false;\n  }\n\n  if (sessionId === props.session_id) {\n    return true;\n  }\n\n  return hasSessionId(sessionId, rest);\n}\n\nfunction isForbiddenError(err) {\n  return typeof err.status === 'number' && Math.floor(err.status / 100) === 4;\n}\n\nvar STARTING_BACK_OFF = 0;\n\nfunction backOff(opts, returnValue, error, callback) {\n  if (opts.retry === false) {\n    returnValue.emit('error', error);\n    returnValue.removeAllListeners();\n    return;\n  }\n  /* istanbul ignore if */\n  if (typeof opts.back_off_function !== 'function') {\n    opts.back_off_function = defaultBackOff;\n  }\n  returnValue.emit('requestError', error);\n  if (returnValue.state === 'active' || returnValue.state === 'pending') {\n    returnValue.emit('paused', error);\n    returnValue.state = 'stopped';\n    var backOffSet = function backoffTimeSet() {\n      opts.current_back_off = STARTING_BACK_OFF;\n    };\n    var removeBackOffSetter = function removeBackOffTimeSet() {\n      returnValue.removeListener('active', backOffSet);\n    };\n    returnValue.once('paused', removeBackOffSetter);\n    returnValue.once('active', backOffSet);\n  }\n\n  opts.current_back_off = opts.current_back_off || STARTING_BACK_OFF;\n  opts.current_back_off = opts.back_off_function(opts.current_back_off);\n  setTimeout(callback, opts.current_back_off);\n}\n\nfunction sortObjectPropertiesByKey(queryParams) {\n  return Object.keys(queryParams).sort(collate).reduce(function (result, key) {\n    result[key] = queryParams[key];\n    return result;\n  }, {});\n}\n\n// Generate a unique id particular to this replication.\n// Not guaranteed to align perfectly with CouchDB's rep ids.\nfunction generateReplicationId(src, target, opts) {\n  var docIds = opts.doc_ids ? opts.doc_ids.sort(collate) : '';\n  var filterFun = opts.filter ? opts.filter.toString() : '';\n  var queryParams = '';\n  var filterViewName =  '';\n  var selector = '';\n\n  // possibility for checkpoints to be lost here as behaviour of\n  // JSON.stringify is not stable (see #6226)\n  /* istanbul ignore if */\n  if (opts.selector) {\n    selector = JSON.stringify(opts.selector);\n  }\n\n  if (opts.filter && opts.query_params) {\n    queryParams = JSON.stringify(sortObjectPropertiesByKey(opts.query_params));\n  }\n\n  if (opts.filter && opts.filter === '_view') {\n    filterViewName = opts.view.toString();\n  }\n\n  return Promise.all([src.id(), target.id()]).then(function (res) {\n    var queryData = res[0] + res[1] + filterFun + filterViewName +\n      queryParams + docIds + selector;\n    return new Promise(function (resolve) {\n      binaryMd5(queryData, resolve);\n    });\n  }).then(function (md5sum) {\n    // can't use straight-up md5 alphabet, because\n    // the char '/' is interpreted as being for attachments,\n    // and + is also not url-safe\n    md5sum = md5sum.replace(/\\//g, '.').replace(/\\+/g, '_');\n    return '_local/' + md5sum;\n  });\n}\n\nfunction replicate(src, target, opts, returnValue, result) {\n  var batches = [];               // list of batches to be processed\n  var currentBatch;               // the batch currently being processed\n  var pendingBatch = {\n    seq: 0,\n    changes: [],\n    docs: []\n  }; // next batch, not yet ready to be processed\n  var writingCheckpoint = false;  // true while checkpoint is being written\n  var changesCompleted = false;   // true when all changes received\n  var replicationCompleted = false; // true when replication has completed\n  var last_seq = 0;\n  var continuous = opts.continuous || opts.live || false;\n  var batch_size = opts.batch_size || 100;\n  var batches_limit = opts.batches_limit || 10;\n  var changesPending = false;     // true while src.changes is running\n  var doc_ids = opts.doc_ids;\n  var selector = opts.selector;\n  var repId;\n  var checkpointer;\n  var changedDocs = [];\n  // Like couchdb, every replication gets a unique session id\n  var session = uuid();\n\n  result = result || {\n    ok: true,\n    start_time: new Date().toISOString(),\n    docs_read: 0,\n    docs_written: 0,\n    doc_write_failures: 0,\n    errors: []\n  };\n\n  var changesOpts = {};\n  returnValue.ready(src, target);\n\n  function initCheckpointer() {\n    if (checkpointer) {\n      return Promise.resolve();\n    }\n    return generateReplicationId(src, target, opts).then(function (res) {\n      repId = res;\n\n      var checkpointOpts = {};\n      if (opts.checkpoint === false) {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'source') {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'target') {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: true };\n      } else {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: true };\n      }\n\n      checkpointer = new Checkpointer(src, target, repId, returnValue, checkpointOpts);\n    });\n  }\n\n  function writeDocs() {\n    changedDocs = [];\n\n    if (currentBatch.docs.length === 0) {\n      return;\n    }\n    var docs = currentBatch.docs;\n    var bulkOpts = {timeout: opts.timeout};\n    return target.bulkDocs({docs: docs, new_edits: false}, bulkOpts).then(function (res) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n\n      // `res` doesn't include full documents (which live in `docs`), so we create a map of \n      // (id -> error), and check for errors while iterating over `docs`\n      var errorsById = Object.create(null);\n      res.forEach(function (res) {\n        if (res.error) {\n          errorsById[res.id] = res;\n        }\n      });\n\n      var errorsNo = Object.keys(errorsById).length;\n      result.doc_write_failures += errorsNo;\n      result.docs_written += docs.length - errorsNo;\n\n      docs.forEach(function (doc) {\n        var error = errorsById[doc._id];\n        if (error) {\n          result.errors.push(error);\n          // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n          var errorName = (error.name || '').toLowerCase();\n          if (errorName === 'unauthorized' || errorName === 'forbidden') {\n            returnValue.emit('denied', clone(error));\n          } else {\n            throw error;\n          }\n        } else {\n          changedDocs.push(doc);\n        }\n      });\n\n    }, function (err) {\n      result.doc_write_failures += docs.length;\n      throw err;\n    });\n  }\n\n  function finishBatch() {\n    if (currentBatch.error) {\n      throw new Error('There was a problem getting docs.');\n    }\n    result.last_seq = last_seq = currentBatch.seq;\n    var outResult = clone(result);\n    if (changedDocs.length) {\n      outResult.docs = changedDocs;\n      // Attach 'pending' property if server supports it (CouchDB 2.0+)\n      /* istanbul ignore if */\n      if (typeof currentBatch.pending === 'number') {\n        outResult.pending = currentBatch.pending;\n        delete currentBatch.pending;\n      }\n      returnValue.emit('change', outResult);\n    }\n    writingCheckpoint = true;\n    return checkpointer.writeCheckpoint(currentBatch.seq,\n        session).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      currentBatch = undefined;\n      getChanges();\n    }).catch(function (err) {\n      onCheckpointError(err);\n      throw err;\n    });\n  }\n\n  function getDiffs() {\n    var diff = {};\n    currentBatch.changes.forEach(function (change) {\n      // Couchbase Sync Gateway emits these, but we can ignore them\n      /* istanbul ignore if */\n      if (change.id === \"_user/\") {\n        return;\n      }\n      diff[change.id] = change.changes.map(function (x) {\n        return x.rev;\n      });\n    });\n    return target.revsDiff(diff).then(function (diffs) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      // currentBatch.diffs elements are deleted as the documents are written\n      currentBatch.diffs = diffs;\n    });\n  }\n\n  function getBatchDocs() {\n    return getDocs(src, target, currentBatch.diffs, returnValue).then(function (got) {\n      currentBatch.error = !got.ok;\n      got.docs.forEach(function (doc) {\n        delete currentBatch.diffs[doc._id];\n        result.docs_read++;\n        currentBatch.docs.push(doc);\n      });\n    });\n  }\n\n  function startNextBatch() {\n    if (returnValue.cancelled || currentBatch) {\n      return;\n    }\n    if (batches.length === 0) {\n      processPendingBatch(true);\n      return;\n    }\n    currentBatch = batches.shift();\n    getDiffs()\n      .then(getBatchDocs)\n      .then(writeDocs)\n      .then(finishBatch)\n      .then(startNextBatch)\n      .catch(function (err) {\n        abortReplication('batch processing terminated with error', err);\n      });\n  }\n\n\n  function processPendingBatch(immediate) {\n    if (pendingBatch.changes.length === 0) {\n      if (batches.length === 0 && !currentBatch) {\n        if ((continuous && changesOpts.live) || changesCompleted) {\n          returnValue.state = 'pending';\n          returnValue.emit('paused');\n        }\n        if (changesCompleted) {\n          completeReplication();\n        }\n      }\n      return;\n    }\n    if (\n      immediate ||\n      changesCompleted ||\n      pendingBatch.changes.length >= batch_size\n    ) {\n      batches.push(pendingBatch);\n      pendingBatch = {\n        seq: 0,\n        changes: [],\n        docs: []\n      };\n      if (returnValue.state === 'pending' || returnValue.state === 'stopped') {\n        returnValue.state = 'active';\n        returnValue.emit('active');\n      }\n      startNextBatch();\n    }\n  }\n\n\n  function abortReplication(reason, err) {\n    if (replicationCompleted) {\n      return;\n    }\n    if (!err.message) {\n      err.message = reason;\n    }\n    result.ok = false;\n    result.status = 'aborting';\n    batches = [];\n    pendingBatch = {\n      seq: 0,\n      changes: [],\n      docs: []\n    };\n    completeReplication(err);\n  }\n\n\n  function completeReplication(fatalError) {\n    if (replicationCompleted) {\n      return;\n    }\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      result.status = 'cancelled';\n      if (writingCheckpoint) {\n        return;\n      }\n    }\n    result.status = result.status || 'complete';\n    result.end_time = new Date().toISOString();\n    result.last_seq = last_seq;\n    replicationCompleted = true;\n\n    if (fatalError) {\n      // need to extend the error because Firefox considers \".result\" read-only\n      fatalError = createError(fatalError);\n      fatalError.result = result;\n\n      // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n      var errorName = (fatalError.name || '').toLowerCase();\n      if (errorName === 'unauthorized' || errorName === 'forbidden') {\n        returnValue.emit('error', fatalError);\n        returnValue.removeAllListeners();\n      } else {\n        backOff(opts, returnValue, fatalError, function () {\n          replicate(src, target, opts, returnValue);\n        });\n      }\n    } else {\n      returnValue.emit('complete', result);\n      returnValue.removeAllListeners();\n    }\n  }\n\n\n  function onChange(change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    // Attach 'pending' property if server supports it (CouchDB 2.0+)\n    /* istanbul ignore if */\n    if (typeof pending === 'number') {\n      pendingBatch.pending = pending;\n    }\n\n    var filter = filterChange(opts)(change);\n    if (!filter) {\n      return;\n    }\n    pendingBatch.seq = change.seq || lastSeq;\n    pendingBatch.changes.push(change);\n    nextTick(function () {\n      processPendingBatch(batches.length === 0 && changesOpts.live);\n    });\n  }\n\n\n  function onChangesComplete(changes) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n\n    // if no results were returned then we're done,\n    // else fetch more\n    if (changes.results.length > 0) {\n      changesOpts.since = changes.results[changes.results.length - 1].seq;\n      getChanges();\n      processPendingBatch(true);\n    } else {\n\n      var complete = function () {\n        if (continuous) {\n          changesOpts.live = true;\n          getChanges();\n        } else {\n          changesCompleted = true;\n        }\n        processPendingBatch(true);\n      };\n\n      // update the checkpoint so we start from the right seq next time\n      if (!currentBatch && changes.results.length === 0) {\n        writingCheckpoint = true;\n        checkpointer.writeCheckpoint(changes.last_seq,\n            session).then(function () {\n          writingCheckpoint = false;\n          result.last_seq = last_seq = changes.last_seq;\n          complete();\n        })\n        .catch(onCheckpointError);\n      } else {\n        complete();\n      }\n    }\n  }\n\n\n  function onChangesError(err) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    abortReplication('changes rejected', err);\n  }\n\n\n  function getChanges() {\n    if (!(\n      !changesPending &&\n      !changesCompleted &&\n      batches.length < batches_limit\n      )) {\n      return;\n    }\n    changesPending = true;\n    function abortChanges() {\n      changes.cancel();\n    }\n    function removeListener() {\n      returnValue.removeListener('cancel', abortChanges);\n    }\n\n    if (returnValue._changes) { // remove old changes() and listeners\n      returnValue.removeListener('cancel', returnValue._abortChanges);\n      returnValue._changes.cancel();\n    }\n    returnValue.once('cancel', abortChanges);\n\n    var changes = src.changes(changesOpts)\n      .on('change', onChange);\n    changes.then(removeListener, removeListener);\n    changes.then(onChangesComplete)\n      .catch(onChangesError);\n\n    if (opts.retry) {\n      // save for later so we can cancel if necessary\n      returnValue._changes = changes;\n      returnValue._abortChanges = abortChanges;\n    }\n  }\n\n\n  function startChanges() {\n    initCheckpointer().then(function () {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      return checkpointer.getCheckpoint().then(function (checkpoint) {\n        last_seq = checkpoint;\n        changesOpts = {\n          since: last_seq,\n          limit: batch_size,\n          batch_size: batch_size,\n          style: 'all_docs',\n          doc_ids: doc_ids,\n          selector: selector,\n          return_docs: true // required so we know when we're done\n        };\n        if (opts.filter) {\n          if (typeof opts.filter !== 'string') {\n            // required for the client-side filter in onChange\n            changesOpts.include_docs = true;\n          } else { // ddoc filter\n            changesOpts.filter = opts.filter;\n          }\n        }\n        if ('heartbeat' in opts) {\n          changesOpts.heartbeat = opts.heartbeat;\n        }\n        if ('timeout' in opts) {\n          changesOpts.timeout = opts.timeout;\n        }\n        if (opts.query_params) {\n          changesOpts.query_params = opts.query_params;\n        }\n        if (opts.view) {\n          changesOpts.view = opts.view;\n        }\n        getChanges();\n      });\n    }).catch(function (err) {\n      abortReplication('getCheckpoint rejected with ', err);\n    });\n  }\n\n  /* istanbul ignore next */\n  function onCheckpointError(err) {\n    writingCheckpoint = false;\n    abortReplication('writeCheckpoint completed with error', err);\n  }\n\n  /* istanbul ignore if */\n  if (returnValue.cancelled) { // cancelled immediately\n    completeReplication();\n    return;\n  }\n\n  if (!returnValue._addedListeners) {\n    returnValue.once('cancel', completeReplication);\n\n    if (typeof opts.complete === 'function') {\n      returnValue.once('error', opts.complete);\n      returnValue.once('complete', function (result) {\n        opts.complete(null, result);\n      });\n    }\n    returnValue._addedListeners = true;\n  }\n\n  if (typeof opts.since === 'undefined') {\n    startChanges();\n  } else {\n    initCheckpointer().then(function () {\n      writingCheckpoint = true;\n      return checkpointer.writeCheckpoint(opts.since, session);\n    }).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      last_seq = opts.since;\n      startChanges();\n    }).catch(onCheckpointError);\n  }\n}\n\n// We create a basic promise so the caller can cancel the replication possibly\n// before we have actually started listening to changes etc\ninherits(Replication, EventEmitter);\nfunction Replication() {\n  EventEmitter.call(this);\n  this.cancelled = false;\n  this.state = 'pending';\n  var self = this;\n  var promise = new Promise(function (fulfill, reject) {\n    self.once('complete', fulfill);\n    self.once('error', reject);\n  });\n  self.then = function (resolve, reject) {\n    return promise.then(resolve, reject);\n  };\n  self.catch = function (reject) {\n    return promise.catch(reject);\n  };\n  // As we allow error handling via \"error\" event as well,\n  // put a stub in here so that rejecting never throws UnhandledError.\n  self.catch(function () {});\n}\n\nReplication.prototype.cancel = function () {\n  this.cancelled = true;\n  this.state = 'cancelled';\n  this.emit('cancel');\n};\n\nReplication.prototype.ready = function (src, target) {\n  var self = this;\n  if (self._readyCalled) {\n    return;\n  }\n  self._readyCalled = true;\n\n  function onDestroy() {\n    self.cancel();\n  }\n  src.once('destroyed', onDestroy);\n  target.once('destroyed', onDestroy);\n  function cleanup() {\n    src.removeListener('destroyed', onDestroy);\n    target.removeListener('destroyed', onDestroy);\n  }\n  self.once('complete', cleanup);\n};\n\nfunction toPouch(db, opts) {\n  var PouchConstructor = opts.PouchConstructor;\n  if (typeof db === 'string') {\n    return new PouchConstructor(db, opts);\n  } else {\n    return db;\n  }\n}\n\nfunction replicateWrapper(src, target, opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n\n  if (opts.doc_ids && !Array.isArray(opts.doc_ids)) {\n    throw createError(BAD_REQUEST,\n                       \"`doc_ids` filter parameter is not a list.\");\n  }\n\n  opts.complete = callback;\n  opts = clone(opts);\n  opts.continuous = opts.continuous || opts.live;\n  opts.retry = ('retry' in opts) ? opts.retry : false;\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  var replicateRet = new Replication(opts);\n  var srcPouch = toPouch(src, opts);\n  var targetPouch = toPouch(target, opts);\n  replicate(srcPouch, targetPouch, opts, replicateRet);\n  return replicateRet;\n}\n\ninherits(Sync, EventEmitter);\nfunction sync(src, target, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n  opts = clone(opts);\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  src = toPouch(src, opts);\n  target = toPouch(target, opts);\n  return new Sync(src, target, opts, callback);\n}\n\nfunction Sync(src, target, opts, callback) {\n  var self = this;\n  this.canceled = false;\n\n  var optsPush = opts.push ? $inject_Object_assign({}, opts, opts.push) : opts;\n  var optsPull = opts.pull ? $inject_Object_assign({}, opts, opts.pull) : opts;\n\n  this.push = replicateWrapper(src, target, optsPush);\n  this.pull = replicateWrapper(target, src, optsPull);\n\n  this.pushPaused = true;\n  this.pullPaused = true;\n\n  function pullChange(change) {\n    self.emit('change', {\n      direction: 'pull',\n      change: change\n    });\n  }\n  function pushChange(change) {\n    self.emit('change', {\n      direction: 'push',\n      change: change\n    });\n  }\n  function pushDenied(doc) {\n    self.emit('denied', {\n      direction: 'push',\n      doc: doc\n    });\n  }\n  function pullDenied(doc) {\n    self.emit('denied', {\n      direction: 'pull',\n      doc: doc\n    });\n  }\n  function pushPaused() {\n    self.pushPaused = true;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('paused');\n    }\n  }\n  function pullPaused() {\n    self.pullPaused = true;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('paused');\n    }\n  }\n  function pushActive() {\n    self.pushPaused = false;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('active', {\n        direction: 'push'\n      });\n    }\n  }\n  function pullActive() {\n    self.pullPaused = false;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('active', {\n        direction: 'pull'\n      });\n    }\n  }\n\n  var removed = {};\n\n  function removeAll(type) { // type is 'push' or 'pull'\n    return function (event, func) {\n      var isChange = event === 'change' &&\n        (func === pullChange || func === pushChange);\n      var isDenied = event === 'denied' &&\n        (func === pullDenied || func === pushDenied);\n      var isPaused = event === 'paused' &&\n        (func === pullPaused || func === pushPaused);\n      var isActive = event === 'active' &&\n        (func === pullActive || func === pushActive);\n\n      if (isChange || isDenied || isPaused || isActive) {\n        if (!(event in removed)) {\n          removed[event] = {};\n        }\n        removed[event][type] = true;\n        if (Object.keys(removed[event]).length === 2) {\n          // both push and pull have asked to be removed\n          self.removeAllListeners(event);\n        }\n      }\n    };\n  }\n\n  if (opts.live) {\n    this.push.on('complete', self.pull.cancel.bind(self.pull));\n    this.pull.on('complete', self.push.cancel.bind(self.push));\n  }\n\n  function addOneListener(ee, event, listener) {\n    if (ee.listeners(event).indexOf(listener) == -1) {\n      ee.on(event, listener);\n    }\n  }\n\n  this.on('newListener', function (event) {\n    if (event === 'change') {\n      addOneListener(self.pull, 'change', pullChange);\n      addOneListener(self.push, 'change', pushChange);\n    } else if (event === 'denied') {\n      addOneListener(self.pull, 'denied', pullDenied);\n      addOneListener(self.push, 'denied', pushDenied);\n    } else if (event === 'active') {\n      addOneListener(self.pull, 'active', pullActive);\n      addOneListener(self.push, 'active', pushActive);\n    } else if (event === 'paused') {\n      addOneListener(self.pull, 'paused', pullPaused);\n      addOneListener(self.push, 'paused', pushPaused);\n    }\n  });\n\n  this.on('removeListener', function (event) {\n    if (event === 'change') {\n      self.pull.removeListener('change', pullChange);\n      self.push.removeListener('change', pushChange);\n    } else if (event === 'denied') {\n      self.pull.removeListener('denied', pullDenied);\n      self.push.removeListener('denied', pushDenied);\n    } else if (event === 'active') {\n      self.pull.removeListener('active', pullActive);\n      self.push.removeListener('active', pushActive);\n    } else if (event === 'paused') {\n      self.pull.removeListener('paused', pullPaused);\n      self.push.removeListener('paused', pushPaused);\n    }\n  });\n\n  this.pull.on('removeListener', removeAll('pull'));\n  this.push.on('removeListener', removeAll('push'));\n\n  var promise = Promise.all([\n    this.push,\n    this.pull\n  ]).then(function (resp) {\n    var out = {\n      push: resp[0],\n      pull: resp[1]\n    };\n    self.emit('complete', out);\n    if (callback) {\n      callback(null, out);\n    }\n    self.removeAllListeners();\n    return out;\n  }, function (err) {\n    self.cancel();\n    if (callback) {\n      // if there's a callback, then the callback can receive\n      // the error event\n      callback(err);\n    } else {\n      // if there's no callback, then we're safe to emit an error\n      // event, which would otherwise throw an unhandled error\n      // due to 'error' being a special event in EventEmitters\n      self.emit('error', err);\n    }\n    self.removeAllListeners();\n    if (callback) {\n      // no sense throwing if we're already emitting an 'error' event\n      throw err;\n    }\n  });\n\n  this.then = function (success, err) {\n    return promise.then(success, err);\n  };\n\n  this.catch = function (err) {\n    return promise.catch(err);\n  };\n}\n\nSync.prototype.cancel = function () {\n  if (!this.canceled) {\n    this.canceled = true;\n    this.push.cancel();\n    this.pull.cancel();\n  }\n};\n\nfunction replication(PouchDB) {\n  PouchDB.replicate = replicateWrapper;\n  PouchDB.sync = sync;\n\n  Object.defineProperty(PouchDB.prototype, 'replicate', {\n    get: function () {\n      var self = this;\n      if (typeof this.replicateMethods === 'undefined') {\n        this.replicateMethods = {\n          from: function (other, opts, callback) {\n            return self.constructor.replicate(other, self, opts, callback);\n          },\n          to: function (other, opts, callback) {\n            return self.constructor.replicate(self, other, opts, callback);\n          }\n        };\n      }\n      return this.replicateMethods;\n    }\n  });\n\n  PouchDB.prototype.sync = function (dbName, opts, callback) {\n    return this.constructor.sync(this, dbName, opts, callback);\n  };\n}\n\nPouchDB.plugin(IDBPouch)\n  .plugin(HttpPouch$1)\n  .plugin(mapreduce)\n  .plugin(replication);\n\n// Pull from src because pouchdb-node/pouchdb-browser themselves\n\nexport default PouchDB;\n","const { listen } = require('./listen')\nconst { actions } = require('../actions')\nconst PouchDB = require('pouchdb')\n\n\nexports.api = app => {\n  let docs\n\n  const options = { live: true, retry: true, since: 0 }\n  const localDB = new PouchDB.default('timothymcallister')\n  const remoteDB = new PouchDB.default('http://192.168.1.86:5984/timothymcallister')\n\n  const binarySearch = (arr, docId) => {\n    let low = 0, high = arr.length, mid\n    while (low < high) {\n      mid = (low + high) >>> 1\n      arr[mid]._id < docId ? low = mid + 1 : high = mid\n    }\n    return low\n  }\n\n  const fetchDocs = () =>\n    localDB.allDocs({ attachments: true, include_docs: true }).then(result => {\n      docs = result.rows.map(row => row.doc)\n\n      const listener = listen(app, actions(app, localDB, docs))\n\n      window.addEventListener('unload', () => {\n        listener.remove()\n        sync.cancel()\n      })\n\n      app.update(docs)\n    })\n\n  const onDeleted = id => {\n    const index = binarySearch(docs, id)\n    const doc = docs[index]\n\n    if (doc && doc._id === id) {\n      docs.splice(index, 1)\n    }\n  }\n\n  const onUpdatedOrInserted = newDoc => {\n    const index = binarySearch(docs, newDoc._id)\n    const doc = docs[index]\n\n    if (doc && doc._id === newDoc._id) {\n      docs[index] = newDoc\n    } else {\n      docs.splice(index, 0, newDoc)\n    }\n  }\n\n  const reactToChanges = () => {\n    localDB.changes({ include_docs: true, live: true, since: 'now' })\n      .on('change', change => {\n        if (change.deleted) {\n          onDeleted(change.id)\n        } else {\n          onUpdatedOrInserted(change.doc)\n        }\n        app.update(docs)\n      })\n      .on('error', error => console.log.bind(console))\n  }\n\n  const sync = PouchDB.default.sync(localDB, remoteDB, options)\n    .on('complete', info => console.info(info))\n    .on('paused', info => console.info(info))\n    .on('active', info => console.info(info))\n    .on('denied', error => console.error(error))\n    .on('error', error => console.error(error))\n\n  fetchDocs().then(reactToChanges).catch(console.log.bind(console))\n}\n","exports.dispatch = function(target, type, data) {\n  const event = new window.CustomEvent('redom', {\n    bubbles: true,\n    detail: { type, data }\n  })\n\n  const el = target.el || target\n\n  el.dispatchEvent(event)\n}\n","const { h, setChildren, setStyle, text } = require('redom')\n\nmodule.exports = class Button {\n  constructor(config) {\n    const defaultConfig = {\n      cls: '',\n      iconPosition: 'left'\n    }\n\n    config = Object.assign(defaultConfig, config)\n\n    let iconSpacing, flexDirection = 'flex-row', flexOrder = '0'\n\n    switch (config.iconPosition) {\n      case 'b':\n      case 'bottom':\n        flexDirection = 'flex-column'\n        flexOrder = 'order-1'\n        iconSpacing = 'mt2'\n      break\n\n      case 'r':\n      case 'right':\n        flexOrder = 'order-1'\n        iconSpacing = 'ml2'\n      break\n\n      case 't':\n      case 'top':\n        flexDirection = 'flex-column'\n        iconSpacing = 'mb2'\n      break\n\n      case 'l':\n      default:\n        iconSpacing = 'mr2'\n      break\n    }\n\n    iconSpacing = config.text ? iconSpacing : 'ma0'\n\n    const icon = config.icon\n      ? this.icon = h(`span.flex.${flexOrder}.items-center.justify-center.${iconSpacing}`, config.icon)\n      : ''\n\n    const textContent = text(config.text ? config.text : '')\n\n    this.el = h(`button.bg-animate.bg-black-05.bn.br2.f6.input-reset.outline-0.pa0${config.cls}`,\n      h(`.flex.${flexDirection}.items-center.justify-center.ph3.pointer-events-none.pv2`,\n        this.icon = icon,\n        this.text = textContent\n      )\n    )\n\n    if (config.id) {\n      this.el.id = config.id\n    }\n\n    if (config.title) {\n      this.el.title = config.title\n    }\n\n    if (config.disabled) {\n      this.setDisabled()\n    }\n\n    this.el.onclick = e => {\n      e.preventDefault()\n\n      if (config.onclick) {\n        config.onclick.call(this, e)\n      }\n    }\n  }\n\n  setDisabled() {\n    this.el.disabled = true\n    setStyle(this.el, { opacity: 0.5 })\n  }\n\n  setEnabled() {\n    this.el.disabled = false\n    setStyle(this.el, { opacity: 1 })\n  }\n\n  setIcon(icon) {\n    setChildren(this.icon, icon)\n  }\n\n  setText(text) {\n    this.text.textContent = text\n  }\n}\n","const { svg } = require('redom')\nconst icons = require('../images/Icons.svg')\n\nmodule.exports = class Icon {\n  constructor(config) {\n    const defaultConfig = {\n      cls: '',\n      name: '',\n    }\n\n    config = Object.assign(defaultConfig, config)\n\n    this.el = svg(`svg${config.cls}`,\n      svg('use', { 'fill': 'currentColor', 'href': `${icons}#${config.name}` })\n    )\n  }\n}\n","const { h, list } = require('redom')\nconst { dispatch } = require('../library/dispatch')\n\nmodule.exports = class List {\n  constructor(config) {\n    class ListItem {\n      constructor() {\n        if (config.cell) {\n          this.cell = new config.cell()\n          this.el = h('li', this.cell)\n        }\n      }\n\n      update(data) {\n        this.el.id = data._id\n\n        if (this.cell) {\n          this.cell.update(data)\n        }\n      }\n    }\n\n    this.el = list(`ul.list.ma0.overflow-y-auto.pa0${config.class || ''}`, ListItem, config.key || null)\n    this.el.el.id = config.id || ''\n\n    this.el.el.onclick = e => {\n      if (e.target.nodeName === 'UL') return\n\n      this.toggleSelection(e)\n\n      dispatch(this.el, 'list:selection', {\n        list: this.el.el,\n        target: this.selectedElement.parentNode\n      })\n    }\n\n    this.selectedElement = null\n\n    this.selectedClasses = config.selectedClasses || ['bg-black-05', 'black']\n  }\n\n  selectElementById(id) {\n    const el = document.getElementById(id)\n\n    if (el) {\n      this.toggleSelection({ target: el.firstElementChild })\n      this.selectedElement.scrollIntoViewIfNeeded()\n    }\n  }\n\n  selectElementByIndex(index) {\n    if (this.el.el.childNodes.length) {\n      this.toggleSelection({ target: this.el.el.childNodes[index] })\n      this.selectedElement.scrollIntoViewIfNeeded()\n    }\n  }\n\n  toggleSelection(e) {\n    if (this.selectedElement) {\n      this.selectedElement.classList.remove(...this.selectedClasses)\n    }\n\n    this.selectedElement = e.target\n    this.selectedElement.classList.add(...this.selectedClasses)\n  }\n\n  update(data) {\n    this.el.update(data)\n\n    if (!this.selectedElement && this.el.el.children.length) {\n      this.toggleSelection({ target: this.el.el.firstChild })\n    }\n  }\n}\n","const { h, text } = require('redom')\nconst Icon = require('./Icon')\n\nmodule.exports = class CollectionItem {\n  constructor() {\n    this.el = h('.f5.flex.items-center.pa3',\n      h('.flex.items-center',\n        new Icon({ cls: '.h2.mr3.w2', name: 'Collection' }),\n      ),\n\n      this.text = text()\n    )\n  }\n\n  update(data) {\n    this.text.textContent = data.name\n  }\n}\n","const { h, setChildren } = require('redom')\n\nmodule.exports = class Toolbar {\n  constructor(config) {\n    const defaultConfig = {\n      border: true,\n      cls: '',\n      items: [],\n      spacing: true,\n    }\n\n    config = Object.assign(defaultConfig, config)\n\n    if (config.border) {\n      config.cls += '.b--black-10'\n    } else {\n      config.cls += '.b--transparent'\n    }\n\n    if (config.spacing) {\n      config.cls += '.ph3.pv2'\n    }\n\n    this.el = h(`.bb.bt.flex.flex-none.items-center.relative${config.cls}`)\n\n    setChildren(this.el, config.items)\n  }\n}\n","const { h, setStyle } = require('redom')\nconst { dispatch } = require('../library/dispatch')\nconst Button = require('./Button')\nconst Icon = require('./Icon')\nconst List = require('./List')\nconst CollectionItem = require('./CollectionItem')\nconst Toolbar = require('./Toolbar')\n\nmodule.exports = class CollectionsList {\n  constructor() {\n    this.el = h('.b--black-10.bg-black-025.bottom-0.br.fixed.flex.flex-column.left-0.top-0.vh-100',\n\n      new Toolbar({\n        border: false,\n        items: [\n          h('h1.f3.fw7.black.lh-title.ma0', 'Collections'),\n        ]\n      }),\n\n      this.list = new List({\n        cell: CollectionItem,\n        class: '.black-50.flex-auto',\n        id: 'collections',\n        key: '_id',\n        selectedClasses: ['bg-black-05', 'blue']\n      }),\n\n      new Toolbar({\n        border: false,\n        items: [\n          new Button({\n            icon: new Icon({\n              cls: '.h1.w1',\n              name: 'Add'\n            }),\n            onclick: e => dispatch(this, 'collection:add', e)\n          })\n        ]\n      })\n    )\n\n    setStyle(this.el, { width: '320px' })\n  }\n\n  update(docs) {\n    const collections = docs.filter(doc => doc.type === 'collection')\n    this.list.update(collections)\n    this.list.selectElementById(localStorage.getItem('selectedCollection'))\n  }\n}\n","const { h } = require('redom')\nconst { dispatch } = require('../../library/dispatch')\n\nmodule.exports = class Field {\n  constructor(config) {\n    const defaultConfig = {\n      afterFieldDecorator: h(''),\n      beforeFieldDecorator: h(''),\n    }\n\n    config = Object.assign(defaultConfig, config)\n\n    const required = config.required ? ' *' : ''\n    const label = `${config.label}${required}`\n    let help = ''\n\n    if (config.help) {\n      help = h('p.black-50.f7.lh-copy.ma0.mt1', config.help)\n    }\n\n    this.el = h('.mb4',\n      this.label = h('label.black-50.db.f7.fw6.mb3.tracked.ttu', label),\n\n      this.beforeFieldDecorator = config.beforeFieldDecorator,\n\n      this.content = h(''),\n\n      this.afterFieldDecorator = config.afterFieldDecorator,\n\n      this.help = help,\n    )\n  }\n}\n","const { h, setChildren } = require('redom')\nconst Field = require('./Field')\n\nmodule.exports = class Input extends Field {\n  constructor(config, data) {\n    super(config, data)\n\n    const defaultConfig = {\n      oninput: () => {},\n      singleLine: true\n    }\n\n    const attributes = {\n      autocapitalize: 'off',\n      autocorrect: 'off',\n      autocomplete: config.name,\n      name: config.name,\n      required: config.required,\n      spellcheck: false,\n      value: data || '',\n    }\n\n    config = Object.assign(defaultConfig, config)\n\n    let el = config.singleLine ? 'input' : 'textarea'\n\n    if (config.singleLine === false) {\n      attributes.rows = 10\n      attributes.style = 'resize: none'\n    }\n\n    this.field = h(`${el}.bg-black-05.black.bn.border-box.br2.db.f5.lh-copy.input-reset.ma0.pa2.w-100`, attributes)\n\n    this.field.oninput = config.oninput\n\n    setChildren(this.content, this.field)\n  }\n}\n","const Input = require('./Input')\n\nmodule.exports = class Color extends Input {\n  constructor(config, data) {\n    config = Object.assign(config, {\n      attributes: {\n        type: 'color'\n      },\n    })\n\n    super(config, data)\n\n    this.field.classList.add('h3')\n  }\n}\n","const Input = require('./Input')\n\nmodule.exports = class Datetime extends Input {\n  constructor(config, data) {\n    config = Object.assign(config, {\n      attributes: {\n        type: config.timepicker ? 'datetime-local' : 'date',\n      }\n    })\n\n    super(config, data)\n  }\n}\n","const Input = require('./Input')\n\nmodule.exports = class Email extends Input {\n  constructor(config, data) {\n    config = Object.assign(config, {\n      attributes: {\n        type: 'email'\n      }\n    })\n\n    super(config, data)\n  }\n}\n","\"use strict\";\n\n/**\r\n * filesize\r\n *\r\n * @copyright 2018 Jason Mulligan <jason.mulligan@avoidwork.com>\r\n * @license BSD-3-Clause\r\n * @version 3.6.1\r\n */\n(function (global) {\n\tvar b = /^(b|B)$/,\n\t    symbol = {\n\t\tiec: {\n\t\t\tbits: [\"b\", \"Kib\", \"Mib\", \"Gib\", \"Tib\", \"Pib\", \"Eib\", \"Zib\", \"Yib\"],\n\t\t\tbytes: [\"B\", \"KiB\", \"MiB\", \"GiB\", \"TiB\", \"PiB\", \"EiB\", \"ZiB\", \"YiB\"]\n\t\t},\n\t\tjedec: {\n\t\t\tbits: [\"b\", \"Kb\", \"Mb\", \"Gb\", \"Tb\", \"Pb\", \"Eb\", \"Zb\", \"Yb\"],\n\t\t\tbytes: [\"B\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\", \"EB\", \"ZB\", \"YB\"]\n\t\t}\n\t},\n\t    fullform = {\n\t\tiec: [\"\", \"kibi\", \"mebi\", \"gibi\", \"tebi\", \"pebi\", \"exbi\", \"zebi\", \"yobi\"],\n\t\tjedec: [\"\", \"kilo\", \"mega\", \"giga\", \"tera\", \"peta\", \"exa\", \"zetta\", \"yotta\"]\n\t};\n\n\t/**\r\n  * filesize\r\n  *\r\n  * @method filesize\r\n  * @param  {Mixed}   arg        String, Int or Float to transform\r\n  * @param  {Object}  descriptor [Optional] Flags\r\n  * @return {String}             Readable file size String\r\n  */\n\tfunction filesize(arg) {\n\t\tvar descriptor = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n\t\tvar result = [],\n\t\t    val = 0,\n\t\t    e = void 0,\n\t\t    base = void 0,\n\t\t    bits = void 0,\n\t\t    ceil = void 0,\n\t\t    full = void 0,\n\t\t    fullforms = void 0,\n\t\t    neg = void 0,\n\t\t    num = void 0,\n\t\t    output = void 0,\n\t\t    round = void 0,\n\t\t    unix = void 0,\n\t\t    separator = void 0,\n\t\t    spacer = void 0,\n\t\t    standard = void 0,\n\t\t    symbols = void 0;\n\n\t\tif (isNaN(arg)) {\n\t\t\tthrow new Error(\"Invalid arguments\");\n\t\t}\n\n\t\tbits = descriptor.bits === true;\n\t\tunix = descriptor.unix === true;\n\t\tbase = descriptor.base || 2;\n\t\tround = descriptor.round !== void 0 ? descriptor.round : unix ? 1 : 2;\n\t\tseparator = descriptor.separator !== void 0 ? descriptor.separator || \"\" : \"\";\n\t\tspacer = descriptor.spacer !== void 0 ? descriptor.spacer : unix ? \"\" : \" \";\n\t\tsymbols = descriptor.symbols || descriptor.suffixes || {};\n\t\tstandard = base === 2 ? descriptor.standard || \"jedec\" : \"jedec\";\n\t\toutput = descriptor.output || \"string\";\n\t\tfull = descriptor.fullform === true;\n\t\tfullforms = descriptor.fullforms instanceof Array ? descriptor.fullforms : [];\n\t\te = descriptor.exponent !== void 0 ? descriptor.exponent : -1;\n\t\tnum = Number(arg);\n\t\tneg = num < 0;\n\t\tceil = base > 2 ? 1000 : 1024;\n\n\t\t// Flipping a negative number to determine the size\n\t\tif (neg) {\n\t\t\tnum = -num;\n\t\t}\n\n\t\t// Determining the exponent\n\t\tif (e === -1 || isNaN(e)) {\n\t\t\te = Math.floor(Math.log(num) / Math.log(ceil));\n\n\t\t\tif (e < 0) {\n\t\t\t\te = 0;\n\t\t\t}\n\t\t}\n\n\t\t// Exceeding supported length, time to reduce & multiply\n\t\tif (e > 8) {\n\t\t\te = 8;\n\t\t}\n\n\t\t// Zero is now a special case because bytes divide by 1\n\t\tif (num === 0) {\n\t\t\tresult[0] = 0;\n\t\t\tresult[1] = unix ? \"\" : symbol[standard][bits ? \"bits\" : \"bytes\"][e];\n\t\t} else {\n\t\t\tval = num / (base === 2 ? Math.pow(2, e * 10) : Math.pow(1000, e));\n\n\t\t\tif (bits) {\n\t\t\t\tval = val * 8;\n\n\t\t\t\tif (val >= ceil && e < 8) {\n\t\t\t\t\tval = val / ceil;\n\t\t\t\t\te++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult[0] = Number(val.toFixed(e > 0 ? round : 0));\n\t\t\tresult[1] = base === 10 && e === 1 ? bits ? \"kb\" : \"kB\" : symbol[standard][bits ? \"bits\" : \"bytes\"][e];\n\n\t\t\tif (unix) {\n\t\t\t\tresult[1] = standard === \"jedec\" ? result[1].charAt(0) : e > 0 ? result[1].replace(/B$/, \"\") : result[1];\n\n\t\t\t\tif (b.test(result[1])) {\n\t\t\t\t\tresult[0] = Math.floor(result[0]);\n\t\t\t\t\tresult[1] = \"\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Decorating a 'diff'\n\t\tif (neg) {\n\t\t\tresult[0] = -result[0];\n\t\t}\n\n\t\t// Applying custom symbol\n\t\tresult[1] = symbols[result[1]] || result[1];\n\n\t\t// Returning Array, Object, or String (default)\n\t\tif (output === \"array\") {\n\t\t\treturn result;\n\t\t}\n\n\t\tif (output === \"exponent\") {\n\t\t\treturn e;\n\t\t}\n\n\t\tif (output === \"object\") {\n\t\t\treturn { value: result[0], suffix: result[1], symbol: result[1] };\n\t\t}\n\n\t\tif (full) {\n\t\t\tresult[1] = fullforms[e] ? fullforms[e] : fullform[standard][e] + (bits ? \"bit\" : \"byte\") + (result[0] === 1 ? \"\" : \"s\");\n\t\t}\n\n\t\tif (separator.length > 0) {\n\t\t\tresult[0] = result[0].toString().replace(\".\", separator);\n\t\t}\n\n\t\treturn result.join(spacer);\n\t}\n\n\t// Partial application for functional programming\n\tfilesize.partial = function (opt) {\n\t\treturn function (arg) {\n\t\t\treturn filesize(arg, opt);\n\t\t};\n\t};\n\n\t// CommonJS, AMD, script tag\n\tif (typeof exports !== \"undefined\") {\n\t\tmodule.exports = filesize;\n\t} else if (typeof define === \"function\" && define.amd) {\n\t\tdefine(function () {\n\t\t\treturn filesize;\n\t\t});\n\t} else {\n\t\tglobal.filesize = filesize;\n\t}\n})(typeof window !== \"undefined\" ? window : global);\n","const { h, setChildren, setStyle, text } = require('redom')\nconst filesize = require('filesize')\nconst Button = require('../Button')\nconst Field = require('./Field')\nconst Icon = require('../Icon')\nconst Toolbar = require('../Toolbar')\n\nmodule.exports = class Image extends Field {\n  constructor(config, data) {\n    const defaultConfig = {\n      oninput: () => {},\n    }\n\n    config = Object.assign(defaultConfig, config)\n\n    super(config, data)\n\n    this.field = h('.bg-black-05.black-50.bn.br2.db.f5.h5.pa2',\n\n      this.inputContainer = h('.h-100',\n        h('.h-100.relative',\n          this.imageInput = h('input.db.h-100.o-0.w-100', { accept: 'image/*', type: 'file' }),\n\n          h('.absolute.absolute--fill.flex.items-center.justify-center.pointer-events-none',\n            h('.flex.items-center',\n              new Icon({ cls: '.h3.w3', name: 'Photo' }),\n\n              h('.flex-auto.pl3',\n                h('h2.f4.fw5.lh-title.ma0.mb1', 'Drag & Drop Image Here'),\n                h('p.f7.fw4.lh-copy.ma0', 'or ',\n                    h('u', 'Upload an Image.'),\n                    h('span.ml1', '(jpeg, gif, png or svg)')\n                )\n              )\n            )\n          )\n        )\n      ),\n\n      this.imageContainer = h('.dn.h-100',\n        h('.flex.h-100',\n          h('.flex.h-100.items-center.justify-center.w-40',\n            this.image = h('img.db.h-100.w-100')\n          ),\n\n          h('.w-60.pa3',\n            this.imageName = h('h3.black.f5.fw5.lh-title.ma0.mb3'),\n\n            h('.f6.flex.items-center.lh-copy.mb1',\n              new Icon({ cls: '.dib.h1.mr2.w1', name: 'Size' }),\n\n              this.imageWidth = text(), text(' × '), this.imageHeight = text()\n            ),\n\n            h('.f6.flex.items-center.lh-copy',\n              new Icon({ cls: '.dib.h1.mr2.w1', name: 'Speed' }),\n\n              this.imageSize = text()\n            ),\n\n            new Toolbar({\n              border: false,\n              spacing: false,\n              cls: '.mv3',\n              children: [\n                h('label.mr2',\n                  this.replaceImageButton = new Button({\n                    text: 'Replace',\n                    onclick: e => this.imageInput.click(),\n                    icon: new Icon({ cls: '.h1.w1', name: 'Replace' }),\n                  })\n                ),\n\n                this.deleteImageButton = new Button({\n                  text: 'Delete',\n                  onclick: e => {\n                    if (confirm('Are you sure you want to delete this image?')) {\n                      this.image.src = ''\n                      this.imageInput.value = ''\n                      this.toggleImageContainer()\n                    }\n                  },\n                  icon: new Icon({ cls: '.h1.w1', name: 'Delete' }),\n                })\n              ]\n            }),\n          )\n        )\n      )\n    )\n\n    setStyle(this.image, { objectFit: 'contain' })\n\n    this.field.ondragover = e => e.preventDefault()\n\n    this.field.ondrop = e => {\n      e.preventDefault()\n      this.toggleImageContainer()\n      this.setImageDetails(e.dataTransfer.files[0])\n    }\n\n    this.imageInput.name = config.name\n\n    this.imageInput.oninput = e => {\n      if (this.imageContainer.classList.contains('dn')) {\n        this.toggleImageContainer()\n      }\n\n      this.setImageDetails(e.target.files[0])\n\n      config.oninput.call(this, e)\n    }\n\n    setChildren(this.content, this.field)\n  }\n\n  setImageDetails(file) {\n    const reader = new FileReader()\n    reader.onloadend = () => this.image.src = reader.result\n    reader.readAsDataURL(file)\n\n    this.image.onload = e => {\n      this.imageWidth.textContent = this.image.naturalWidth\n      this.imageHeight.textContent = this.image.naturalHeight\n    }\n\n    this.imageName.textContent = file.name\n    this.imageSize.textContent = filesize(file.size, { base: 10, round: 0 })\n  }\n\n  toggleImageContainer() {\n    this.inputContainer.classList.toggle('dn')\n    this.imageContainer.classList.toggle('dn')\n  }\n}\n","const Input = require('./Input')\n\nmodule.exports = class Number extends Input {\n  constructor(config, data) {\n    config = Object.assign(config, {\n      attributes: {\n        max: config.max,\n        min: config.min,\n        type: 'number'\n      }\n    })\n\n    super(config, data)\n  }\n}\n","const { h, setChildren, setStyle } = require('redom')\nconst Field = require('./Field')\nconst arrow = require('../../images/arrow-down.svg')\n\nmodule.exports = class Option extends Field {\n  constructor(config, data) {\n    const defaultConfig = {\n      oninput: () => {},\n    }\n\n    config = Object.assign(defaultConfig, config)\n\n    super(config, data)\n\n    const options = config.options.map(option => h('option', { value: option.value }, option.label))\n\n    this.field = h('select.bg-black-05.black.bn.border-box.br2.db.f5.lh-copy.input-reset.ma0.pa2.w-100', { name: config.name }, options)\n\n    this.field.oninput = config.oninput\n\n    setStyle(this.field, {\n      backgroundImage: `url(${arrow})`,\n      backgroundPosition: 'right 8px center',\n      backgroundSize: '16px',\n      backgroundRepeat: 'no-repeat',\n    })\n\n    setChildren(this.content, this.field)\n  }\n}\n","const Input = require('./Input')\n\nmodule.exports = class Plaintext extends Input {\n  constructor(config, data) {\n    config.attributes = {\n      type: 'text'\n    }\n\n    super(config, data)\n  }\n}\n","const Input = require('./Input')\n\nmodule.exports = class Phone extends Input {\n  constructor(config, data) {\n    config = Object.assign(config, {\n      attributes: {\n        type: 'phone'\n      }\n    })\n\n    super(config, data)\n  }\n}\n","const { setStyle } = require('redom')\nconst Option = require('./Option')\n\nmodule.exports = class Reference extends Option {\n  constructor(config, data, docs) {\n    config.options = [{ label: '', value: '' }].concat(docs\n      .filter(doc => doc.parent === config.collection)\n      .map(doc => ({ label: doc.name, value: doc._id }))\n    )\n\n    super(config, data)\n  }\n}\n","const { h } = require('redom')\nconst Button = require('../Button')\nconst Icon = require('../Icon')\nconst Input = require('./Input')\nconst Toolbar = require('../Toolbar')\n\nmodule.exports = class Richtext extends Input {\n  constructor(config, data) {\n    config = Object.assign(config, {\n      beforeFieldDecorator: new Toolbar({\n        border: false,\n        cls: '.pb2',\n        spacing: false,\n        items: [\n          new Button({\n            cls: '.mr2',\n            icon: new Icon({ cls: '.h1.w1', name: 'Bold' }),\n          }),\n\n          new Button({\n            cls: '.mr2',\n            icon: new Icon({ cls: '.h1.w1', name: 'Italics' }),\n          }),\n\n          new Button({\n            icon: new Icon({ cls: '.h1.w1', name: 'Underline' }),\n          }),\n        ]\n      }),\n      singleLine: false\n    })\n\n    super(config, data)\n  }\n}\n","const { h, setChildren, setStyle } = require('redom')\nconst Field = require('./Field')\nrequire('../../css/Switch.css')\n\nmodule.exports = class Switch extends Field {\n  constructor(config, data) {\n    const defaultConfig = {\n      oninput: e => {},\n    }\n\n    config = Object.assign(defaultConfig, config)\n\n    super(config, data)\n\n    this.field = h('label.flex.items-center',\n      [\n        h('input', { name: config.name, type: 'hidden', value: '0' }),\n\n        this.input = h('input.dn.switch', { name: config.name, type: 'checkbox', value: '1' }),\n\n        this.track = h('div.b--transparent.ba.br-pill.bw1.overflow-hidden.white',\n          { 'data-name': 'track'},\n\n          this.innerTrack = h('div.flex.items-center.flex-nowrap.w4',\n            { 'data-name': 'inner-track'},\n\n            h('span.db.f6.fw7.ph2.tc.ttu.w2', 'On'),\n\n            h('span.bg-near-white.br-100.db.h2.w2'),\n\n            h('span.db.f6.fw7.ph2.tc.ttu.w2', 'Off')\n          )\n        ),\n      ]\n    )\n\n    this.input.checked = data == 1 ? true : false\n    this.input.oninput = config.oninput\n\n    setStyle(this.track, { width: '5.5rem' })\n\n    setChildren(this.content, this.field)\n  }\n}\n","const Input = require('./Input')\n\nmodule.exports = class URL extends Input {\n  constructor(config, data) {\n    const protocols = ['http://', 'https://']\n\n    config = Object.assign(config, {\n      attributes: {\n        maxlength: 524288,\n        minlength: protocols[0].length,\n        pattern: '(http://.*|https://.*)',\n        type: 'url'\n      }\n    })\n\n    super(config, data)\n\n    this.field.addEventListener('blur', e => {\n      const el = e.target\n      const value = el.value\n\n      if ((value.startsWith(protocols[0]) === false &&\n          value.startsWith(protocols[1]) === false) &&\n          value !== '') {\n        el.value = protocols[0] + value\n      }\n    })\n  }\n}\n","const Color = require('./Color')\nconst Datetime = require('./Datetime')\nconst Email = require('./Email')\nconst Image = require('./Image')\nconst Input = require('./Input')\nconst Number = require('./Number')\nconst Option = require('./Option')\nconst Plaintext = require('./Plaintext')\nconst Phone = require('./Phone')\nconst Reference = require('./Reference')\nconst Richtext = require('./Richtext')\nconst Switch = require('./Switch')\nconst URL = require('./URL')\n\nmodule.exports = {\n  Color,\n  Datetime,\n  Email,\n  Image,\n  Input,\n  Number,\n  Option,\n  Plaintext,\n  Phone,\n  Reference,\n  Richtext,\n  Switch,\n  URL,\n}\n","const { h, setChildren, setStyle } = require('redom')\nconst { dispatch } = require('../library/dispatch')\nconst FieldComponents = require('./fields/Fields')\nconst Button = require('./Button')\nconst Icon = require('./Icon')\nconst Toolbar = require('./Toolbar')\n\nmodule.exports = class Record {\n  constructor() {\n    this.record = null\n\n    this.el = h('.bg-white.bottom-0.fixed.flex.flex-column.right-0.top-0.vh-100',\n\n      h('.flex-auto.overflow-y-auto.pv5',\n        this.form = h('form.center.w-80'),\n      ),\n\n      new Toolbar({\n        items: [\n          this.deleteButton = new Button({\n            icon: new Icon({\n              cls: '.h1.w1',\n              name: 'Delete'\n            }),\n            text: 'Delete',\n            title: 'Delete',\n            onclick: e => {\n              if (confirm('Are you sure you want to delete the selected record?')) {\n                dispatch(this, 'record:delete', { id: this.record._id })\n              }\n            },\n          }),\n\n          this.saveButton = new Button({\n            cls: '.bg-blue.ml-auto.white',\n            icon: new Icon({\n              cls: '.h1.w1',\n              name: 'Checkmark'\n            }),\n            text: 'Save',\n            title: 'Save',\n            onclick: e => {\n              this.saveButton.disabled = true\n              dispatch(this, 'record:update', { target: this.form })\n            }\n          }),\n        ]\n      }),\n    )\n\n    setStyle(this.el, { left: '640px', minWidth: '640px' })\n  }\n\n  update(docs) {\n    const fields = []\n    const collection = docs.filter(doc => doc._id === localStorage.getItem('selectedCollection')).shift()\n    const record = docs.filter(doc => doc._id === localStorage.getItem('selectedRecord')).shift()\n\n    this.deleteButton.setDisabled()\n    this.saveButton.setDisabled()\n\n    if (typeof record !== 'undefined') {\n      if (this.record === null) {\n        this.record = record\n      }\n\n      if ('_id' in this.record && record._id !== this.record._id) {\n        this.el.scrollTop = 0\n      }\n\n      this.record = record\n\n      if (this.record) {\n        collection.fields.map(config => {\n          let data = this.record[config.name]\n\n          fields.push(\n            new FieldComponents[config.type](config, data, docs)\n          )\n        })\n\n        fields.push(\n          h('input', { name: '_id', type: 'hidden', value: this.record._id }),\n          h('input', { name: '_rev', type: 'hidden', value: this.record._rev })\n        )\n      }\n\n      this.deleteButton.setEnabled()\n      this.saveButton.setEnabled()\n    }\n\n    setChildren(this.form, ...fields)\n\n    if (this.form.elements.length) {\n      this.form.elements[0].focus()\n    }\n  }\n}\n","(function (main) {\n  'use strict';\n\n  /**\n   * Parse or format dates\n   * @class fecha\n   */\n  var fecha = {};\n  var token = /d{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|ZZ|([HhMsDm])\\1?|[aA]|\"[^\"]*\"|'[^']*'/g;\n  var twoDigits = /\\d\\d?/;\n  var threeDigits = /\\d{3}/;\n  var fourDigits = /\\d{4}/;\n  var word = /[0-9]*['a-z\\u00A0-\\u05FF\\u0700-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]+|[\\u0600-\\u06FF\\/]+(\\s*?[\\u0600-\\u06FF]+){1,2}/i;\n  var literal = /\\[([^]*?)\\]/gm;\n  var noop = function () {\n  };\n\n  function shorten(arr, sLen) {\n    var newArr = [];\n    for (var i = 0, len = arr.length; i < len; i++) {\n      newArr.push(arr[i].substr(0, sLen));\n    }\n    return newArr;\n  }\n\n  function monthUpdate(arrName) {\n    return function (d, v, i18n) {\n      var index = i18n[arrName].indexOf(v.charAt(0).toUpperCase() + v.substr(1).toLowerCase());\n      if (~index) {\n        d.month = index;\n      }\n    };\n  }\n\n  function pad(val, len) {\n    val = String(val);\n    len = len || 2;\n    while (val.length < len) {\n      val = '0' + val;\n    }\n    return val;\n  }\n\n  var dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\n  var monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n  var monthNamesShort = shorten(monthNames, 3);\n  var dayNamesShort = shorten(dayNames, 3);\n  fecha.i18n = {\n    dayNamesShort: dayNamesShort,\n    dayNames: dayNames,\n    monthNamesShort: monthNamesShort,\n    monthNames: monthNames,\n    amPm: ['am', 'pm'],\n    DoFn: function DoFn(D) {\n      return D + ['th', 'st', 'nd', 'rd'][D % 10 > 3 ? 0 : (D - D % 10 !== 10) * D % 10];\n    }\n  };\n\n  var formatFlags = {\n    D: function(dateObj) {\n      return dateObj.getDate();\n    },\n    DD: function(dateObj) {\n      return pad(dateObj.getDate());\n    },\n    Do: function(dateObj, i18n) {\n      return i18n.DoFn(dateObj.getDate());\n    },\n    d: function(dateObj) {\n      return dateObj.getDay();\n    },\n    dd: function(dateObj) {\n      return pad(dateObj.getDay());\n    },\n    ddd: function(dateObj, i18n) {\n      return i18n.dayNamesShort[dateObj.getDay()];\n    },\n    dddd: function(dateObj, i18n) {\n      return i18n.dayNames[dateObj.getDay()];\n    },\n    M: function(dateObj) {\n      return dateObj.getMonth() + 1;\n    },\n    MM: function(dateObj) {\n      return pad(dateObj.getMonth() + 1);\n    },\n    MMM: function(dateObj, i18n) {\n      return i18n.monthNamesShort[dateObj.getMonth()];\n    },\n    MMMM: function(dateObj, i18n) {\n      return i18n.monthNames[dateObj.getMonth()];\n    },\n    YY: function(dateObj) {\n      return String(dateObj.getFullYear()).substr(2);\n    },\n    YYYY: function(dateObj) {\n      return pad(dateObj.getFullYear(), 4);\n    },\n    h: function(dateObj) {\n      return dateObj.getHours() % 12 || 12;\n    },\n    hh: function(dateObj) {\n      return pad(dateObj.getHours() % 12 || 12);\n    },\n    H: function(dateObj) {\n      return dateObj.getHours();\n    },\n    HH: function(dateObj) {\n      return pad(dateObj.getHours());\n    },\n    m: function(dateObj) {\n      return dateObj.getMinutes();\n    },\n    mm: function(dateObj) {\n      return pad(dateObj.getMinutes());\n    },\n    s: function(dateObj) {\n      return dateObj.getSeconds();\n    },\n    ss: function(dateObj) {\n      return pad(dateObj.getSeconds());\n    },\n    S: function(dateObj) {\n      return Math.round(dateObj.getMilliseconds() / 100);\n    },\n    SS: function(dateObj) {\n      return pad(Math.round(dateObj.getMilliseconds() / 10), 2);\n    },\n    SSS: function(dateObj) {\n      return pad(dateObj.getMilliseconds(), 3);\n    },\n    a: function(dateObj, i18n) {\n      return dateObj.getHours() < 12 ? i18n.amPm[0] : i18n.amPm[1];\n    },\n    A: function(dateObj, i18n) {\n      return dateObj.getHours() < 12 ? i18n.amPm[0].toUpperCase() : i18n.amPm[1].toUpperCase();\n    },\n    ZZ: function(dateObj) {\n      var o = dateObj.getTimezoneOffset();\n      return (o > 0 ? '-' : '+') + pad(Math.floor(Math.abs(o) / 60) * 100 + Math.abs(o) % 60, 4);\n    }\n  };\n\n  var parseFlags = {\n    D: [twoDigits, function (d, v) {\n      d.day = v;\n    }],\n    Do: [new RegExp(twoDigits.source + word.source), function (d, v) {\n      d.day = parseInt(v, 10);\n    }],\n    M: [twoDigits, function (d, v) {\n      d.month = v - 1;\n    }],\n    YY: [twoDigits, function (d, v) {\n      var da = new Date(), cent = +('' + da.getFullYear()).substr(0, 2);\n      d.year = '' + (v > 68 ? cent - 1 : cent) + v;\n    }],\n    h: [twoDigits, function (d, v) {\n      d.hour = v;\n    }],\n    m: [twoDigits, function (d, v) {\n      d.minute = v;\n    }],\n    s: [twoDigits, function (d, v) {\n      d.second = v;\n    }],\n    YYYY: [fourDigits, function (d, v) {\n      d.year = v;\n    }],\n    S: [/\\d/, function (d, v) {\n      d.millisecond = v * 100;\n    }],\n    SS: [/\\d{2}/, function (d, v) {\n      d.millisecond = v * 10;\n    }],\n    SSS: [threeDigits, function (d, v) {\n      d.millisecond = v;\n    }],\n    d: [twoDigits, noop],\n    ddd: [word, noop],\n    MMM: [word, monthUpdate('monthNamesShort')],\n    MMMM: [word, monthUpdate('monthNames')],\n    a: [word, function (d, v, i18n) {\n      var val = v.toLowerCase();\n      if (val === i18n.amPm[0]) {\n        d.isPm = false;\n      } else if (val === i18n.amPm[1]) {\n        d.isPm = true;\n      }\n    }],\n    ZZ: [/([\\+\\-]\\d\\d:?\\d\\d|Z)/, function (d, v) {\n      if (v === 'Z') v = '+00:00';\n      var parts = (v + '').match(/([\\+\\-]|\\d\\d)/gi), minutes;\n\n      if (parts) {\n        minutes = +(parts[1] * 60) + parseInt(parts[2], 10);\n        d.timezoneOffset = parts[0] === '+' ? minutes : -minutes;\n      }\n    }]\n  };\n  parseFlags.dd = parseFlags.d;\n  parseFlags.dddd = parseFlags.ddd;\n  parseFlags.DD = parseFlags.D;\n  parseFlags.mm = parseFlags.m;\n  parseFlags.hh = parseFlags.H = parseFlags.HH = parseFlags.h;\n  parseFlags.MM = parseFlags.M;\n  parseFlags.ss = parseFlags.s;\n  parseFlags.A = parseFlags.a;\n\n\n  // Some common format strings\n  fecha.masks = {\n    default: 'ddd MMM DD YYYY HH:mm:ss',\n    shortDate: 'M/D/YY',\n    mediumDate: 'MMM D, YYYY',\n    longDate: 'MMMM D, YYYY',\n    fullDate: 'dddd, MMMM D, YYYY',\n    shortTime: 'HH:mm',\n    mediumTime: 'HH:mm:ss',\n    longTime: 'HH:mm:ss.SSS'\n  };\n\n  /***\n   * Format a date\n   * @method format\n   * @param {Date|number} dateObj\n   * @param {string} mask Format of the date, i.e. 'mm-dd-yy' or 'shortDate'\n   */\n  fecha.format = function (dateObj, mask, i18nSettings) {\n    var i18n = i18nSettings || fecha.i18n;\n\n    if (typeof dateObj === 'number') {\n      dateObj = new Date(dateObj);\n    }\n\n    if (Object.prototype.toString.call(dateObj) !== '[object Date]' || isNaN(dateObj.getTime())) {\n      throw new Error('Invalid Date in fecha.format');\n    }\n\n    mask = fecha.masks[mask] || mask || fecha.masks['default'];\n\n    var literals = [];\n\n    // Make literals inactive by replacing them with ??\n    mask = mask.replace(literal, function($0, $1) {\n      literals.push($1);\n      return '??';\n    });\n    // Apply formatting rules\n    mask = mask.replace(token, function ($0) {\n      return $0 in formatFlags ? formatFlags[$0](dateObj, i18n) : $0.slice(1, $0.length - 1);\n    });\n    // Inline literal values back into the formatted value\n    return mask.replace(/\\?\\?/g, function() {\n      return literals.shift();\n    });\n  };\n\n  /**\n   * Parse a date string into an object, changes - into /\n   * @method parse\n   * @param {string} dateStr Date string\n   * @param {string} format Date parse format\n   * @returns {Date|boolean}\n   */\n  fecha.parse = function (dateStr, format, i18nSettings) {\n    var i18n = i18nSettings || fecha.i18n;\n\n    if (typeof format !== 'string') {\n      throw new Error('Invalid format in fecha.parse');\n    }\n\n    format = fecha.masks[format] || format;\n\n    // Avoid regular expression denial of service, fail early for really long strings\n    // https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS\n    if (dateStr.length > 1000) {\n      return false;\n    }\n\n    var isValid = true;\n    var dateInfo = {};\n    format.replace(token, function ($0) {\n      if (parseFlags[$0]) {\n        var info = parseFlags[$0];\n        var index = dateStr.search(info[0]);\n        if (!~index) {\n          isValid = false;\n        } else {\n          dateStr.replace(info[0], function (result) {\n            info[1](dateInfo, result, i18n);\n            dateStr = dateStr.substr(index + result.length);\n            return result;\n          });\n        }\n      }\n\n      return parseFlags[$0] ? '' : $0.slice(1, $0.length - 1);\n    });\n\n    if (!isValid) {\n      return false;\n    }\n\n    var today = new Date();\n    if (dateInfo.isPm === true && dateInfo.hour != null && +dateInfo.hour !== 12) {\n      dateInfo.hour = +dateInfo.hour + 12;\n    } else if (dateInfo.isPm === false && +dateInfo.hour === 12) {\n      dateInfo.hour = 0;\n    }\n\n    var date;\n    if (dateInfo.timezoneOffset != null) {\n      dateInfo.minute = +(dateInfo.minute || 0) - +dateInfo.timezoneOffset;\n      date = new Date(Date.UTC(dateInfo.year || today.getFullYear(), dateInfo.month || 0, dateInfo.day || 1,\n        dateInfo.hour || 0, dateInfo.minute || 0, dateInfo.second || 0, dateInfo.millisecond || 0));\n    } else {\n      date = new Date(dateInfo.year || today.getFullYear(), dateInfo.month || 0, dateInfo.day || 1,\n        dateInfo.hour || 0, dateInfo.minute || 0, dateInfo.second || 0, dateInfo.millisecond || 0);\n    }\n    return date;\n  };\n\n  /* istanbul ignore next */\n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = fecha;\n  } else if (typeof define === 'function' && define.amd) {\n    define(function () {\n      return fecha;\n    });\n  } else {\n    main.fecha = fecha;\n  }\n})(this);\n","const { h } = require('redom')\nconst fecha = require('fecha')\nconst Icon = require('./Icon')\n\nmodule.exports = class RecordItem {\n  constructor() {\n    this.el = h('.pl3.relative',\n      h('.b--black-10.bb.pointer-events-none.pr3.pv3',\n        this.title = h('h1.f5.fw6.lh-title.ma0.mb1.truncate'),\n\n        this.body = h('p.f5.lh-copy.ma0.mb2.truncate'),\n\n        this.date = h('time.f7.ma0'),\n      )\n    )\n  }\n\n  update(data) {\n    this.title.textContent = data.name\n\n    this.body.textContent = data.body\n\n    this.date.textContent = fecha.format(new Date(data.modified), 'mediumDate')\n  }\n}\n","const { h } = require('redom')\nconst Icon = require('./Icon')\n\nmodule.exports = class Search {\n  constructor() {\n    this.el = h('.relative.w-100',\n      h('.absolute.ml2.mt2.z1',\n        new Icon({ cls: '.black-50.h1.w1', name: 'Search' })\n      ),\n\n      this.search = h('input.bg-black-05.bn.br2.db.f6.input-reset.near-black.outline-0.pa2.pl4.w-100',\n        {\n          oninput: e => { this.oninput(e.target.value) },\n          placeholder: 'Search',\n          type: 'search'\n        }\n      )\n    )\n  }\n\n  clear() {\n    this.search.value = ''\n  }\n\n  oninput(query) {}\n}\n","const { h, setStyle } = require('redom')\nconst { dispatch } = require('../library/dispatch')\nconst Button = require('./Button')\nconst Icon = require('./Icon')\nconst List = require('./List')\nconst RecordItem = require('./RecordItem')\nconst Search = require('./Search')\nconst Toolbar = require('./Toolbar')\n\nmodule.exports = class RecordsList {\n  constructor() {\n    this.collection = null\n    this.docs = this.filteredDocs = this.searchResults = []\n\n    this.el = h('.b--black-10.bg-black-025.bottom-0.br.fixed.flex.flex-column.top-0.vh-100',\n\n      new Toolbar({\n        items: [\n          this.search = new Search()\n        ]\n      }),\n\n      this.list = new List({\n        cell: RecordItem,\n        class: '.black.flex-auto',\n        id: 'records',\n        key: '_id',\n        selectedClasses: ['bg-blue', 'white']\n      }),\n\n      new Toolbar({\n        border: false,\n        items: [\n          new Button({\n            icon: new Icon({\n              cls: '.h1.w1',\n              name: 'Add'\n            }),\n            onclick: e => dispatch(this, 'record:add', e)\n          })\n        ]\n      })\n    )\n\n    setStyle(this.el, { left: '320px', width: '320px' })\n\n    this.search.oninput = query => {\n      query = query.toLocaleLowerCase()\n\n      this.searchResults = query === ''\n        ? this.filteredDocs = this.docs\n        : this.filteredDocs.filter(doc => Object.keys(doc).some(key => {\n          let result = false\n          const value = doc[key]\n\n          if (typeof value === 'string') {\n            result = value.toLocaleLowerCase().includes(query)\n          }\n\n          return result\n        }))\n\n      this.list.update(this.searchResults)\n    }\n  }\n\n  applyFilter(docs) {\n    const collection = localStorage.getItem('selectedCollection')\n\n    if (collection !== this.collection) {\n      this.searchResults = []\n      this.search.clear()\n    }\n\n    this.collection = collection\n\n    this.docs = docs.filter(doc =>\n      doc.type === 'record' &&\n      doc.parent === this.collection\n    )\n\n    return this.searchResults.length ? this.searchResults : this.docs\n  }\n\n  selectRecord() {\n    if (this.docs.length) {\n      if (localStorage.getItem('selectedRecord')) {\n        this.list.selectElementById(localStorage.getItem('selectedRecord'))\n      } else {\n        this.list.selectElementByIndex(0)\n      }\n    }\n  }\n\n  update(docs) {\n    this.filteredDocs = this.applyFilter(docs)\n    this.list.update(this.filteredDocs)\n    this.selectRecord()\n  }\n}\n","const { h } = require('redom')\n\nrequire('tachyons')\nrequire('../css/App.css')\n\nconst CollectionsList = require('./CollectionsList')\nconst Record = require('./Record')\nconst RecordsList = require('./RecordsList')\n\nmodule.exports = class App {\n  constructor() {\n    this.el = h('main',\n      this.collections = new CollectionsList(),\n      this.records = new RecordsList(),\n      this.record = new Record()\n    )\n  }\n\n  update(docs) {\n    this.collections.update(docs)\n    this.records.update(docs)\n    this.record.update(docs)\n  }\n}\n","const { setChildren } = require('redom')\nconst { api } = require('./library/api')\nconst App = require('./components/App')\n\nconst render = () => {\n  const app = new App()\n  api(app)\n  setChildren(document.body, app)\n}\n\nrender()\n\nif (module.hot) {\n  module.hot.accept(render)\n}\n"]}